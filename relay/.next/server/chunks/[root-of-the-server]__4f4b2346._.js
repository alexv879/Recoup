module.exports=[56300,e=>e.a(async(r,t)=>{try{let r=await e.y("firebase-admin/app");e.n(r),t()}catch(e){t(e)}},!0),69907,e=>{"use strict";let r=process.env.LOG_LEVEL||"info",t={debug:0,info:1,warn:2,error:3};function a(e){return t[e]>=t[r]}let n={info:(e,r)=>{a("info")&&(r&&Object.keys(r).length>0?console.log(`[INFO] ${e}`,r):console.log(`[INFO] ${e}`))},error:(e,r)=>{a("error")&&(r&&Object.keys(r).length>0?console.error(`[ERROR] ${e}`,r):console.error(`[ERROR] ${e}`))},warn:(e,r)=>{a("warn")&&(r&&Object.keys(r).length>0?console.warn(`[WARN] ${e}`,r):console.warn(`[WARN] ${e}`))},debug:(e,r)=>{a("debug")&&(r&&Object.keys(r).length>0?console.log(`[DEBUG] ${e}`,r):console.log(`[DEBUG] ${e}`))}};function o(e,r){n.info(e,r)}function s(e,r,t){n.error(e,{...t,error:r instanceof Error?{message:r.message,stack:r.stack,name:r.name}:r})}function i(e,r){n.warn(e,r)}function l(e,r,t){n.info("API Request",{method:e,path:r,userId:t})}function d(e,r,t,a,o){n.info(`API Response ${t}`,{method:e,path:r,status:t,duration:a,userId:o})}function c(e,r,t,a){n.debug("Database Operation",{operation:e,collection:r,documentId:t,duration:a})}function u(e,r,t,a){a?n.error(`External API Error: ${e}`,{service:e,operation:r,duration:t,error:a.message}):n.info(`External API Call: ${e}`,{service:e,operation:r,duration:t})}e.s(["logApiRequest",()=>l,"logApiResponse",()=>d,"logDbOperation",()=>c,"logError",()=>s,"logExternalApiCall",()=>u,"logInfo",()=>o,"logWarn",()=>i,"logger",0,n])},55742,e=>e.a(async(r,t)=>{try{let r=await e.y("firebase-admin/firestore");e.n(r),t()}catch(e){t(e)}},!0),68253,e=>e.a(async(r,t)=>{try{var a=e.i(56300),n=e.i(55742),o=r([a,n]);if([a,n]=o.then?(await o)():o,!(0,a.getApps)().length)try{let e=process.env.FIREBASE_PROJECT_ID,r=process.env.FIREBASE_CLIENT_EMAIL,t=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");e&&r&&t?((0,a.initializeApp)({credential:(0,a.cert)({projectId:e,clientEmail:r,privateKey:t})}),console.log("✅ Firebase Admin initialized successfully")):console.warn("⚠️  Firebase credentials not configured - app will not function at runtime")}catch(e){console.error("❌ Firebase Admin initialization error:",e)}let d=null,c=new Proxy({},{get:(e,r)=>(function(){if(!d){if(!(0,a.getApps)().length)throw Error("Firebase is not initialized. Make sure environment variables are configured.");d=(0,n.getFirestore)()}return d})()[r]});function s(e){return e?e.toDate():null}function i(e){return e?"string"==typeof e?n.Timestamp.fromDate(new Date(e)):n.Timestamp.fromDate(e):null}function l(){return n.FieldValue.serverTimestamp()}e.s(["COLLECTIONS",0,{USERS:"users",INVOICES:"invoices",PAYMENT_CONFIRMATIONS:"payment_confirmations",COLLECTION_ATTEMPTS:"collection_attempts",NOTIFICATIONS:"notifications",TRANSACTIONS:"transactions",REFERRALS:"referrals",REFERRAL_CREDITS:"referral_credits",REFERRAL_PAYOUTS:"referral_payouts",USER_BEHAVIOR_PROFILE:"user_behavior_profile",USER_STATS:"user_stats",USER_EVENTS:"user_events",DAILY_SUMMARIES:"daily_summaries",EMAILS_SENT:"emails_sent",ONBOARDING_PROGRESS:"onboarding_progress",AGENCY_HANDOFFS:"agency_handoffs"},"dateToTimestamp",()=>i,"db",0,c,"serverTimestamp",()=>l,"timestampToDate",()=>s]),t()}catch(e){t(e)}},!1),18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},42315,(e,r,t)=>{"use strict";r.exports=e.r(18622)},47540,(e,r,t)=>{"use strict";r.exports=e.r(42315).vendored["react-rsc"].React},19481,(e,r,t)=>{"use strict";var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,i={},l={RequestCookies:()=>m,ResponseCookies:()=>g,parseCookie:()=>u,parseSetCookie:()=>p,stringifyCookie:()=>c};for(var d in l)a(i,d,{get:l[d],enumerable:!0});function c(e){var r;let t=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),a=`${e.name}=${encodeURIComponent(null!=(r=e.value)?r:"")}`;return 0===t.length?a:`${a}; ${t.join("; ")}`}function u(e){let r=new Map;for(let t of e.split(/; */)){if(!t)continue;let e=t.indexOf("=");if(-1===e){r.set(t,"true");continue}let[a,n]=[t.slice(0,e),t.slice(e+1)];try{r.set(a,decodeURIComponent(null!=n?n:"true"))}catch{}}return r}function p(e){if(!e)return;let[[r,t],...a]=u(e),{domain:n,expires:o,httponly:s,maxage:i,path:l,samesite:d,secure:c,partitioned:p,priority:m}=Object.fromEntries(a.map(([e,r])=>[e.toLowerCase().replace(/-/g,""),r]));{var g,E,R={name:r,value:decodeURIComponent(t),domain:n,...o&&{expires:new Date(o)},...s&&{httpOnly:!0},..."string"==typeof i&&{maxAge:Number(i)},path:l,...d&&{sameSite:f.includes(g=(g=d).toLowerCase())?g:void 0},...c&&{secure:!0},...m&&{priority:h.includes(E=(E=m).toLowerCase())?E:void 0},...p&&{partitioned:!0}};let e={};for(let r in R)R[r]&&(e[r]=R[r]);return e}}r.exports=((e,r,t,i)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let t of o(r))s.call(e,t)||void 0===t||a(e,t,{get:()=>r[t],enumerable:!(i=n(r,t))||i.enumerable});return e})(a({},"__esModule",{value:!0}),i);var f=["strict","lax","none"],h=["low","medium","high"],m=class{constructor(e){this._parsed=new Map,this._headers=e;const r=e.get("cookie");if(r)for(const[e,t]of u(r))this._parsed.set(e,{name:e,value:t})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let r="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(r)}getAll(...e){var r;let t=Array.from(this._parsed);if(!e.length)return t.map(([e,r])=>r);let a="string"==typeof e[0]?e[0]:null==(r=e[0])?void 0:r.name;return t.filter(([e])=>e===a).map(([e,r])=>r)}has(e){return this._parsed.has(e)}set(...e){let[r,t]=1===e.length?[e[0].name,e[0].value]:e,a=this._parsed;return a.set(r,{name:r,value:t}),this._headers.set("cookie",Array.from(a).map(([e,r])=>c(r)).join("; ")),this}delete(e){let r=this._parsed,t=Array.isArray(e)?e.map(e=>r.delete(e)):r.delete(e);return this._headers.set("cookie",Array.from(r).map(([e,r])=>c(r)).join("; ")),t}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},g=class{constructor(e){var r,t,a;this._parsed=new Map,this._headers=e;const n=null!=(a=null!=(t=null==(r=e.getSetCookie)?void 0:r.call(e))?t:e.get("set-cookie"))?a:[];for(const e of Array.isArray(n)?n:function(e){if(!e)return[];var r,t,a,n,o,s=[],i=0;function l(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(r=i,o=!1;l();)if(","===(t=e.charAt(i))){for(a=i,i+=1,l(),n=i;i<e.length&&"="!==(t=e.charAt(i))&&";"!==t&&","!==t;)i+=1;i<e.length&&"="===e.charAt(i)?(o=!0,i=n,s.push(e.substring(r,a)),r=i):i=a+1}else i+=1;(!o||i>=e.length)&&s.push(e.substring(r,e.length))}return s}(n)){const r=p(e);r&&this._parsed.set(r.name,r)}}get(...e){let r="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(r)}getAll(...e){var r;let t=Array.from(this._parsed.values());if(!e.length)return t;let a="string"==typeof e[0]?e[0]:null==(r=e[0])?void 0:r.name;return t.filter(e=>e.name===a)}has(e){return this._parsed.has(e)}set(...e){let[r,t,a]=1===e.length?[e[0].name,e[0].value,e[0]]:e,n=this._parsed;return n.set(r,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:r,value:t,...a})),function(e,r){for(let[,t]of(r.delete("set-cookie"),e)){let e=c(t);r.append("set-cookie",e)}}(n,this._headers),this}delete(...e){let[r,t]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0]];return this.set({...t,name:r,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(c).join("; ")}}},66680,(e,r,t)=>{r.exports=e.x("node:crypto",()=>require("node:crypto"))},15776,e=>{"use strict";var r=e.i(89171),t=e.i(15874);class a extends Error{statusCode;code;constructor(e,r,t){super(r),this.statusCode=e,this.code=t,this.name="ApiError"}}class n extends a{details;constructor(e,r){super(400,e,"VALIDATION_ERROR"),this.details=r}}class o extends a{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class s extends a{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class i extends a{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class l extends a{retryAfter;constructor(e="Rate limit exceeded",r){super(429,e,"RATE_LIMIT"),this.retryAfter=r}}class d extends a{constructor(e="Internal server error"){super(500,e,"INTERNAL_ERROR")}}function c(e){if(e instanceof a){let t={error:e.code,message:e.message};return(e instanceof n&&e.details&&(t.details=e.details),e instanceof l&&e.retryAfter)?r.NextResponse.json(t,{status:e.statusCode,headers:{"Retry-After":e.retryAfter.toString()}}):r.NextResponse.json(t,{status:e.statusCode})}return e instanceof t.ZodError?r.NextResponse.json({error:"VALIDATION_ERROR",message:"Invalid request data",details:e.issues},{status:400}):(console.error("Unhandled error:",e),r.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500}))}e.s(["NotFoundError",()=>i,"errors",0,{unauthorized:(e="Unauthorized")=>new o(e),forbidden:(e="Forbidden")=>new s(e),notFound:(e="Not found")=>new i(e),badRequest:e=>new n(e),internal:(e="Internal server error")=>new d(e),rateLimit:(e="Rate limit exceeded",r)=>new l(e,r)},"handleApiError",()=>c])},27356,e=>{"use strict";let r,t;var a=e.i(66680);function n(e=21){var o;o=e|=0,!r||r.length<o?(r=Buffer.allocUnsafe(128*o),a.webcrypto.getRandomValues(r),t=0):t+o>r.length&&(a.webcrypto.getRandomValues(r),t=0),t+=o;let s="";for(let a=t-e;a<t;a++)s+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[a]];return s}e.s(["nanoid",()=>n],27356)},21844,e=>e.a(async(r,t)=>{try{var a=e.i(68253),n=e.i(55742),o=e.i(15776),s=e.i(69907),i=e.i(27356),l=r([a,n]);async function d(e){let r=Date.now();try{let t,l=await a.db.collection(a.COLLECTIONS.USERS).doc(e).get();if(!l.exists)throw new o.NotFoundError("User not found");let d=l.data();if(d.referralCode)return(0,s.logInfo)("User already has referral code",{userId:e,code:d.referralCode}),d.referralCode;let c=!1,u=0;for(;!c&&u<5;)t=(0,i.nanoid)(12).toUpperCase(),(await a.db.collection(a.COLLECTIONS.USERS).where("referralCode","==",t).limit(1).get()).empty&&(c=!0),u++;if(!c)throw Error("Failed to generate unique referral code after multiple attempts");return await l.ref.update({referralCode:t,referralCreditsEarned:0,referralCreditsSpent:0,referralCreditsBalance:0,updatedAt:n.Timestamp.now()}),(0,s.logDbOperation)("generate_referral_code",a.COLLECTIONS.USERS,e,Date.now()-r),(0,s.logInfo)("Generated referral code",{userId:e,code:t}),t}catch(e){throw(0,s.logError)("Failed to generate referral code",e),e}}async function c(e,r){let t=Date.now();try{let l=await a.db.collection(a.COLLECTIONS.USERS).where("referralCode","==",e.toUpperCase()).limit(1).get();if(l.empty)return{success:!1,creditAdded:0,message:"Invalid referral code"};let d=l.docs[0].data();if(d.userId===r)return{success:!1,creditAdded:0,message:"Cannot use your own referral code"};let c=await a.db.collection(a.COLLECTIONS.USERS).doc(r).get();if(!c.exists)throw new o.NotFoundError("New user not found");if(c.data().referredBy)return{success:!1,creditAdded:0,message:"You have already used a referral code"};let u=(0,i.nanoid)(),p=n.Timestamp.now();return await a.db.collection(a.COLLECTIONS.REFERRALS).doc(u).set({referralId:u,referrerId:d.userId,referredUserId:r,referralCode:e.toUpperCase(),status:"active",referrerCredit:5,referredCredit:5,creditType:"account_credit",signupDate:p,createdAt:p,expiresAt:n.Timestamp.fromDate(new Date(Date.now()+31536e6))}),await a.db.collection(a.COLLECTIONS.USERS).doc(d.userId).update({referralCreditsEarned:n.FieldValue.increment(5),referralCreditsBalance:n.FieldValue.increment(5),updatedAt:p}),await a.db.collection(a.COLLECTIONS.USERS).doc(r).update({referredBy:d.userId,referralCreditsEarned:n.FieldValue.increment(5),referralCreditsBalance:n.FieldValue.increment(5),updatedAt:p}),(0,s.logDbOperation)("redeem_referral_code",a.COLLECTIONS.REFERRALS,u,Date.now()-t),(0,s.logInfo)("Referral code redeemed",{referralId:u,referrerId:d.userId,newUserId:r,code:e.toUpperCase()}),{success:!0,creditAdded:5,message:`\xa35 credit added to your account!`}}catch(e){throw(0,s.logError)("Failed to redeem referral code",e),e}}async function u(e){let r=Date.now();try{let t=await a.db.collection(a.COLLECTIONS.USERS).doc(e).get();if(!t.exists)throw new o.NotFoundError("User not found");let n=t.data(),i=await a.db.collection(a.COLLECTIONS.REFERRALS).where("referrerId","==",e).where("status","==","active").get();return(0,s.logDbOperation)("get_referral_stats",a.COLLECTIONS.USERS,e,Date.now()-r),{referralsMade:i.size,creditsEarned:n.referralCreditsEarned||0,creditsBalance:n.referralCreditsBalance||0,referralCode:n.referralCode||""}}catch(e){throw(0,s.logError)("Failed to get referral stats",e),e}}async function p(e=10){let r=Date.now();try{let t=await a.db.collection(a.COLLECTIONS.USERS).where("referralCreditsEarned",">",0).orderBy("referralCreditsEarned","desc").limit(e).get(),n=await Promise.all(t.docs.map(async e=>{let r=e.data(),t=await a.db.collection(a.COLLECTIONS.REFERRALS).where("referrerId","==",r.userId).where("status","==","active").get();return{userId:r.userId,name:r.name||"Anonymous",creditsEarned:r.referralCreditsEarned||0,referralCount:t.size}}));return(0,s.logDbOperation)("get_top_referrers",a.COLLECTIONS.USERS,void 0,Date.now()-r),n}catch(e){throw(0,s.logError)("Failed to get top referrers",e),e}}async function f(e,r){let t=Date.now();try{if(r<20)return{success:!1,payoutId:"",status:"rejected",message:`Minimum payout amount is \xa320`};let l=await a.db.collection(a.COLLECTIONS.USERS).doc(e).get();if(!l.exists)throw new o.NotFoundError("User not found");let d=l.data().referralCreditsBalance||0;if(d<r)return{success:!1,payoutId:"",status:"rejected",message:`Insufficient balance. You have \xa3${d} available`};let c=(0,i.nanoid)(),u=n.Timestamp.now();return await a.db.collection("referral_payouts").doc(c).set({payoutId:c,userId:e,amount:r,status:"pending",requestedAt:u,createdAt:u}),(0,s.logDbOperation)("request_payout","referral_payouts",c,Date.now()-t),(0,s.logInfo)("Payout requested",{userId:e,amount:r,payoutId:c}),{success:!0,payoutId:c,status:"pending",message:"Payout request submitted. Will be processed within 3-5 business days"}}catch(e){throw(0,s.logError)("Failed to request payout",e),e}}[a,n]=l.then?(await l)():l,e.s(["generateCode",()=>d,"getReferralStats",()=>u,"redeemCode",()=>c,"requestPayout",()=>f,"topReferrers",()=>p]),t()}catch(e){t(e)}},!1),79118,e=>e.a(async(r,t)=>{try{var a=e.i(89171),n=e.i(21844),o=e.i(69907),s=r([n]);async function i(e){try{let r=e.nextUrl.searchParams,t=Math.min(parseInt(r.get("limit")||"10"),50),o=(await (0,n.topReferrers)(t)).map((e,r)=>({rank:r+1,userId:e.userId,name:e.name,creditsEarned:e.creditsEarned,referralsCount:e.referralCount}));return a.NextResponse.json(o)}catch(e){return(0,o.logError)("Failed to get referral leaderboard",e),a.NextResponse.json({error:"Failed to get referral leaderboard"},{status:500})}}[n]=s.then?(await s)():s,e.s(["GET",()=>i]),t()}catch(e){t(e)}},!1),52296,e=>e.a(async(r,t)=>{try{var a=e.i(47909),n=e.i(74017),o=e.i(96250),s=e.i(84243),i=e.i(61916),l=e.i(14444),d=e.i(37092),c=e.i(69741),u=e.i(16795),p=e.i(87718),f=e.i(95169),h=e.i(47587),m=e.i(66012),g=e.i(70101),E=e.i(26937),R=e.i(10372),y=e.i(93695);e.i(52474);var w=e.i(220),C=e.i(79118),A=r([C]);[C]=A.then?(await A)():A;let S=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/referrals/leaderboard/route",pathname:"/api/referrals/leaderboard",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/referrals/leaderboard/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:v,workUnitAsyncStorage:I,serverHooks:b}=S;function x(){return(0,o.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:I})}async function O(e,r,t){S.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/referrals/leaderboard/route";a=a.replace(/\/index$/,"")||"/";let o=await S.prepare(e,r,{srcPage:a,multiZoneDraftMode:!1});if(!o)return r.statusCode=400,r.end("Bad Request"),null==t.waitUntil||t.waitUntil.call(t,Promise.resolve()),null;let{buildId:C,params:A,nextConfig:x,parsedUrl:O,isDraftMode:v,prerenderManifest:I,routerServerContext:b,isOnDemandRevalidate:_,revalidateOnlyGenerated:N,resolvedPathname:T,clientReferenceManifest:L,serverActionsManifest:D}=o,U=(0,c.normalizeAppPath)(a),F=!!(I.dynamicRoutes[U]||I.routes[T]),P=async()=>((null==b?void 0:b.render404)?await b.render404(e,r,O,!1):r.end("This page could not be found"),null);if(F&&!v){let e=!!I.routes[T],r=I.dynamicRoutes[U];if(r&&!1===r.fallback&&!e){if(x.experimental.adapterPath)return await P();throw new y.NoFallbackError}}let k=null;!F||S.isDev||v||(k=T,k="/index"===k?"/":k);let j=!0===S.isDev||!F,$=F&&!j;D&&L&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:L,serverActionsManifest:D,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:D})});let q=e.method||"GET",M=(0,i.getTracer)(),B=M.getActiveScopeSpan(),H={params:A,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:t.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>S.onRequestError(e,r,a,b)},sharedContext:{buildId:C}},V=new u.NodeNextRequest(e),z=new u.NodeNextResponse(r),G=p.NextRequestAdapter.fromNodeNextRequest(V,(0,p.signalFromNodeResponse)(r));try{let o=async e=>S.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=M.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==f.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=t.get("next.route");if(n){let r=`${q} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":r}),e.updateName(r)}else e.updateName(`${q} ${a}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var i,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&_&&N&&!n)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let a=await o(s);e.fetchMetrics=H.renderOpts.fetchMetrics;let i=H.renderOpts.pendingWaitUntil;i&&t.waitUntil&&(t.waitUntil(i),i=void 0);let d=H.renderOpts.collectedTags;if(!F)return await (0,m.sendResponse)(V,z,a,H.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),r=(0,g.toNodeOutgoingHttpHeaders)(a.headers);d&&(r[R.NEXT_CACHE_TAGS_HEADER]=d),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,n=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:n}}}}catch(r){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,r,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:_})},b),r}},u=await S.handleResponse({req:e,nextConfig:x,cacheKey:k,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:t.waitUntil,isMinimalMode:l});if(!F)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||r.setHeader("x-nextjs-cache",_?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),v&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&F||p.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||r.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,E.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(V,z,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};B?await d(B):await M.withPropagatedContext(e.headers,()=>M.trace(f.BaseServerSpan.handleRequest,{spanName:`${q} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},d))}catch(r){if(r instanceof y.NoFallbackError||await S.onRequestError(e,r,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:_})}),F)throw r;return await (0,m.sendResponse)(V,z,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>x,"routeModule",()=>S,"serverHooks",()=>b,"workAsyncStorage",()=>v,"workUnitAsyncStorage",()=>I]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__4f4b2346._.js.map
module.exports=[446,e=>e.a(async(t,r)=>{try{var a=e.i(68253),l=e.i(55742),s=e.i(69907),i=t([a,l]);async function d(e,t){let r=t.body||t;if(!r?.id)throw Error("Missing letter ID in payload");let i=await a.db.collection("collection_attempts").where("letterApiRef","==",r.id).limit(1).get();if(i.empty)throw Error(`Collection attempt not found for letter ID: ${r.id}`);let d=i.docs[0],n={updatedAt:l.Timestamp.now()};switch(e){case"letter.created":n.letterStatus="sent",n.letterSentAt=l.Timestamp.now(),n.result="pending";break;case"letter.rendered_pdf":break;case"letter.in_transit":n.letterStatus="sent",r.expected_delivery_date&&(n.letterExpectedDelivery=l.Timestamp.fromDate(new Date(r.expected_delivery_date)));break;case"letter.in_local_area":case"letter.processed_for_delivery":n.letterStatus="sent";break;case"letter.delivered":n.letterStatus="delivered",n.result="success";break;case"letter.returned_to_sender":n.letterStatus="returned",n.result="failed",n.resultDetails="Letter returned to sender - bad address";break;case"letter.failed":n.letterStatus="failed",n.result="failed",n.resultDetails=r.failure_reason||"Letter failed to send"}r.tracking_events&&r.tracking_events.length>0&&(n.letterTrackingUrl=r.tracking_url),await d.ref.update(n),(0,s.logInfo)("Collection attempt updated from letter status",{attemptId:d.id,eventType:e,letterStatus:n.letterStatus})}[a,l]=i.then?(await i)():i,e.s(["processLobWebhook",()=>d]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=lib_webhook-processors_lob_ts_d1d68c50._.js.map
{"version":3,"sources":["../../../node_modules/safe-buffer/index.js","../../../lib/twilio-sms.ts","../../../utils/error.ts","../../../node_modules/nanoid/index.js","../../../node_modules/nanoid/url-alphabet/index.js","../../../utils/constants.ts","../../../services/collectionsService.ts"],"sourcesContent":["/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\n/* eslint-disable node/no-deprecated-api */\nvar buffer = require('buffer')\nvar Buffer = buffer.Buffer\n\n// alternative to using Object.keys for old browsers\nfunction copyProps (src, dst) {\n  for (var key in src) {\n    dst[key] = src[key]\n  }\n}\nif (Buffer.from && Buffer.alloc && Buffer.allocUnsafe && Buffer.allocUnsafeSlow) {\n  module.exports = buffer\n} else {\n  // Copy properties from require('buffer')\n  copyProps(buffer, exports)\n  exports.Buffer = SafeBuffer\n}\n\nfunction SafeBuffer (arg, encodingOrOffset, length) {\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.prototype = Object.create(Buffer.prototype)\n\n// Copy static methods from Buffer\ncopyProps(Buffer, SafeBuffer)\n\nSafeBuffer.from = function (arg, encodingOrOffset, length) {\n  if (typeof arg === 'number') {\n    throw new TypeError('Argument must not be a number')\n  }\n  return Buffer(arg, encodingOrOffset, length)\n}\n\nSafeBuffer.alloc = function (size, fill, encoding) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  var buf = Buffer(size)\n  if (fill !== undefined) {\n    if (typeof encoding === 'string') {\n      buf.fill(fill, encoding)\n    } else {\n      buf.fill(fill)\n    }\n  } else {\n    buf.fill(0)\n  }\n  return buf\n}\n\nSafeBuffer.allocUnsafe = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return Buffer(size)\n}\n\nSafeBuffer.allocUnsafeSlow = function (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('Argument must be a number')\n  }\n  return buffer.SlowBuffer(size)\n}\n","/**\n * PREMIUM FEATURE: Twilio SMS Service\n *\n * Handles sending SMS reminders for invoice collections.\n * Requires paid subscription tier to use.\n *\n * Setup Instructions:\n * 1. Sign up for Twilio account at https://www.twilio.com\n * 2. Get Account SID and Auth Token from console\n * 3. Purchase a UK phone number with SMS capabilities\n * 4. Add to .env.local:\n *    TWILIO_ACCOUNT_SID=your_account_sid\n *    TWILIO_AUTH_TOKEN=your_auth_token\n *    TWILIO_PHONE_NUMBER=+44xxxxxxxxxx\n * 5. Install package: npm install twilio\n *\n * UK SMS Compliance:\n * - Must have explicit consent from recipient\n * - Must include opt-out instructions\n * - Must respect quiet hours (typically 21:00 - 08:00)\n * - Must not exceed rate limits\n *\n * Twilio UK Pricing (as of 2025):\n * - SMS to UK mobiles: ~£0.04 per message\n * - Phone number rental: ~£1/month\n */\n\nimport { logError, logExternalApiCall, logInfo, logWarn } from '@/utils/logger';\nimport { db, Timestamp } from '@/lib/firebase';\nimport twilio from 'twilio';\n\n/**\n * Initialize Twilio client\n * Only runs in production or when explicitly enabled\n */\nfunction getTwilioClient() {\n  const accountSid = process.env.TWILIO_ACCOUNT_SID;\n  const authToken = process.env.TWILIO_AUTH_TOKEN;\n\n  if (!accountSid || !authToken) {\n    throw new Error('Twilio credentials not configured');\n  }\n\n  return twilio(accountSid, authToken);\n}\n\n/**\n * SMS Template Types\n */\nexport type SMSTemplate = 'gentle_reminder' | 'urgent_reminder' | 'final_notice' | 'payment_link';\n\n/**\n * Get SMS template text\n */\nfunction getSMSTemplate(\n  template: SMSTemplate,\n  params: {\n    invoiceReference: string;\n    amount: number;\n    dueDate: string;\n    paymentLink?: string;\n    businessName: string;\n  }\n): string {\n  const { invoiceReference, amount, dueDate, paymentLink, businessName } = params;\n\n  const templates = {\n    gentle_reminder: `Hi, this is a friendly reminder from ${businessName} about invoice ${invoiceReference} for £${amount.toFixed(2)}, due ${dueDate}. ${paymentLink ? `Pay now: ${paymentLink}` : 'Please arrange payment at your earliest convenience.'} Reply STOP to opt out.`,\n\n    urgent_reminder: `URGENT: Invoice ${invoiceReference} for £${amount.toFixed(2)} is now overdue (due ${dueDate}). ${paymentLink ? `Pay immediately: ${paymentLink}` : 'Please contact us urgently.'} - ${businessName}. Reply STOP to opt out.`,\n\n    final_notice: `FINAL NOTICE: Invoice ${invoiceReference} for £${amount.toFixed(2)} remains unpaid. This is your last reminder before further action. ${paymentLink ? `Pay now: ${paymentLink}` : 'Contact us immediately.'} - ${businessName}. Reply STOP to opt out.`,\n\n    payment_link: `${businessName}: Pay invoice ${invoiceReference} (£${amount.toFixed(2)}) securely: ${paymentLink}. Reply STOP to opt out.`,\n  };\n\n  return templates[template];\n}\n\n/**\n * Check if within UK quiet hours\n */\nfunction isQuietHours(): boolean {\n  const now = new Date();\n  const hour = now.getHours();\n\n  // Quiet hours: 21:00 (9 PM) to 08:00 (8 AM)\n  return hour >= 21 || hour < 8;\n}\n\n/**\n * Send SMS reminder for invoice collection\n *\n * @param params SMS parameters\n * @returns Twilio message SID or null if failed\n */\nexport async function sendCollectionSMS(params: {\n  recipientPhone: string; // E.164 format: +44xxxxxxxxxx\n  invoiceReference: string;\n  amount: number;\n  dueDate: string;\n  template: SMSTemplate;\n  paymentLink?: string;\n  businessName: string;\n  // Internal tracking\n  invoiceId: string;\n  freelancerId: string;\n}): Promise<{\n  success: boolean;\n  messageSid?: string;\n  error?: string;\n  status?: 'queued' | 'sent' | 'failed';\n}> {\n  const startTime = Date.now();\n\n  try {\n    // 1. Validate phone number format\n    if (!params.recipientPhone.startsWith('+44')) {\n      throw new Error('Only UK phone numbers supported (+44)');\n    }\n\n    // 2. Check if user has opted out (PECR compliance)\n    const userSnapshot = await db\n      .collection('users')\n      .where('phoneNumber', '==', params.recipientPhone)\n      .limit(1)\n      .get();\n\n    if (!userSnapshot.empty) {\n      const user = userSnapshot.docs[0].data();\n      if (user.collectionsConsent?.smsOptedOut) {\n        logWarn('SMS not sent: User has opted out', {\n          phone: params.recipientPhone,\n          optOutDate: user.collectionsConsent.smsOptOutDate,\n        });\n        return {\n          success: false,\n          error: 'User has opted out of SMS communications',\n        };\n      }\n    }\n\n    // 3. Check quiet hours\n    if (isQuietHours()) {\n      logError('SMS not sent: Quiet hours (21:00-08:00)', new Error('Quiet hours'), {\n        invoiceId: params.invoiceId,\n      });\n      return {\n        success: false,\n        error: 'Cannot send SMS during quiet hours (21:00-08:00)',\n      };\n    }\n\n    // 4. Get SMS text\n    const messageBody = getSMSTemplate(params.template, {\n      invoiceReference: params.invoiceReference,\n      amount: params.amount,\n      dueDate: params.dueDate,\n      paymentLink: params.paymentLink,\n      businessName: params.businessName,\n    });\n\n    // 4. Send via Twilio\n    const client = getTwilioClient();\n    const message = await client.messages.create({\n      body: messageBody,\n      from: process.env.TWILIO_PHONE_NUMBER,\n      to: params.recipientPhone,\n      // Status callback for delivery tracking\n      statusCallback: `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/twilio/sms-status`,\n    });\n\n    const duration = Date.now() - startTime;\n    logExternalApiCall('Twilio SMS', 'send', duration);\n\n    return {\n      success: true,\n      messageSid: message.sid,\n      status: message.status as 'queued' | 'sent' | 'failed',\n    };\n\n  } catch (error) {\n    const duration = Date.now() - startTime;\n    logExternalApiCall('Twilio SMS', 'send', duration, error as Error);\n\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n\n/**\n * Get SMS delivery status from Twilio\n *\n * @param messageSid Twilio message SID\n * @returns Message status\n */\nexport async function getSMSStatus(messageSid: string): Promise<{\n  status: 'queued' | 'sending' | 'sent' | 'delivered' | 'undelivered' | 'failed';\n  errorCode?: string;\n  errorMessage?: string;\n}> {\n  try {\n    const client = getTwilioClient();\n    const message = await client.messages(messageSid).fetch();\n\n    return {\n      status: message.status as any,\n      errorCode: message.errorCode?.toString(),\n      errorMessage: message.errorMessage || undefined,\n    };\n  } catch (error) {\n    logError('Failed to fetch SMS status', error);\n    return {\n      status: 'failed',\n      errorMessage: error instanceof Error ? error.message : 'Unknown error',\n    };\n  }\n}\n\n/**\n * Handle SMS opt-out (STOP replies)\n *\n * This should be called from the Twilio webhook when a user replies STOP\n * UK law (PECR) requires honoring opt-out requests immediately\n *\n * PECR Requirement: Must stop sending marketing messages within 28 days\n * Best practice: Honor immediately\n */\nexport async function handleSMSOptOut(phoneNumber: string): Promise<{\n  success: boolean;\n  usersUpdated: number;\n  error?: string;\n}> {\n  try {\n    // Normalize phone number to E.164 format\n    const normalizedPhone = formatUKPhone(phoneNumber) || phoneNumber;\n\n    logInfo('Processing SMS opt-out request', { phoneNumber: normalizedPhone });\n\n    // Find all users with this phone number (could be multiple if phone shared)\n    const usersSnapshot = await db\n      .collection('users')\n      .where('phoneNumber', '==', normalizedPhone)\n      .get();\n\n    if (usersSnapshot.empty) {\n      logWarn('No users found for opt-out phone number', { phoneNumber: normalizedPhone });\n      return {\n        success: true,\n        usersUpdated: 0,\n      };\n    }\n\n    // Update all matching users\n    const batch = db.batch();\n    const now = Timestamp.now();\n\n    usersSnapshot.docs.forEach((doc) => {\n      batch.update(doc.ref, {\n        'collectionsConsent.smsConsent': false,\n        'collectionsConsent.smsOptedOut': true,\n        'collectionsConsent.smsOptOutDate': now,\n        updatedAt: now,\n      });\n    });\n\n    await batch.commit();\n\n    logInfo('SMS opt-out processed successfully', {\n      phoneNumber: normalizedPhone,\n      usersUpdated: usersSnapshot.size,\n    });\n\n    return {\n      success: true,\n      usersUpdated: usersSnapshot.size,\n    };\n  } catch (error: any) {\n    logError('Failed to process SMS opt-out', error, { phoneNumber });\n    return {\n      success: false,\n      usersUpdated: 0,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Validate phone number format\n */\nexport function isValidUKPhone(phone: string): boolean {\n  // Basic UK phone validation (E.164 format)\n  const ukPhoneRegex = /^\\+44[1-9]\\d{9,10}$/;\n  return ukPhoneRegex.test(phone);\n}\n\n/**\n * Format UK phone to E.164\n * Converts various UK formats to +44xxxxxxxxxx\n */\nexport function formatUKPhone(phone: string): string | null {\n  // Remove all spaces, dashes, parentheses\n  const cleaned = phone.replace(/[\\s\\-\\(\\)]/g, '');\n\n  // Convert 07xxx to +447xxx\n  if (cleaned.startsWith('07')) {\n    return '+44' + cleaned.substring(1);\n  }\n\n  // Convert 447xxx to +447xxx\n  if (cleaned.startsWith('447')) {\n    return '+' + cleaned;\n  }\n\n  // Already in E.164 format\n  if (cleaned.startsWith('+44')) {\n    return cleaned;\n  }\n\n  return null;\n}\n","import { NextResponse } from 'next/server';\nimport { ZodError } from 'zod';\n\n// Custom error classes\nexport class ApiError extends Error {\n  constructor(\n    public statusCode: number,\n    message: string,\n    public code?: string\n  ) {\n    super(message);\n    this.name = 'ApiError';\n  }\n}\n\nexport class ValidationError extends ApiError {\n  constructor(message: string, public details?: any) {\n    super(400, message, 'VALIDATION_ERROR');\n  }\n}\n\nexport class UnauthorizedError extends ApiError {\n  constructor(message: string = 'Unauthorized') {\n    super(401, message, 'UNAUTHORIZED');\n  }\n}\n\nexport class ForbiddenError extends ApiError {\n  constructor(message: string = 'Forbidden') {\n    super(403, message, 'FORBIDDEN');\n  }\n}\n\nexport class NotFoundError extends ApiError {\n  constructor(message: string = 'Not found') {\n    super(404, message, 'NOT_FOUND');\n  }\n}\n\nexport class RateLimitError extends ApiError {\n  constructor(message: string = 'Rate limit exceeded', public retryAfter?: number) {\n    super(429, message, 'RATE_LIMIT');\n  }\n}\n\nexport class InternalError extends ApiError {\n  constructor(message: string = 'Internal server error') {\n    super(500, message, 'INTERNAL_ERROR');\n  }\n}\n\n// Common error constructors\nexport const errors = {\n  unauthorized: (message = 'Unauthorized') => new UnauthorizedError(message),\n  forbidden: (message = 'Forbidden') => new ForbiddenError(message),\n  notFound: (message = 'Not found') => new NotFoundError(message),\n  badRequest: (message: string) => new ValidationError(message),\n  internal: (message = 'Internal server error') => new InternalError(message),\n  rateLimit: (message = 'Rate limit exceeded', retryAfter?: number) =>\n    new RateLimitError(message, retryAfter),\n};\n\n// Error handler function\nexport function handleApiError(error: unknown): NextResponse {\n  // Handle custom API errors\n  if (error instanceof ApiError) {\n    const response: any = {\n      error: error.code,\n      message: error.message,\n    };\n\n    if (error instanceof ValidationError && error.details) {\n      response.details = error.details;\n    }\n\n    if (error instanceof RateLimitError && error.retryAfter) {\n      return NextResponse.json(response, {\n        status: error.statusCode,\n        headers: {\n          'Retry-After': error.retryAfter.toString(),\n        },\n      });\n    }\n\n    return NextResponse.json(response, { status: error.statusCode });\n  }\n\n  // Handle Zod validation errors\n  if (error instanceof ZodError) {\n    return NextResponse.json(\n      {\n        error: 'VALIDATION_ERROR',\n        message: 'Invalid request data',\n        details: error.issues,\n      },\n      { status: 400 }\n    );\n  }\n\n  // Handle unknown errors\n  console.error('Unhandled error:', error);\n\n  return NextResponse.json(\n    {\n      error: 'INTERNAL_ERROR',\n      message: 'An unexpected error occurred',\n    },\n    { status: 500 }\n  );\n}\n\n// Async error wrapper for API routes\nexport function withErrorHandling(\n  handler: (req: Request, context?: any) => Promise<NextResponse>\n) {\n  return async (req: Request, context?: any): Promise<NextResponse> => {\n    try {\n      return await handler(req, context);\n    } catch (error) {\n      return handleApiError(error);\n    }\n  };\n}\n","import { webcrypto as crypto } from 'node:crypto'\nimport { urlAlphabet as scopedUrlAlphabet } from './url-alphabet/index.js'\nexport { urlAlphabet } from './url-alphabet/index.js'\nconst POOL_SIZE_MULTIPLIER = 128\nlet pool, poolOffset\nfunction fillPool(bytes) {\n  if (!pool || pool.length < bytes) {\n    pool = Buffer.allocUnsafe(bytes * POOL_SIZE_MULTIPLIER)\n    crypto.getRandomValues(pool)\n    poolOffset = 0\n  } else if (poolOffset + bytes > pool.length) {\n    crypto.getRandomValues(pool)\n    poolOffset = 0\n  }\n  poolOffset += bytes\n}\nexport function random(bytes) {\n  fillPool((bytes |= 0))\n  return pool.subarray(poolOffset - bytes, poolOffset)\n}\nexport function customRandom(alphabet, defaultSize, getRandom) {\n  let mask = (2 << (31 - Math.clz32((alphabet.length - 1) | 1))) - 1\n  let step = Math.ceil((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    if (!size) return ''\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let i = step\n      while (i--) {\n        id += alphabet[bytes[i] & mask] || ''\n        if (id.length >= size) return id\n      }\n    }\n  }\n}\nexport function customAlphabet(alphabet, size = 21) {\n  return customRandom(alphabet, size, random)\n}\nexport function nanoid(size = 21) {\n  fillPool((size |= 0))\n  let id = ''\n  for (let i = poolOffset - size; i < poolOffset; i++) {\n    id += scopedUrlAlphabet[pool[i] & 63]\n  }\n  return id\n}\n","export const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n","// ============ APPLICATION CONSTANTS ============\n\nexport const APP_NAME = 'Relay';\nexport const APP_DESCRIPTION = 'Smart invoicing and payment tracking for freelancers';\n\n// ============ COMMISSION & PRICING ============\n\nexport const RELAY_COMMISSION_RATE = 0.03; // 3%\nexport const COLLECTIONS_DEMO_LIMIT_FREE = 1; // 1 free collection per month\n\n// ============ TIMING CONSTANTS ============\n\nexport const COLLECTION_DAY_7_REMINDER = 7; // Days after due date (Email)\nexport const COLLECTION_DAY_14_REMINDER = 14; // Days after due date (SMS - PREMIUM)\nexport const COLLECTION_DAY_21_REMINDER = 21; // Days after due date (Email)\nexport const COLLECTION_DAY_30_REMINDER = 30; // Days after due date (Physical Letter - PREMIUM)\nexport const COLLECTION_DAY_45_AGENCY_HANDOFF = 45; // Days after due date (Agency Escalation - PREMIUM)\nexport const PAYMENT_CONFIRMATION_TOKEN_EXPIRY_DAYS = 30;\nexport const NOTIFICATION_EXPIRY_DAYS = 30;\n\n// ============ NOTIFICATION CONSTANTS ============\n\nexport const NOTIFICATION_TYPES = {\n  INVOICE_DROUGHT: 'invoice_drought',\n  PAYMENT_DELAY: 'payment_delay',\n  WIN: 'win',\n  PREDICTION: 'prediction',\n  OPPORTUNITY: 'opportunity',\n  DAILY_DIGEST: 'daily_digest',\n} as const;\n\nexport const MAX_NOTIFICATIONS_PER_DAY = 3;\nexport const NOTIFICATION_CONFIDENCE_THRESHOLD = 0.6;\n\n// ============ STATUS CONSTANTS ============\n\nexport const INVOICE_STATUS = {\n  DRAFT: 'draft',\n  SENT: 'sent',\n  PAID: 'paid',\n  OVERDUE: 'overdue',\n  IN_COLLECTIONS: 'in_collections',\n  DISPUTED: 'disputed',\n  CANCELLED: 'cancelled',\n} as const;\n\nexport const PAYMENT_CONFIRMATION_STATUS = {\n  PENDING_CLIENT: 'pending_client',\n  CLIENT_CONFIRMED: 'client_confirmed',\n  BOTH_CONFIRMED: 'both_confirmed',\n  EXPIRED: 'expired',\n  CANCELLED: 'cancelled',\n} as const;\n\nexport const USER_STATUS = {\n  ACTIVE: 'active',\n  SUSPENDED: 'suspended',\n  DELETED: 'deleted',\n} as const;\n\n// ============ PAYMENT METHODS ============\n\nexport const PAYMENT_METHODS = {\n  BANK_TRANSFER: 'bank_transfer',\n  CARD: 'card',\n} as const;\n\n// ============ SUBSCRIPTION TIERS ============\n\nexport const SUBSCRIPTION_TIERS = {\n  FREE: 'free',\n  PAID: 'paid',\n} as const;\n\n// ============ BUSINESS TYPES ============\n\nexport const BUSINESS_TYPES = {\n  FREELANCER: 'freelancer',\n  AGENCY: 'agency',\n  CONSULTANT: 'consultant',\n} as const;\n\n// ============ GAMIFICATION CONSTANTS ============\n\nexport const ACHIEVEMENTS = {\n  FIRST_INVOICE: {\n    id: 'first_invoice',\n    name: 'First Invoice',\n    description: 'Created your first invoice',\n    threshold: 500,\n  },\n  COLLECTOR_5K: {\n    id: 'collector_5k',\n    name: 'Collector 5K',\n    description: 'Collected £5,000',\n    threshold: 5000,\n  },\n  COLLECTOR_50K: {\n    id: 'collector_50k',\n    name: 'Collector 50K',\n    description: 'Collected £50,000',\n    threshold: 50000,\n  },\n  RELIABLE: {\n    id: 'reliable',\n    name: 'Reliable',\n    description: '90% on-time payments',\n    threshold: 90,\n  },\n  WEEK_STREAK: {\n    id: 'week_streak',\n    name: 'Week Streak',\n    description: '7 days without overdue',\n    threshold: 7,\n  },\n  MONTH_STREAK: {\n    id: 'month_streak',\n    name: 'Month Streak',\n    description: '30 days without overdue',\n    threshold: 30,\n  },\n  TOP_100: {\n    id: 'top_100',\n    name: 'Top 100',\n    description: 'Ranked in top 100 users',\n    threshold: 100,\n  },\n} as const;\n\nexport const POINTS_PER_1000_COLLECTED = 1;\nexport const POINTS_PER_STREAK_DAY = 1;\nexport const POINTS_PER_BADGE = 10;\nexport const POINTS_PER_LEVEL = 100;\n\n// ============ REFERRAL CONSTANTS ============\n\nexport const REFERRAL_CREDIT_REFERRER = 5; // £5\nexport const REFERRAL_CREDIT_REFERRED = 5; // £5\n\n// ============ RATE LIMITING ============\n\nexport const RATE_LIMIT = {\n  GENERAL: { requests: 10, window: '10s' },\n  AUTH: { requests: 5, window: '60s' },\n  AI: { requests: 3, window: '60s' },\n} as const;\n\n// ============ CURRENCY ============\n\nexport const DEFAULT_CURRENCY = 'GBP';\nexport const SUPPORTED_CURRENCIES = ['GBP', 'USD', 'EUR'] as const;\n\n// ============ LANGUAGES ============\n\nexport const SUPPORTED_LANGUAGES = ['en', 'es', 'fr'] as const;\nexport const DEFAULT_LANGUAGE = 'en';\n\n// ============ TIMEZONES ============\n\nexport const DEFAULT_TIMEZONE = 'Europe/London';\n\n// ============ DEFAULT QUIET HOURS ============\n\nexport const DEFAULT_QUIET_HOURS = {\n  start: '21:00',\n  end: '08:00',\n} as const;\n\n// ============ EMAIL TEMPLATES ============\n\nexport const EMAIL_TEMPLATES = {\n  INVOICE: 'invoice',\n  REMINDER_DAY_7: 'reminder_day_7',\n  REMINDER_DAY_21: 'reminder_day_21',\n  PAYMENT_CONFIRMED: 'payment_confirmed',\n  NOTIFICATION: 'notification',\n} as const;\n\n// ============ VALIDATION CONSTANTS ============\n\nexport const VALIDATION = {\n  MAX_INVOICE_DESCRIPTION_LENGTH: 500,\n  MAX_CLIENT_NAME_LENGTH: 100,\n  MAX_BUSINESS_NAME_LENGTH: 100,\n  MAX_NOTE_LENGTH: 1000,\n  MIN_INVOICE_AMOUNT: 0.01,\n  MAX_INVOICE_AMOUNT: 1000000,\n  UK_ACCOUNT_NUMBER_LENGTH: 8,\n  UK_SORT_CODE_LENGTH: 6,\n} as const;\n","import { db, Timestamp, COLLECTIONS, FieldValue } from '@/lib/firebase';\nimport { Invoice, CollectionAttempt, User } from '@/types/models';\nimport { sendReminderDay7Email, sendReminderDay21Email } from '@/lib/sendgrid';\nimport { sendCollectionSMS } from '@/lib/twilio-sms';\nimport { sendCollectionLetter } from '@/lib/lob-letters';\nimport { NotFoundError } from '@/utils/error';\nimport { logDbOperation, logInfo, logError } from '@/utils/logger';\nimport { nanoid } from 'nanoid';\nimport {\n  COLLECTIONS_DEMO_LIMIT_FREE,\n  COLLECTION_DAY_7_REMINDER,\n  COLLECTION_DAY_14_REMINDER,\n  COLLECTION_DAY_21_REMINDER,\n  COLLECTION_DAY_30_REMINDER,\n} from '@/utils/constants';\n\n/**\n * Check if user can use collections demo (1 free per month for free users)\n */\nexport async function canUseCollectionsDemo(userId: string): Promise<{\n  canUse: boolean;\n  remaining: number;\n  resetDate: Date;\n  reason?: string;\n}> {\n  const startTime = Date.now();\n\n  // Get user document\n  const userDoc = await db.collection(COLLECTIONS.USERS).doc(userId).get();\n  if (!userDoc.exists) {\n    throw new NotFoundError('User not found');\n  }\n\n  const user = userDoc.data() as User;\n\n  // Paid users have unlimited collections\n  if (user.subscriptionTier === 'paid') {\n    return {\n      canUse: true,\n      remaining: -1, // -1 means unlimited\n      resetDate: new Date(), // Not applicable\n    };\n  }\n\n  // Free users: check monthly quota\n  const now = new Date();\n  const currentMonth = now.getMonth();\n  const currentYear = now.getFullYear();\n\n  // Calculate reset date (1st of next month)\n  const resetDate = new Date(currentYear, currentMonth + 1, 1);\n\n  // Get collections count for current month\n  const collectionsCount = user.collectionsDemoUsedThisMonth || 0;\n  const lastResetDate = user.lastDemoResetDate?.toDate();\n\n  // Check if we need to reset the count (new month)\n  let actualCollectionsCount = collectionsCount;\n  if (lastResetDate) {\n    const lastResetMonth = lastResetDate.getMonth();\n    const lastResetYear = lastResetDate.getFullYear();\n\n    if (lastResetMonth !== currentMonth || lastResetYear !== currentYear) {\n      // Reset count for new month\n      actualCollectionsCount = 0;\n      await db.collection(COLLECTIONS.USERS).doc(userId).update({\n        collectionsDemoUsedThisMonth: 0,\n        lastDemoResetDate: Timestamp.fromDate(new Date(currentYear, currentMonth, 1)),\n      });\n    }\n  } else {\n    // First time using collections, initialize\n    await db.collection(COLLECTIONS.USERS).doc(userId).update({\n      collectionsDemoUsedThisMonth: 0,\n      lastDemoResetDate: Timestamp.fromDate(new Date(currentYear, currentMonth, 1)),\n    });\n    actualCollectionsCount = 0;\n  }\n\n  const remaining = Math.max(0, COLLECTIONS_DEMO_LIMIT_FREE - actualCollectionsCount);\n  const canUse = actualCollectionsCount < COLLECTIONS_DEMO_LIMIT_FREE;\n\n  logDbOperation('check_collections_quota', COLLECTIONS.USERS, userId, Date.now() - startTime);\n\n  return {\n    canUse,\n    remaining,\n    resetDate,\n    reason: canUse ? undefined : 'Monthly collections limit reached. Upgrade to Premium for unlimited collections.',\n  };\n}\n\n/**\n * Enable collections for an invoice\n */\nexport async function enableCollections(invoiceId: string, userId: string): Promise<Invoice> {\n  const startTime = Date.now();\n\n  // Get invoice\n  const invoiceDoc = await db.collection(COLLECTIONS.INVOICES).doc(invoiceId).get();\n  if (!invoiceDoc.exists) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  const invoice = invoiceDoc.data() as Invoice;\n\n  // Verify ownership\n  if (invoice.freelancerId !== userId) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  // Check if already enabled\n  if (invoice.collectionsEnabled) {\n    throw new Error('Collections already enabled for this invoice');\n  }\n\n  // Check quota\n  const quota = await canUseCollectionsDemo(userId);\n  if (!quota.canUse) {\n    throw new Error(quota.reason || 'Cannot enable collections');\n  }\n\n  // Enable collections\n  await invoiceDoc.ref.update({\n    collectionsEnabled: true,\n    collectionsEnabledAt: Timestamp.now(),\n    updatedAt: Timestamp.now(),\n  });\n\n  // Increment user's collections count (atomic operation to prevent race conditions)\n  await db.collection(COLLECTIONS.USERS).doc(userId).update({\n    collectionsDemoUsedThisMonth: FieldValue.increment(1),\n  });\n\n  logDbOperation('enable_collections', COLLECTIONS.INVOICES, invoiceId, Date.now() - startTime);\n\n  return { ...invoice, collectionsEnabled: true };\n}\n\n/**\n * Process collections reminders (day 7 and day 21)\n * This is called by the cron job\n */\nexport async function processCollections(): Promise<{\n  day7Count: number;\n  day21Count: number;\n  errors: string[];\n}> {\n  const startTime = Date.now();\n  const now = Timestamp.now();\n  const errors: string[] = [];\n  let day7Count = 0;\n  let day21Count = 0;\n\n  try {\n    // Get all overdue invoices with collections enabled\n    const snapshot = await db\n      .collection(COLLECTIONS.INVOICES)\n      .where('status', '==', 'overdue')\n      .where('collectionsEnabled', '==', true)\n      .get();\n\n    logInfo('Processing overdue invoices for collections', { invoiceCount: snapshot.size });\n\n    for (const doc of snapshot.docs) {\n      const invoice = doc.data() as Invoice;\n\n      try {\n        // Calculate days overdue\n        const dueDate = invoice.dueDate.toDate();\n        const daysOverdue = Math.floor((now.toDate().getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24));\n\n        logInfo('Invoice overdue check', { invoiceRef: invoice.reference, daysOverdue });\n\n        // Check if we should send day 7 reminder\n        if (daysOverdue >= COLLECTION_DAY_7_REMINDER && !invoice.firstReminderSentAt) {\n          logInfo('Sending day 7 reminder', { invoiceRef: invoice.reference });\n\n          // Get freelancer details\n          const userDoc = await db.collection(COLLECTIONS.USERS).doc(invoice.freelancerId).get();\n          const freelancerName = userDoc.exists ? userDoc.data()?.fullName || 'Freelancer' : 'Freelancer';\n\n          // Send email\n          await sendReminderDay7Email({\n            toEmail: invoice.clientEmail,\n            freelancerName,\n            invoiceReference: invoice.reference,\n            amount: invoice.amount,\n            currency: invoice.currency || 'GBP',\n            dueDate: invoice.dueDate.toDate(),\n            daysOverdue,\n          });\n\n          // Create collection attempt record\n          await db.collection(COLLECTIONS.COLLECTION_ATTEMPTS).add({\n            attemptId: nanoid(),\n            invoiceId: invoice.invoiceId,\n            freelancerId: invoice.freelancerId,\n            attemptType: 'email_reminder',\n            attemptDate: now,\n            attemptNumber: 1,\n            result: 'success',\n\n\n            createdAt: now,\n          });\n\n          // Update invoice (atomic increment to prevent race conditions)\n          await doc.ref.update({\n            firstReminderSentAt: now,\n            collectionsAttempts: FieldValue.increment(1),\n            updatedAt: now,\n          });\n\n          day7Count++;\n        }\n\n        // Check if we should send day 14 SMS reminder (PREMIUM)\n        if (daysOverdue >= COLLECTION_DAY_14_REMINDER) {\n          // Get existing attempt to check if SMS already sent\n          const attemptQuery = await db\n            .collection(COLLECTIONS.COLLECTION_ATTEMPTS)\n            .where('invoiceId', '==', invoice.invoiceId)\n            .where('sms_day_14_sent', '==', true)\n            .limit(1)\n            .get();\n\n          if (attemptQuery.empty) {\n            logInfo('Checking Day 14 SMS eligibility', { invoiceRef: invoice.reference });\n\n            // Get user details for SMS consent and phone\n            const userDoc = await db.collection(COLLECTIONS.USERS).doc(invoice.freelancerId).get();\n            if (!userDoc.exists) {\n              logError('User not found for SMS', new Error('User not found'), { userId: invoice.freelancerId });\n            } else {\n              const user = userDoc.data() as User;\n\n              // Check SMS consent and subscription tier\n              const hasConsent = user.collectionsConsent?.smsConsent && !user.collectionsConsent?.smsOptedOut;\n              const isPaidUser = user.subscriptionTier === 'paid';\n\n              if (hasConsent && isPaidUser && user.phoneNumber) {\n                try {\n                  // Send SMS via Twilio\n                  const smsResult = await sendCollectionSMS({\n                    recipientPhone: user.phoneNumber,\n                    invoiceReference: invoice.reference,\n                    amount: invoice.amount,\n                    dueDate: invoice.dueDate.toDate().toLocaleDateString('en-GB'),\n                    template: 'urgent_reminder',\n                    paymentLink: invoice.stripePaymentLinkUrl,\n                    businessName: user.businessName || 'Relay',\n                    invoiceId: invoice.invoiceId,\n                    freelancerId: invoice.freelancerId,\n                  });\n\n                  if (smsResult.success) {\n                    // Create collection attempt record with SMS flag\n                    await db.collection(COLLECTIONS.COLLECTION_ATTEMPTS).add({\n                      attemptId: nanoid(),\n                      invoiceId: invoice.invoiceId,\n                      freelancerId: invoice.freelancerId,\n                      attemptType: 'sms_reminder',\n                      attemptDate: now,\n                      attemptNumber: 2, // Day 14 is attempt #2\n                      result: 'success',\n                      sms_day_14_sent: true,\n                      sms_day_14_sid: smsResult.messageSid,\n                      sms_day_14_sent_at: now,\n                      createdAt: now,\n                    });\n\n                    logInfo('SMS Day 14 sent successfully', {\n                      invoiceRef: invoice.reference,\n                      messageSid: smsResult.messageSid,\n                    });\n                  } else {\n                    logError('SMS Day 14 failed', new Error(smsResult.error || 'Unknown error'), {\n                      invoiceRef: invoice.reference,\n                    });\n                  }\n                } catch (error) {\n                  logError('SMS Day 14 exception', error, { invoiceRef: invoice.reference });\n                }\n              } else {\n                logInfo('SMS Day 14 skipped - no consent or not paid tier', {\n                  invoiceRef: invoice.reference,\n                  hasConsent,\n                  isPaidUser,\n                  hasPhone: !!user.phoneNumber,\n                });\n              }\n            }\n          }\n        }\n\n        // Check if we should send day 21 reminder\n        if (daysOverdue >= COLLECTION_DAY_21_REMINDER && !invoice.secondReminderSentAt) {\n          logInfo('Sending day 21 reminder', { invoiceRef: invoice.reference });\n\n          // Get freelancer details\n          const userDoc = await db.collection(COLLECTIONS.USERS).doc(invoice.freelancerId).get();\n          const freelancerName = userDoc.exists ? userDoc.data()?.fullName || 'Freelancer' : 'Freelancer';\n\n          // Send email\n          await sendReminderDay21Email({\n            toEmail: invoice.clientEmail,\n            freelancerName,\n            invoiceReference: invoice.reference,\n            amount: invoice.amount,\n            currency: invoice.currency || 'GBP',\n            dueDate: invoice.dueDate.toDate(),\n            daysOverdue,\n          });\n\n          // Create collection attempt record\n          await db.collection(COLLECTIONS.COLLECTION_ATTEMPTS).add({\n            attemptId: nanoid(),\n            invoiceId: invoice.invoiceId,\n            freelancerId: invoice.freelancerId,\n            attemptType: 'email_reminder',\n            attemptDate: now,\n            attemptNumber: 2,\n            result: 'success',\n            createdAt: now,\n          });\n\n          // Update invoice (atomic increment to prevent race conditions)\n          await doc.ref.update({\n            secondReminderSentAt: now,\n            collectionsAttempts: FieldValue.increment(1),\n            updatedAt: now,\n            status: 'in_collections', // Move to collections status\n          });\n\n          day21Count++;\n        }\n\n        // Check if we should send day 30 physical letter (PREMIUM)\n        if (daysOverdue >= COLLECTION_DAY_30_REMINDER) {\n          // Get existing attempt to check if letter already sent\n          const attemptQuery = await db\n            .collection(COLLECTIONS.COLLECTION_ATTEMPTS)\n            .where('invoiceId', '==', invoice.invoiceId)\n            .where('letter_day_30_sent', '==', true)\n            .limit(1)\n            .get();\n\n          if (attemptQuery.empty) {\n            logInfo('Checking Day 30 Letter eligibility', { invoiceRef: invoice.reference });\n\n            // Get user details\n            const userDoc = await db.collection(COLLECTIONS.USERS).doc(invoice.freelancerId).get();\n            if (!userDoc.exists) {\n              logError('User not found for letter', new Error('User not found'), { userId: invoice.freelancerId });\n            } else {\n              const user = userDoc.data() as User;\n\n              // Check consent, subscription tier, and business address\n              const hasConsent = user.collectionsConsent?.physicalMailConsent && !user.collectionsConsent?.physicalMailOptedOut;\n              const isPaidUser = user.subscriptionTier === 'paid';\n              const hasAddress = !!user.businessAddress;\n\n              if (!hasAddress) {\n                // Notify user to set business address\n                logInfo('Day 30 Letter skipped - no business address', { invoiceRef: invoice.reference });\n                // TODO: Send email notification to user to add business address\n              } else if (hasConsent && isPaidUser && user.businessAddress) {\n                try {\n                  // Send physical letter via Lob\n                  const letterResult = await sendCollectionLetter({\n                    recipient: {\n                      recipientName: invoice.clientName,\n                      line1: user.businessAddress.addressLine1,\n                      line2: user.businessAddress.addressLine2,\n                      city: user.businessAddress.city,\n                      postcode: user.businessAddress.postcode,\n                      country: 'GB',\n                    },\n                    invoiceReference: invoice.reference,\n                    amount: invoice.amount,\n                    dueDate: invoice.dueDate.toDate().toLocaleDateString('en-GB'),\n                    daysPastDue: daysOverdue,\n                    invoiceDate: invoice.invoiceDate.toDate().toLocaleDateString('en-GB'),\n                    template: 'final_warning',\n                    businessName: user.businessName || 'Relay',\n                    businessAddress: `${user.businessAddress.addressLine1}\\n${user.businessAddress.addressLine2 || ''}\\n${user.businessAddress.city}\\n${user.businessAddress.postcode}`,\n                    invoiceId: invoice.invoiceId,\n                    freelancerId: invoice.freelancerId,\n                  });\n\n                  if (letterResult.success) {\n                    // Create collection attempt record with letter flag\n                    await db.collection(COLLECTIONS.COLLECTION_ATTEMPTS).add({\n                      attemptId: nanoid(),\n                      invoiceId: invoice.invoiceId,\n                      freelancerId: invoice.freelancerId,\n                      attemptType: 'physical_letter',\n                      attemptDate: now,\n                      attemptNumber: 3, // Day 30 is attempt #3\n                      result: 'success',\n                      letter_day_30_sent: true,\n                      letter_day_30_lob_id: letterResult.letterId,\n                      letter_day_30_sent_at: now,\n                      letterTrackingUrl: letterResult.trackingUrl,\n                      createdAt: now,\n                    });\n\n                    logInfo('Letter Day 30 sent successfully', {\n                      invoiceRef: invoice.reference,\n                      letterId: letterResult.letterId,\n                    });\n                  } else {\n                    logError('Letter Day 30 failed', new Error(letterResult.error || 'Unknown error'), {\n                      invoiceRef: invoice.reference,\n                    });\n                  }\n                } catch (error) {\n                  logError('Letter Day 30 exception', error, { invoiceRef: invoice.reference });\n                }\n              } else {\n                logInfo('Letter Day 30 skipped - no consent or not paid tier', {\n                  invoiceRef: invoice.reference,\n                  hasConsent,\n                  isPaidUser,\n                  hasAddress,\n                });\n              }\n            }\n          }\n        }\n      } catch (error) {\n        const errorMsg = `Failed to process invoice ${invoice.reference}: ${error instanceof Error ? error.message : 'Unknown error'}`;\n        logError(errorMsg, error);\n        errors.push(errorMsg);\n      }\n    }\n\n    logDbOperation('process_collections', COLLECTIONS.INVOICES, undefined, Date.now() - startTime);\n\n    logInfo('Collections processing complete', { day7Count, day21Count });\n\n    return { day7Count, day21Count, errors };\n  } catch (error) {\n    logError('Collections processing failed', error);\n    throw error;\n  }\n}\n\n/**\n * Get collections history for an invoice\n */\nexport async function getCollectionsHistory(\n  invoiceId: string,\n  userId: string\n): Promise<CollectionAttempt[]> {\n  const startTime = Date.now();\n\n  // Verify invoice ownership\n  const invoiceDoc = await db.collection(COLLECTIONS.INVOICES).doc(invoiceId).get();\n  if (!invoiceDoc.exists) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  const invoice = invoiceDoc.data() as Invoice;\n  if (invoice.freelancerId !== userId) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  // Get collection attempts\n  const snapshot = await db\n    .collection(COLLECTIONS.COLLECTION_ATTEMPTS)\n    .where('invoiceId', '==', invoiceId)\n    .orderBy('sentAt', 'desc')\n    .get();\n\n  logDbOperation('get_collections_history', COLLECTIONS.COLLECTION_ATTEMPTS, undefined, Date.now() - startTime);\n\n  return snapshot.docs.map((doc) => doc.data() as CollectionAttempt);\n}\n\n/**\n * Disable collections for an invoice\n */\nexport async function disableCollections(invoiceId: string, userId: string): Promise<Invoice> {\n  const startTime = Date.now();\n\n  // Get invoice\n  const invoiceDoc = await db.collection(COLLECTIONS.INVOICES).doc(invoiceId).get();\n  if (!invoiceDoc.exists) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  const invoice = invoiceDoc.data() as Invoice;\n\n  // Verify ownership\n  if (invoice.freelancerId !== userId) {\n    throw new NotFoundError('Invoice not found');\n  }\n\n  // Disable collections\n  await invoiceDoc.ref.update({\n    collectionsEnabled: false,\n    updatedAt: Timestamp.now(),\n  });\n\n  logDbOperation('disable_collections', COLLECTIONS.INVOICES, invoiceId, Date.now() - startTime);\n\n  return { ...invoice, collectionsEnabled: false };\n}\n\r\n"],"names":[],"mappings":"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","ignoreList":[0,3,4]}
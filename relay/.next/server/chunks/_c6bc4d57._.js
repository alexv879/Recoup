module.exports=[15776,e=>{"use strict";var t=e.i(89171),r=e.i(15874);class a extends Error{statusCode;code;constructor(e,t,r){super(t),this.statusCode=e,this.code=r,this.name="ApiError"}}class n extends a{details;constructor(e,t){super(400,e,"VALIDATION_ERROR"),this.details=t}}class s extends a{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class o extends a{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class i extends a{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class l extends a{retryAfter;constructor(e="Rate limit exceeded",t){super(429,e,"RATE_LIMIT"),this.retryAfter=t}}class d extends a{constructor(e="Internal server error"){super(500,e,"INTERNAL_ERROR")}}function u(e){if(e instanceof a){let r={error:e.code,message:e.message};return(e instanceof n&&e.details&&(r.details=e.details),e instanceof l&&e.retryAfter)?t.NextResponse.json(r,{status:e.statusCode,headers:{"Retry-After":e.retryAfter.toString()}}):t.NextResponse.json(r,{status:e.statusCode})}return e instanceof r.ZodError?t.NextResponse.json({error:"VALIDATION_ERROR",message:"Invalid request data",details:e.issues},{status:400}):(console.error("Unhandled error:",e),t.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500}))}e.s(["NotFoundError",()=>i,"errors",0,{unauthorized:(e="Unauthorized")=>new s(e),forbidden:(e="Forbidden")=>new o(e),notFound:(e="Not found")=>new i(e),badRequest:e=>new n(e),internal:(e="Internal server error")=>new d(e),rateLimit:(e="Rate limit exceeded",t)=>new l(e,t)},"handleApiError",()=>u])},36485,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(84243),s=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),d=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),R=e.i(66012),h=e.i(70101),f=e.i(26937),m=e.i(10372),w=e.i(93695);e.i(52474);var v=e.i(220),E=e.i(89171),g=e.i(7218),A=e.i(35686),x=e.i(15776),b=e.i(963),C=e.i(69907);async function N(e){let t=Date.now(),r="POST",a="/api/transcribe";try{let{userId:n}=await (0,g.auth)();if(!n)throw x.errors.unauthorized();(0,C.logApiRequest)(r,a,n);let{success:s,remaining:o,reset:i}=await (0,b.checkRateLimit)(n,b.aiRatelimit);if(!s)throw x.errors.rateLimit(`Rate limit exceeded. Try again in ${Math.ceil((i-Date.now())/1e3)} seconds`,i);let l=(await e.formData()).get("audio");if(!l)throw x.errors.badRequest("Audio file is required");if(!["audio/mpeg","audio/mp4","audio/wav","audio/webm","audio/x-m4a"].includes(l.type))throw x.errors.badRequest("Invalid file type. Supported formats: mp3, mp4, wav, webm, m4a");if(l.size>0xa00000)throw x.errors.badRequest("File size exceeds 10MB limit");console.log(`ðŸŽ¤ Transcribing audio file: ${l.name} (${l.size} bytes)`);let d=await l.arrayBuffer(),u=Buffer.from(d),c=Date.now(),p=await (0,A.transcribeAudio)(u);(0,C.logExternalApiCall)("OpenAI Whisper","transcribe",Date.now()-c),console.log(`âœ… Transcription: "${p}"`);let R=Date.now(),h=await (0,A.parseInvoiceFromTranscription)(p);(0,C.logExternalApiCall)("OpenAI GPT-4","parse",Date.now()-R),console.log(`âœ… Parsed invoice data:`,h);let f=Date.now()-t;return(0,C.logApiResponse)(r,a,200,f,n),E.NextResponse.json({text:p,invoiceData:h,remainingRequests:o},{headers:{"X-RateLimit-Remaining":o.toString()}})}catch(r){let e=Date.now()-t;return(0,C.logExternalApiCall)("OpenAI","transcribe",e,r),(0,x.handleApiError)(r)}}e.s(["POST",()=>N,"dynamic",0,"force-dynamic"],97996);var y=e.i(97996);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/transcribe/route",pathname:"/api/transcribe",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/transcribe/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:O,workUnitAsyncStorage:I,serverHooks:_}=T;function P(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:I})}async function D(e,t,a){T.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/transcribe/route";E=E.replace(/\/index$/,"")||"/";let g=await T.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:x,nextConfig:b,parsedUrl:C,isDraftMode:N,prerenderManifest:y,routerServerContext:O,isOnDemandRevalidate:I,revalidateOnlyGenerated:_,resolvedPathname:P,clientReferenceManifest:D,serverActionsManifest:S}=g,q=(0,l.normalizeAppPath)(E),U=!!(y.dynamicRoutes[q]||y.routes[P]),M=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,C,!1):t.end("This page could not be found"),null);if(U&&!N){let e=!!y.routes[P],t=y.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await M();throw new w.NoFallbackError}}let H=null;!U||T.isDev||N||(H="/index"===(H=P)?"/":H);let k=!0===T.isDev||!U,F=U&&!k;S&&D&&(0,o.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:D,serverActionsManifest:S,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:S})});let j=e.method||"GET",L=(0,s.getTracer)(),$=L.getActiveScopeSpan(),B={params:x,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>T.onRequestError(e,t,a,O)},sharedContext:{buildId:A}},z=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(z,(0,u.signalFromNodeResponse)(t));try{let o=async e=>T.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${E}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&I&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!U)return await (0,R.sendResponse)(z,K,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})},O),t}},u=await T.handleResponse({req:e,nextConfig:b,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:_,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!U)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",I?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&U||c.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,R.sendResponse)(z,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await l($):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${j} ${E}`,kind:s.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})}),U)throw t;return await (0,R.sendResponse)(z,K,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>P,"routeModule",()=>T,"serverHooks",()=>_,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>I],36485)},29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c3778b6d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=_c6bc4d57._.js.map
module.exports=[59082,e=>e.a(async(t,a)=>{try{var r=e.i(68253),n=e.i(69907),o=t([r]);async function i(e){let t=Date.now();try{let a=(await r.db.collection(r.COLLECTIONS.INVOICES).where("freelancerId","==",e).get()).docs.map(e=>e.data()),o=a.length,i=a.filter(e=>"paid"===e.status).length,l=a.filter(e=>"overdue"===e.status).length,s=a.filter(e=>"paid"===e.status&&e.collectionsEnabled).length,c=a.filter(e=>"paid"===e.status&&e.paidAt),d=c.length>0?c.reduce((e,t)=>{let a=t.dueDate.toDate(),r=t.paidAt.toDate(),n=Math.floor((r.getTime()-a.getTime())/864e5);return e+n},0)/c.length:0;return(0,n.logDbOperation)("get_invoice_stats",r.COLLECTIONS.INVOICES,e,Date.now()-t),{total:o,paid:i,overdue:l,collected:s,avgPaymentDays:Math.round(10*d)/10}}catch(e){throw(0,n.logError)("Failed to get invoice stats",e),e}}async function l(e){let t=Date.now();try{let a=(await r.db.collection(r.COLLECTIONS.COLLECTION_ATTEMPTS).where("freelancerId","==",e).get()).docs.map(e=>e.data()),o={},i=0,l=0;a.forEach(e=>{let t=e.result||"pending";o[t]=(o[t]||0)+1,"success"===e.result&&(i++,l+=e.paymentRecovered||0)});let s=a.length>0?i/a.length*100:0;return(0,n.logDbOperation)("get_collection_stats",r.COLLECTIONS.COLLECTION_ATTEMPTS,e,Date.now()-t),{attempts:a.length,successRate:Math.round(10*s)/10,revenue:l,outcomes:o}}catch(e){throw(0,n.logError)("Failed to get collection stats",e),e}}async function s(e,t=12){let a=Date.now();try{let o=new Date,i=new Date(o.getFullYear(),o.getMonth()-t,1),l=(await r.db.collection(r.COLLECTIONS.INVOICES).where("freelancerId","==",e).where("status","==","paid").get()).docs.map(e=>e.data()).filter(e=>e.paidAt&&e.paidAt.toDate()>=i),s={};l.forEach(e=>{let t=e.paidAt.toDate(),a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;s[a]||(s[a]={revenue:0,collections:0}),s[a].revenue+=e.amount,e.collectionsEnabled&&s[a].collections++});let c=[],d=0;for(let e=0;e<t;e++){let a=new Date(o.getFullYear(),o.getMonth()-(t-e-1),1),r=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,n=s[r]||{revenue:0,collections:0},i=d>0?(n.revenue-d)/d*100:0;c.push({month:r,revenue:n.revenue,collections:n.collections,growth:Math.round(10*i)/10}),d=n.revenue}return(0,n.logDbOperation)("get_revenue_by_month",r.COLLECTIONS.INVOICES,e,Date.now()-a),c}catch(e){throw(0,n.logError)("Failed to get revenue by month",e),e}}async function c(e){let t=Date.now();try{let a=(await r.db.collection(r.COLLECTIONS.INVOICES).where("freelancerId","==",e).get()).docs.map(e=>e.data()),o={};a.forEach(e=>{o[e.clientEmail]||(o[e.clientEmail]={clientName:e.clientName,invoices:[]}),o[e.clientEmail].invoices.push(e)});let i=Object.values(o).map(e=>{let t=e.invoices.reduce((e,t)=>e+t.amount,0),a=e.invoices.filter(e=>"paid"===e.status),r=a.reduce((e,t)=>e+t.amount,0),n=a.length>0?a.reduce((e,t)=>{if(!t.paidAt)return e;let a=t.dueDate.toDate(),r=t.paidAt.toDate(),n=Math.floor((r.getTime()-a.getTime())/864e5);return e+n},0)/a.length:0,o=e.invoices.some(e=>"overdue"===e.status);return{clientName:e.clientName,totalInvoiced:t,totalPaid:r,avgPaymentDays:Math.round(10*n)/10,status:o?"overdue":n>7?"slow":"good"}});return i.sort((e,t)=>t.totalInvoiced-e.totalInvoiced),(0,n.logDbOperation)("get_client_breakdown",r.COLLECTIONS.INVOICES,e,Date.now()-t),i}catch(e){throw(0,n.logError)("Failed to get client breakdown",e),e}}async function d(e,t=5){return(await c(e)).slice(0,t)}async function u(e){let t=Date.now();try{let a=(await r.db.collection(r.COLLECTIONS.INVOICES).where("freelancerId","==",e).where("status","==","overdue").where("collectionsEnabled","==",!1).get()).docs.map(e=>e.data());return(0,n.logDbOperation)("get_at_risk_invoices",r.COLLECTIONS.INVOICES,e,Date.now()-t),a}catch(e){throw(0,n.logError)("Failed to get at-risk invoices",e),e}}async function p(e,t=3){let a=await s(e,6);if(a.length<3)return 0;let r=a.slice(-3).reduce((e,t)=>e+t.revenue,0)/3;return Math.round(r*t)}async function h(e){let t=Date.now();try{let a=await r.db.collection(r.COLLECTIONS.USER_STATS).doc(e).get();if(!a.exists)return{rank:0,totalUsers:0,percentile:0};let o=a.data().gamificationXP||0,i=await r.db.collection(r.COLLECTIONS.USER_STATS).where("gamificationXP",">",0).orderBy("gamificationXP","desc").get(),l=i.size,s=1;for(let e of i.docs)if(e.data().gamificationXP>o)s++;else break;let c=l>0?(l-s+1)/l*100:0;return(0,n.logDbOperation)("get_user_rank",r.COLLECTIONS.USER_STATS,e,Date.now()-t),{rank:s,totalUsers:l,percentile:Math.round(c)}}catch(e){throw(0,n.logError)("Failed to get user rank",e),e}}async function g(e=10,t="xp"){let a=Date.now();try{let o=r.db.collection(r.COLLECTIONS.USER_STATS);"xp"===t?o=o.orderBy("gamificationXP","desc"):"recovery"===t&&(o=o.orderBy("totalCollected","desc"));let i=await o.limit(e).get(),l=await Promise.all(i.docs.map(async(e,a)=>{let n=e.data(),o=await r.db.collection(r.COLLECTIONS.USERS).doc(n.userId).get(),i=o.exists?o.data():null;return{rank:a+1,userId:n.userId,name:i?.name||"Anonymous",metric:"xp"===t?n.gamificationXP:"recovery"===t?n.totalCollected:0,value:"xp"===t?`${n.gamificationXP} XP`:"recovery"===t?`\xa3${n.totalCollected}`:""}}));return(0,n.logDbOperation)("get_top_users",r.COLLECTIONS.USER_STATS,void 0,Date.now()-a),l}catch(e){throw(0,n.logError)("Failed to get top users",e),e}}async function v(e){let t=[];try{let a=await i(e);a.overdue>0&&t.push(`You have ${a.overdue} overdue invoice${a.overdue>1?"s":""}. Consider enabling collections to recover payment faster.`),a.avgPaymentDays>14&&t.push(`Your clients take an average of ${a.avgPaymentDays} days to pay. Industry average is 7-14 days. Consider sending earlier reminders.`),a.collected>0&&t.push(`Great work! You've successfully collected ${a.collected} invoice${a.collected>1?"s":""} using Relay's automated collections.`);let r=await u(e);r.length>0&&t.push(`${r.length} overdue invoice${r.length>1?"s are":" is"} at risk. Enable collections to prevent further delays.`);let n=await h(e);return n.percentile>75&&t.push(`You're in the top ${100-n.percentile}% of Relay users! Keep up the great work.`),t}catch(e){return(0,n.logError)("Failed to generate insights",e),[]}}[r]=o.then?(await o)():o,e.s(["generateInsights",()=>v,"getCollectionStats",()=>l,"getInvoiceStats",()=>i,"getPredictedRevenue",()=>p,"getRevenueByMonth",()=>s,"getTopClients",()=>d,"getTopUsers",()=>g,"getUserRank",()=>h]),a()}catch(e){a(e)}},!1),46358,e=>e.a(async(t,a)=>{try{var r=e.i(89171),n=e.i(7218),o=e.i(59082),i=e.i(69907),l=t([o]);async function s(e){try{let{userId:e}=await (0,n.auth)();if(!e)return r.NextResponse.json({error:"Unauthorized"},{status:401});let[t,a,i,l]=await Promise.all([(0,o.getInvoiceStats)(e),(0,o.getCollectionStats)(e),(0,o.getTopClients)(e,5),(0,o.getPredictedRevenue)(e,1)]),s=l>(a.revenue||0)?"up":l<(a.revenue||0)?"down":"stable";return r.NextResponse.json({invoices:t,collections:a,topClients:i,predictions:{nextMonthRevenue:l,trend:s}})}catch(e){return(0,i.logError)("Failed to get dashboard stats",e),r.NextResponse.json({error:"Failed to get dashboard stats"},{status:500})}}[o]=l.then?(await l)():l,e.s(["GET",()=>s]),a()}catch(e){a(e)}},!1),47502,e=>e.a(async(t,a)=>{try{var r=e.i(47909),n=e.i(74017),o=e.i(96250),i=e.i(84243),l=e.i(61916),s=e.i(14444),c=e.i(37092),d=e.i(69741),u=e.i(16795),p=e.i(87718),h=e.i(95169),g=e.i(47587),v=e.i(66012),w=e.i(70101),E=e.i(26937),f=e.i(10372),C=e.i(93695);e.i(52474);var m=e.i(220),y=e.i(46358),R=t([y]);[y]=R.then?(await R)():R;let T=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/dashboard/stats/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:I,workUnitAsyncStorage:b,serverHooks:N}=T;function O(){return(0,o.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:b})}async function S(e,t,a){T.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/dashboard/stats/route";r=r.replace(/\/index$/,"")||"/";let o=await T.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:R,nextConfig:O,parsedUrl:S,isDraftMode:I,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:_,revalidateOnlyGenerated:D,resolvedPathname:A,clientReferenceManifest:x,serverActionsManifest:P}=o,L=(0,d.normalizeAppPath)(r),M=!!(b.dynamicRoutes[L]||b.routes[A]),k=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,S,!1):t.end("This page could not be found"),null);if(M&&!I){let e=!!b.routes[A],t=b.dynamicRoutes[L];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await k();throw new C.NoFallbackError}}let U=null;!M||T.isDev||I||(U=A,U="/index"===U?"/":U);let $=!0===T.isDev||!M,F=M&&!$;P&&x&&(0,s.setReferenceManifestsSingleton)({page:r,clientReferenceManifest:x,serverActionsManifest:P,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",q=(0,l.getTracer)(),j=q.getActiveScopeSpan(),V={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>T.onRequestError(e,t,r,N)},sharedContext:{buildId:y}},X=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(X,(0,p.signalFromNodeResponse)(t));try{let o=async e=>T.handle(K,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${r}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var l,c;let d=async({previousCacheEntry:n})=>{try{if(!s&&_&&D&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(i);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=V.renderOpts.collectedTags;if(!M)return await (0,v.sendResponse)(X,B,r,V.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,w.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,n=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:_})},N),t}},u=await T.handleResponse({req:e,nextConfig:O,cacheKey:U,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:D,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!M)return null;if((null==u||null==(l=u.value)?void 0:l.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",_?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,w.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&M||p.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,E.getCacheControlHeader)(u.cacheControl)),await (0,v.sendResponse)(X,B,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};j?await c(j):await q.withPropagatedContext(e.headers,()=>q.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${r}`,kind:l.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof C.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:L,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:_})}),M)throw t;return await (0,v.sendResponse)(X,B,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>O,"routeModule",()=>T,"serverHooks",()=>N,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>b]),a()}catch(e){a(e)}},!1),29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c3778b6d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=_05456214._.js.map
module.exports=[15776,e=>{"use strict";var t=e.i(89171),r=e.i(15874);class a extends Error{statusCode;code;constructor(e,t,r){super(t),this.statusCode=e,this.code=r,this.name="ApiError"}}class n extends a{details;constructor(e,t){super(400,e,"VALIDATION_ERROR"),this.details=t}}class i extends a{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class o extends a{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class s extends a{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class l extends a{retryAfter;constructor(e="Rate limit exceeded",t){super(429,e,"RATE_LIMIT"),this.retryAfter=t}}class d extends a{constructor(e="Internal server error"){super(500,e,"INTERNAL_ERROR")}}function c(e){if(e instanceof a){let r={error:e.code,message:e.message};return(e instanceof n&&e.details&&(r.details=e.details),e instanceof l&&e.retryAfter)?t.NextResponse.json(r,{status:e.statusCode,headers:{"Retry-After":e.retryAfter.toString()}}):t.NextResponse.json(r,{status:e.statusCode})}return e instanceof r.ZodError?t.NextResponse.json({error:"VALIDATION_ERROR",message:"Invalid request data",details:e.issues},{status:400}):(console.error("Unhandled error:",e),t.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500}))}e.s(["NotFoundError",()=>s,"errors",0,{unauthorized:(e="Unauthorized")=>new i(e),forbidden:(e="Forbidden")=>new o(e),notFound:(e="Not found")=>new s(e),badRequest:e=>new n(e),internal:(e="Internal server error")=>new d(e),rateLimit:(e="Rate limit exceeded",t)=>new l(e,t)},"handleApiError",()=>c])},29323,e=>e.a(async(t,r)=>{try{var a=e.i(68253),n=e.i(55742),i=e.i(69907),o=t([a,n]);[a,n]=o.then?(await o)():o;let d=[0,100,250,500,1e3,2e3,3500,5500,8e3,11e3];async function s(e){var t;let r,n=Date.now(),o=await a.db.collection(a.COLLECTIONS.USER_STATS).where("userId","==",e).limit(1).get();if(o.empty)return{xp:0,level:1,xpForNextLevel:d[1],badges:[],currentStreak:0,longestStreak:0};let s=o.docs[0].data();return(0,i.logDbOperation)("get_gamification_stats",a.COLLECTIONS.USER_STATS,e,Date.now()-n),{xp:s.gamificationXP||0,level:s.gamificationLevel||1,xpForNextLevel:(t=s.gamificationXP||0,(r=function(e){let t=1;for(let r=0;r<d.length;r++)if(e>=d[r])t=r+1;else break;return t}(t))>=d.length?0:d[r]-t),badges:s.badges||[],currentStreak:s.currentStreak||0,longestStreak:s.longestStreak||0}}async function l(e=10){let t=Date.now(),r=await a.db.collection(a.COLLECTIONS.USER_STATS).orderBy("gamificationXP","desc").limit(e).get();return(0,i.logDbOperation)("get_leaderboard",a.COLLECTIONS.USER_STATS,void 0,Date.now()-t),r.docs.map(e=>{let t=e.data();return{userId:t.userId,xp:t.gamificationXP||0,level:t.gamificationLevel||1,badges:t.badges||[]}})}e.s(["BADGES",0,{FIRST_INVOICE:{id:"first_invoice",name:"First Invoice",description:"Created your first invoice",icon:"ðŸŽ‰",requirement:1},INVOICE_MASTER_5:{id:"invoice_master_5",name:"Invoice Master",description:"Created 5 invoices",icon:"ðŸ“„",requirement:5},INVOICE_MASTER_10:{id:"invoice_master_10",name:"Invoice Expert",description:"Created 10 invoices",icon:"ðŸ“‹",requirement:10},FIRST_PAYMENT:{id:"first_payment",name:"First Payment",description:"Received your first payment",icon:"ðŸ’°",requirement:1},PAYMENT_STREAK_7:{id:"payment_streak_7",name:"Week Streak",description:"Maintained a 7-day payment streak",icon:"ðŸ”¥",requirement:7},PAYMENT_STREAK_30:{id:"payment_streak_30",name:"Month Streak",description:"Maintained a 30-day payment streak",icon:"âš¡",requirement:30},QUICK_PAYER:{id:"quick_payer",name:"Quick Payer",description:"Received payment within 7 days",icon:"âš¡",requirement:1},COLLECTIONS_PRO:{id:"collections_pro",name:"Collections Pro",description:"Successfully collected an overdue payment",icon:"ðŸŽ¯",requirement:1},REFERRAL_CHAMPION:{id:"referral_champion",name:"Referral Champion",description:"Referred 3 users",icon:"ðŸ‘¥",requirement:3},REVENUE_1K:{id:"revenue_1k",name:"Â£1K Revenue",description:"Collected Â£1,000 in revenue",icon:"ðŸ’µ",requirement:1e3},REVENUE_10K:{id:"revenue_10k",name:"Â£10K Revenue",description:"Collected Â£10,000 in revenue",icon:"ðŸ’Ž",requirement:1e4}},"getGamificationStats",()=>s,"getLeaderboard",()=>l]),r()}catch(e){r(e)}},!1),84401,e=>e.a(async(t,r)=>{try{var a=e.i(89171),n=e.i(7218),i=e.i(29323),o=e.i(15776),s=e.i(69907),l=t([i]);async function d(e){let t=Date.now();try{let{userId:e}=await (0,n.auth)();if(!e)throw o.errors.unauthorized();(0,s.logApiRequest)("GET","/api/gamification/stats",e);let r=await (0,i.getGamificationStats)(e),l=r.badges.map(e=>Object.values(i.BADGES).find(t=>t.id===e)||{id:e,name:"Unknown",description:"",icon:"ðŸ†",requirement:0}),d=Date.now()-t;return(0,s.logApiResponse)("GET","/api/gamification/stats",200,d,e),a.NextResponse.json({xp:r.xp,level:r.level,xpForNextLevel:r.xpForNextLevel,badges:l,currentStreak:r.currentStreak,longestStreak:r.longestStreak})}catch(r){let e=Date.now()-t;return(0,s.logApiResponse)("GET","/api/gamification/stats",500,e),(0,o.handleApiError)(r)}}[i]=l.then?(await l)():l,e.s(["GET",()=>d,"dynamic",0,"force-dynamic"]),r()}catch(e){r(e)}},!1),41347,e=>e.a(async(t,r)=>{try{var a=e.i(47909),n=e.i(74017),i=e.i(96250),o=e.i(84243),s=e.i(61916),l=e.i(14444),d=e.i(37092),c=e.i(69741),u=e.i(16795),p=e.i(87718),R=e.i(95169),m=e.i(47587),h=e.i(66012),E=e.i(70101),f=e.i(26937),v=e.i(10372),g=e.i(93695);e.i(52474);var _=e.i(220),A=e.i(84401),y=t([A]);[A]=y.then?(await y)():y;let S=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/gamification/stats/route",pathname:"/api/gamification/stats",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/gamification/stats/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:w,workUnitAsyncStorage:N,serverHooks:T}=S;function x(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:N})}async function C(e,t,r){S.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/gamification/stats/route";a=a.replace(/\/index$/,"")||"/";let i=await S.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:y,nextConfig:x,parsedUrl:C,isDraftMode:w,prerenderManifest:N,routerServerContext:T,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,resolvedPathname:b,clientReferenceManifest:k,serverActionsManifest:P}=i,q=(0,c.normalizeAppPath)(a),D=!!(N.dynamicRoutes[q]||N.routes[b]),U=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,C,!1):t.end("This page could not be found"),null);if(D&&!w){let e=!!N.routes[b],t=N.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let L=null;!D||S.isDev||w||(L=b,L="/index"===L?"/":L);let M=!0===S.isDev||!D,F=D&&!M;P&&k&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:k,serverActionsManifest:P,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",j=(0,s.getTracer)(),K=j.getActiveScopeSpan(),G={params:y,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>S.onRequestError(e,t,a,T)},sharedContext:{buildId:A}},V=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),$=p.NextRequestAdapter.fromNodeNextRequest(V,(0,p.signalFromNodeResponse)(t));try{let i=async e=>S.handle($,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==R.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var s,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&I&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(o);e.fetchMetrics=G.renderOpts.fetchMetrics;let s=G.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=G.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(V,B,a,G.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,n=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})},T),t}},u=await S.handleResponse({req:e,nextConfig:x,cacheKey:L,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!D)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",I?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,E.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&D||p.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(V,B,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};K?await d(K):await j.withPropagatedContext(e.headers,()=>j.trace(R.BaseServerSpan.handleRequest,{spanName:`${H} ${a}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})}),D)throw t;return await (0,h.sendResponse)(V,B,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>x,"routeModule",()=>S,"serverHooks",()=>T,"workAsyncStorage",()=>w,"workUnitAsyncStorage",()=>N]),r()}catch(e){r(e)}},!1),29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c3778b6d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=_26357de9._.js.map
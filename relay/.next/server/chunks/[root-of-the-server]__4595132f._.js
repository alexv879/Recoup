module.exports=[94222,e=>e.a(async(t,n)=>{try{let t=await e.y("firebase-admin/storage");e.n(t),n()}catch(e){n(e)}},!0),53515,e=>e.a(async(t,n)=>{try{var r=e.i(94222),o=e.i(56300),a=e.i(69907),s=t([r,o]);function c(){if(!(0,o.getApps)().length)throw Error("Firebase is not initialized");let e=(0,r.getStorage)(),t=process.env.FIREBASE_STORAGE_BUCKET||`${process.env.FIREBASE_PROJECT_ID}.appspot.com`;return e.bucket(t)}async function i(e){try{let{fileBuffer:t,fileName:n,contentType:r,handoffId:o,freelancerId:s,documentType:i}=e,d=`documents/${s}/${o}/${i}/${n}`,u=c(),l=u.file(d);await l.save(t,{contentType:r,metadata:{handoffId:o,freelancerId:s,documentType:i,uploadedAt:new Date().toISOString()}}),(0,a.logInfo)("Document uploaded to Firebase Storage",{storagePath:d,fileName:n,handoffId:o,documentType:i}),await l.makePublic();let f=`https://storage.googleapis.com/${u.name}/${d}`;return{success:!0,storagePath:d,publicUrl:f}}catch(e){return(0,a.logError)("Failed to upload document to Firebase Storage",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e,t=60){try{let n=c().file(e),[r]=await n.exists();if(!r)return{success:!1,error:"File not found"};let o=new Date;o.setMinutes(o.getMinutes()+t);let[s]=await n.getSignedUrl({action:"read",expires:o});return(0,a.logInfo)("Generated signed URL",{storagePath:e,expiresAt:o.toISOString()}),{success:!0,signedUrl:s,expiresAt:o}}catch(e){return(0,a.logError)("Failed to generate signed URL",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function u(e){try{let t=c().file(e),[n]=await t.exists();if(!n)return(0,a.logInfo)("Document already deleted or does not exist",{storagePath:e}),{success:!0};return await t.delete(),(0,a.logInfo)("Document deleted from Firebase Storage",{storagePath:e}),{success:!0}}catch(e){return(0,a.logError)("Failed to delete document from Firebase Storage",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function l(e,t){try{let n=c(),r=`documents/${t}/${e}/`,[o]=await n.getFiles({prefix:r}),s=o.map(e=>({name:e.name.split("/").pop()||e.name,storagePath:e.name,contentType:e.metadata.contentType||"application/octet-stream",size:parseInt(String(e.metadata.size||"0"),10),uploadedAt:new Date(e.metadata.timeCreated||Date.now()),documentType:String(e.metadata.metadata?.documentType||"unknown")}));return(0,a.logInfo)("Listed handoff documents",{handoffId:e,freelancerId:t,documentCount:s.length}),{success:!0,documents:s}}catch(e){return(0,a.logError)("Failed to list handoff documents",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function f(e){let t=`invoice-${e.invoiceReference}.pdf`;return i({fileBuffer:e.pdfBuffer,fileName:t,contentType:"application/pdf",handoffId:e.handoffId,freelancerId:e.freelancerId,documentType:"invoice"})}async function m(e){return i({fileBuffer:e.contentBuffer,fileName:e.fileName,contentType:e.contentType,handoffId:e.handoffId,freelancerId:e.freelancerId,documentType:"communication"})}[r,o]=s.then?(await s)():s,e.s(["deleteDocument",()=>u,"getSignedUrl",()=>d,"listHandoffDocuments",()=>l,"uploadCommunicationHistory",()=>m,"uploadDocument",()=>i,"uploadInvoicePDF",()=>f]),n()}catch(e){n(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__4595132f._.js.map
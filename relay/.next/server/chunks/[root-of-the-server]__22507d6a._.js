module.exports=[54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},15776,e=>{"use strict";var t=e.i(89171),r=e.i(15874);class a extends Error{statusCode;code;constructor(e,t,r){super(t),this.statusCode=e,this.code=r,this.name="ApiError"}}class n extends a{details;constructor(e,t){super(400,e,"VALIDATION_ERROR"),this.details=t}}class i extends a{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class o extends a{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class s extends a{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class l extends a{retryAfter;constructor(e="Rate limit exceeded",t){super(429,e,"RATE_LIMIT"),this.retryAfter=t}}class d extends a{constructor(e="Internal server error"){super(500,e,"INTERNAL_ERROR")}}function u(e){if(e instanceof a){let r={error:e.code,message:e.message};return(e instanceof n&&e.details&&(r.details=e.details),e instanceof l&&e.retryAfter)?t.NextResponse.json(r,{status:e.statusCode,headers:{"Retry-After":e.retryAfter.toString()}}):t.NextResponse.json(r,{status:e.statusCode})}return e instanceof r.ZodError?t.NextResponse.json({error:"VALIDATION_ERROR",message:"Invalid request data",details:e.issues},{status:400}):(console.error("Unhandled error:",e),t.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500}))}e.s(["NotFoundError",()=>s,"errors",0,{unauthorized:(e="Unauthorized")=>new i(e),forbidden:(e="Forbidden")=>new o(e),notFound:(e="Not found")=>new s(e),badRequest:e=>new n(e),internal:(e="Internal server error")=>new d(e),rateLimit:(e="Rate limit exceeded",t)=>new l(e,t)},"handleApiError",()=>u])},73153,e=>{"use strict";var t=e.i(69719);let r=t.z.object({clientName:t.z.string().min(1,"Client name is required").max(100),clientEmail:t.z.string().email("Invalid email address"),amount:t.z.number().positive("Amount must be positive"),dueDate:t.z.string().refine(e=>!isNaN(Date.parse(e)),{message:"Invalid date format"}),description:t.z.string().max(500).optional(),paymentMethods:t.z.array(t.z.enum(["bank_transfer","card"])).min(1,"At least one payment method required")}),a=t.z.object({clientName:t.z.string().min(1).max(100).optional(),clientEmail:t.z.string().email().optional(),amount:t.z.number().positive().optional(),dueDate:t.z.string().optional(),description:t.z.string().max(500).optional(),status:t.z.enum(["draft","sent","paid","overdue","in_collections","disputed","cancelled"]).optional(),paymentMethods:t.z.array(t.z.enum(["bank_transfer","card"])).optional()});t.z.object({confirmationToken:t.z.string().uuid(),amount:t.z.number().positive("Amount must be positive"),paymentMethod:t.z.enum(["bank_transfer","card"]),datePaid:t.z.string().refine(e=>!isNaN(Date.parse(e)),{message:"Invalid date format"}),clientNotes:t.z.string().max(500).optional()}),t.z.object({accountHolderName:t.z.string().min(1,"Account holder name is required").max(100),accountNumber:t.z.string().regex(/^\d{8}$/,"Account number must be 8 digits"),sortCode:t.z.string().regex(/^\d{2}-?\d{2}-?\d{2}$/,"Sort code must be in format XX-XX-XX"),bankName:t.z.string().min(1,"Bank name is required").max(100)}),t.z.object({emailNotifications:t.z.boolean(),inAppNotifications:t.z.boolean(),quietHoursStart:t.z.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format (HH:MM)"),quietHoursEnd:t.z.string().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"Invalid time format (HH:MM)"),notificationTypes:t.z.array(t.z.string()),onVacation:t.z.boolean(),vacationUntil:t.z.string().optional()}),t.z.object({name:t.z.string().min(1).max(100).optional(),businessName:t.z.string().max(100).optional(),businessType:t.z.enum(["freelancer","agency","consultant"]).optional(),timezone:t.z.string().optional(),language:t.z.enum(["en","es","fr"]).optional()}),t.z.object({referralCode:t.z.string().length(8,"Invalid referral code")}),t.z.object({type:t.z.string(),data:t.z.object({object:t.z.any()})}),t.z.object({type:t.z.string(),data:t.z.any()});let n=t.z.object({limit:t.z.string().optional().transform(e=>e?parseInt(e,10):10).refine(e=>e>0&&e<=100,{message:"Limit must be between 1 and 100"}),offset:t.z.string().optional().transform(e=>e?parseInt(e,10):0).refine(e=>e>=0,{message:"Offset must be non-negative"})}).extend({status:t.z.enum(["draft","sent","paid","overdue","in_collections","disputed","cancelled"]).optional()});e.s(["InvoiceCreateSchema",0,r,"InvoiceListQuerySchema",0,n,"InvoiceUpdateSchema",0,a])},99807,e=>e.a(async(t,r)=>{try{var a=e.i(89171),n=e.i(7218),i=e.i(65839),o=e.i(73153),s=e.i(15776),l=e.i(963),d=e.i(69907),u=t([i]);async function c(e,{params:t}){let{id:r}=await t,o=Date.now(),u=`/api/invoices/${r}`;try{let{userId:e}=await (0,n.auth)();if(!e)throw s.errors.unauthorized();(0,d.logApiRequest)("GET",u,e);let{success:t}=await (0,l.checkRateLimit)(e,l.ratelimit);if(!t)throw s.errors.rateLimit();let c=await (0,i.getInvoiceById)(r,e),p=Date.now()-o;return(0,d.logApiResponse)("GET",u,200,p,e),a.NextResponse.json({invoice:c})}catch(e){return(0,s.handleApiError)(e)}}async function p(e,{params:t}){let{id:r}=await t,u=Date.now(),c=`/api/invoices/${r}`;try{let{userId:t}=await (0,n.auth)();if(!t)throw s.errors.unauthorized();(0,d.logApiRequest)("PUT",c,t);let{success:p}=await (0,l.checkRateLimit)(t,l.ratelimit);if(!p)throw s.errors.rateLimit();let m=await e.json(),h=o.InvoiceUpdateSchema.parse(m),R=await (0,i.updateInvoice)(r,t,h),f=Date.now()-u;return(0,d.logApiResponse)("PUT",c,200,f,t),a.NextResponse.json({invoice:R})}catch(e){return(0,s.handleApiError)(e)}}async function m(e,{params:t}){let{id:r}=await t,o=Date.now(),u="DELETE",c=`/api/invoices/${r}`;try{let{userId:e}=await (0,n.auth)();if(!e)throw s.errors.unauthorized();(0,d.logApiRequest)(u,c,e);let{success:t}=await (0,l.checkRateLimit)(e,l.ratelimit);if(!t)throw s.errors.rateLimit();await (0,i.deleteInvoice)(r,e);let p=Date.now()-o;return(0,d.logApiResponse)(u,c,200,p,e),a.NextResponse.json({success:!0})}catch(e){return(0,s.handleApiError)(e)}}[i]=u.then?(await u)():u,e.s(["DELETE",()=>m,"GET",()=>c,"PUT",()=>p,"dynamic",0,"force-dynamic"]),r()}catch(e){r(e)}},!1),44236,e=>e.a(async(t,r)=>{try{var a=e.i(47909),n=e.i(74017),i=e.i(96250),o=e.i(84243),s=e.i(61916),l=e.i(14444),d=e.i(37092),u=e.i(69741),c=e.i(16795),p=e.i(87718),m=e.i(95169),h=e.i(47587),R=e.i(66012),f=e.i(70101),g=e.i(26937),v=e.i(10372),w=e.i(93695);e.i(52474);var E=e.i(220),x=e.i(99807),z=t([x]);[x]=z.then?(await z)():z;let A=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/invoices/[id]/route",pathname:"/api/invoices/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/invoices/[id]/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:N,workUnitAsyncStorage:I,serverHooks:C}=A;function y(){return(0,i.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:I})}async function b(e,t,r){A.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/invoices/[id]/route";a=a.replace(/\/index$/,"")||"/";let i=await A.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:x,params:z,nextConfig:y,parsedUrl:b,isDraftMode:N,prerenderManifest:I,routerServerContext:C,isOnDemandRevalidate:T,revalidateOnlyGenerated:_,resolvedPathname:O,clientReferenceManifest:D,serverActionsManifest:j}=i,P=(0,u.normalizeAppPath)(a),U=!!(I.dynamicRoutes[P]||I.routes[O]),S=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,b,!1):t.end("This page could not be found"),null);if(U&&!N){let e=!!I.routes[O],t=I.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let q=null;!U||A.isDev||N||(q=O,q="/index"===q?"/":q);let H=!0===A.isDev||!U,k=U&&!H;j&&D&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:D,serverActionsManifest:j,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:j})});let M=e.method||"GET",L=(0,s.getTracer)(),$=L.getActiveScopeSpan(),F={params:z,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>A.onRequestError(e,t,a,C)},sharedContext:{buildId:x}},X=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(X,(0,p.signalFromNodeResponse)(t));try{let i=async e=>A.handle(K,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${M} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var s,d;let u=async({previousCacheEntry:n})=>{try{if(!l&&T&&_&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let s=F.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=F.renderOpts.collectedTags;if(!U)return await (0,R.sendResponse)(X,B,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})},C),t}},c=await A.handleResponse({req:e,nextConfig:y,cacheKey:q,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:_,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!U)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&U||p.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,R.sendResponse)(X,B,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};$?await d($):await L.withPropagatedContext(e.headers,()=>L.trace(m.BaseServerSpan.handleRequest,{spanName:`${M} ${a}`,kind:s.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},d))}catch(t){if(t instanceof w.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})}),U)throw t;return await (0,R.sendResponse)(X,B,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>y,"routeModule",()=>A,"serverHooks",()=>C,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>I]),r()}catch(e){r(e)}},!1),29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c3778b6d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__22507d6a._.js.map
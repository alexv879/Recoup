module.exports=[15776,e=>{"use strict";var t=e.i(89171),r=e.i(15874);class a extends Error{statusCode;code;constructor(e,t,r){super(t),this.statusCode=e,this.code=r,this.name="ApiError"}}class s extends a{details;constructor(e,t){super(400,e,"VALIDATION_ERROR"),this.details=t}}class n extends a{constructor(e="Unauthorized"){super(401,e,"UNAUTHORIZED")}}class o extends a{constructor(e="Forbidden"){super(403,e,"FORBIDDEN")}}class i extends a{constructor(e="Not found"){super(404,e,"NOT_FOUND")}}class c extends a{retryAfter;constructor(e="Rate limit exceeded",t){super(429,e,"RATE_LIMIT"),this.retryAfter=t}}class l extends a{constructor(e="Internal server error"){super(500,e,"INTERNAL_ERROR")}}function d(e){if(e instanceof a){let r={error:e.code,message:e.message};return(e instanceof s&&e.details&&(r.details=e.details),e instanceof c&&e.retryAfter)?t.NextResponse.json(r,{status:e.statusCode,headers:{"Retry-After":e.retryAfter.toString()}}):t.NextResponse.json(r,{status:e.statusCode})}return e instanceof r.ZodError?t.NextResponse.json({error:"VALIDATION_ERROR",message:"Invalid request data",details:e.issues},{status:400}):(console.error("Unhandled error:",e),t.NextResponse.json({error:"INTERNAL_ERROR",message:"An unexpected error occurred"},{status:500}))}e.s(["NotFoundError",()=>i,"errors",0,{unauthorized:(e="Unauthorized")=>new n(e),forbidden:(e="Forbidden")=>new o(e),notFound:(e="Not found")=>new i(e),badRequest:e=>new s(e),internal:(e="Internal server error")=>new l(e),rateLimit:(e="Rate limit exceeded",t)=>new c(e,t)},"handleApiError",()=>d])},27356,e=>{"use strict";let t,r;var a=e.i(66680);function s(e=21){var n;n=e|=0,!t||t.length<n?(t=Buffer.allocUnsafe(128*n),a.webcrypto.getRandomValues(t),r=0):r+n>t.length&&(a.webcrypto.getRandomValues(t),r=0),r+=n;let o="";for(let a=r-e;a<r;a++)o+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&t[a]];return o}e.s(["nanoid",()=>s],27356)},9053,e=>e.a(async(t,r)=>{try{var a=e.i(68253),s=e.i(69907),n=t([a]);[a]=n.then?(await n)():n;let l={sms_reminders:"paid",physical_letters:"paid",ai_voice_calls:"paid",agency_handoff:"paid",advanced_analytics:"paid",priority_support:"paid",unlimited_collections:"paid"},d={sms_reminders:{perUse:.04,description:"SMS reminder sent to client"},physical_letters:{perUse:1.2,description:"Physical letter sent by post"},ai_voice_calls:{perUse:1.5,description:"5-minute AI collection call"},agency_handoff:{perUse:0,description:"Escalation to collection agency"},advanced_analytics:{perUse:0,description:"Access to advanced analytics dashboard"},priority_support:{perUse:0,description:"24/7 priority email support"},unlimited_collections:{perUse:0,description:"Unlimited automated collection reminders"}};async function o(e,t){try{let r=await a.db.collection("users").doc(e).get();if(!r.exists)return{hasAccess:!1,reason:"User not found"};let s=r.data(),n=l[t];if("paid"===n&&"free"===s.subscriptionTier)return{hasAccess:!1,reason:"This feature requires a paid subscription",upgradeRequired:!0};if(!s.collectionsEnabled)return{hasAccess:!1,reason:"Collections features are disabled for your account"};if("free"===s.subscriptionTier&&"unlimited_collections"===t){let t=new Date().getMonth();if(s.lastDemoResetDate?.toDate().getMonth()!==t&&await a.db.collection("users").doc(e).update({collectionsDemoUsedThisMonth:0,lastDemoResetDate:new Date}),s.collectionsDemoUsedThisMonth>=2)return{hasAccess:!1,reason:"Free tier demo limit reached (2 per month)",upgradeRequired:!0}}return{hasAccess:!0}}catch(r){return(0,s.logWarn)("Premium access check failed",{userId:e,feature:t,error:r}),{hasAccess:!1,reason:"Unable to verify subscription status"}}}async function i(e,t){let r=await o(e,t);if(!r.hasAccess){let e=Error(r.reason||"Access denied");throw e.statusCode=402,e.upgradeRequired=r.upgradeRequired,e}}async function c(e){try{await a.db.collection("premium_feature_usage").add({userId:e.userId,feature:e.feature,invoiceId:e.invoiceId,cost:e.cost||d[e.feature].perUse,timestamp:new Date})}catch(t){(0,s.logWarn)("Failed to log premium feature usage",e)}}e.s(["logPremiumFeatureUsage",()=>c,"requirePremiumAccess",()=>i]),r()}catch(e){r(e)}},!1),87504,e=>e.a(async(t,r)=>{try{var a=e.i(89171),s=e.i(7218),n=e.i(15155),o=e.i(9053),i=e.i(15776),c=e.i(69907),l=t([n,o]);async function d(e){let t=Date.now();try{let{userId:r}=await (0,s.auth)();if(!r)throw i.errors.unauthorized();(0,c.logApiRequest)("POST","/api/collections/agency-handoff",r),await (0,o.requirePremiumAccess)(r,"agency_handoff");let{invoiceId:l,agencyId:d,notes:u}=await e.json();if(!l||!d)throw i.errors.badRequest("Missing required fields: invoiceId, agencyId");let p=await (0,n.checkEscalationEligibility)(l);if(!p.eligible)return a.NextResponse.json({success:!1,error:p.reason,eligible:!1},{status:400});let h=await (0,n.createAgencyHandoff)({invoiceId:l,freelancerId:r,agencyId:d,notes:u});if(!h.success)throw Error(h.error||"Failed to create handoff");await (0,o.logPremiumFeatureUsage)({userId:r,feature:"agency_handoff",invoiceId:l,cost:0});let f=Date.now()-t;return(0,c.logApiResponse)("POST","/api/collections/agency-handoff",200,f,r),a.NextResponse.json({success:!0,message:"Invoice escalated to agency successfully",handoffId:h.handoffId,note:"Agency will begin collection efforts within 2-3 business days"})}catch(r){let e=Date.now()-t;if((0,c.logApiResponse)("POST","/api/collections/agency-handoff",r.statusCode||500,e),402===r.statusCode)return a.NextResponse.json({error:r.message,upgradeRequired:!0,upgradeUrl:"/settings/billing/upgrade"},{status:402});return(0,i.handleApiError)(r)}}async function u(e){try{let{userId:t}=await (0,s.auth)();if(!t)throw i.errors.unauthorized();let{searchParams:r}=new URL(e.url),o=r.get("handoffId"),c=r.get("status");if(o){let e=await (0,n.getHandoffDetails)(o);if(!e)throw i.errors.notFound("Handoff not found");if(e.freelancerId!==t)throw i.errors.forbidden("You do not have access to this handoff");return a.NextResponse.json({success:!0,handoff:e})}let l=await (0,n.listFreelancerHandoffs)(t,{status:c,limit:50});return a.NextResponse.json({success:!0,handoffs:l,count:l.length})}catch(e){return(0,i.handleApiError)(e)}}[n,o]=l.then?(await l)():l,e.s(["GET",()=>u,"POST",()=>d,"dynamic",0,"force-dynamic"]),r()}catch(e){r(e)}},!1),10640,e=>e.a(async(t,r)=>{try{var a=e.i(47909),s=e.i(74017),n=e.i(96250),o=e.i(84243),i=e.i(61916),c=e.i(14444),l=e.i(37092),d=e.i(69741),u=e.i(16795),p=e.i(87718),h=e.i(95169),f=e.i(47587),R=e.i(66012),g=e.i(70101),m=e.i(26937),y=e.i(10372),w=e.i(93695);e.i(52474);var v=e.i(220),A=e.i(87504),E=t([A]);[A]=E.then?(await E)():E;let b=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/collections/agency-handoff/route",pathname:"/api/collections/agency-handoff",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/collections/agency-handoff/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:N,workUnitAsyncStorage:C,serverHooks:T}=b;function _(){return(0,n.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:C})}async function x(e,t,r){b.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/collections/agency-handoff/route";a=a.replace(/\/index$/,"")||"/";let n=await b.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:E,nextConfig:_,parsedUrl:x,isDraftMode:N,prerenderManifest:C,routerServerContext:T,isOnDemandRevalidate:I,revalidateOnlyGenerated:U,resolvedPathname:O,clientReferenceManifest:P,serverActionsManifest:D}=n,q=(0,d.normalizeAppPath)(a),S=!!(C.dynamicRoutes[q]||C.routes[O]),M=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,x,!1):t.end("This page could not be found"),null);if(S&&!N){let e=!!C.routes[O],t=C.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await M();throw new w.NoFallbackError}}let H=null;!S||b.isDev||N||(H=O,H="/index"===H?"/":H);let F=!0===b.isDev||!S,j=S&&!F;D&&P&&(0,c.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:P,serverActionsManifest:D,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:D})});let k=e.method||"GET",L=(0,i.getTracer)(),K=L.getActiveScopeSpan(),$={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>b.onRequestError(e,t,a,T)},sharedContext:{buildId:A}},B=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),z=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let n=async e=>b.handle(z,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${k} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${a}`)}),c=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var i,l;let d=async({previousCacheEntry:s})=>{try{if(!c&&I&&U&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(o);e.fetchMetrics=$.renderOpts.fetchMetrics;let i=$.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let l=$.renderOpts.collectedTags;if(!S)return await (0,R.sendResponse)(B,V,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[y.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,s=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:I})},T),t}},u=await b.handleResponse({req:e,nextConfig:_,cacheKey:H,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:U,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:c});if(!S)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});c||t.setHeader("x-nextjs-cache",I?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return c&&S||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,R.sendResponse)(B,V,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};K?await l(K):await L.withPropagatedContext(e.headers,()=>L.trace(h.BaseServerSpan.handleRequest,{spanName:`${k} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:I})}),S)throw t;return await (0,R.sendResponse)(B,V,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>_,"routeModule",()=>b,"serverHooks",()=>T,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>C]),r()}catch(e){r(e)}},!1),29652,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c3778b6d._.js"].map(t=>e.l(t))).then(()=>t(26445)))},6878,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_next_92aaecbe._.js"].map(t=>e.l(t))).then(()=>t(93458)))}];

//# sourceMappingURL=_9c75795e._.js.map
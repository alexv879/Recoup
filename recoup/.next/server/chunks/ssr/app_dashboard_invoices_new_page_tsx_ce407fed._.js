module.exports=[580173,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(408458),f=a.i(720505),g=a.i(811462),h=a.i(170106);let i=(0,h.default)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),j=(0,h.default)("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),k=(0,h.default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var l=a.i(29806),m=a.i(990845);function n({onTranscriptUpdate:a,onRecordingComplete:d,onError:e,disabled:f=!1,className:g=""}){let[h,n]=(0,c.useState)("idle"),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),u=(0,c.useRef)(null),v=(0,c.useRef)([]),w=(0,c.useRef)(0),x=(0,c.useRef)(0);(0,l.useTrack)("voice_recording_started",void 0,[]);let y=async()=>{try{n("requesting"),t(""),p(""),r("");let a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}),b=new MediaRecorder(a,{mimeType:"audio/webm"});v.current=[],x.current=0,w.current=Date.now(),b.ondataavailable=a=>{a.data.size>0&&v.current.push(a.data)},b.onstop=async()=>{let b=new Blob(v.current,{type:"audio/webm"});await z(b),a.getTracks().forEach(a=>a.stop())},b.start(1e3),u.current=b,n("recording");let c=/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop",d=navigator.connection?.effectiveType||"unknown";(0,l.useTrack)("voice_recording_started",{device_type:c,network_type:d},[c]),(0,m.logInfo)("Voice recording started",{deviceType:c,networkType:d})}catch(a){(0,m.logError)("Failed to start recording",a),n("error"),t(a.message||"Failed to access microphone"),e?.(a)}},z=async a=>{try{n("processing");let b=new FormData;b.append("audio",a,"recording.webm");let c=Date.now(),e=await fetch("/api/voice/batch",{method:"POST",body:b});if(!e.ok)throw Error(`Transcription failed: ${e.statusText}`);let f=await e.json(),g=Date.now()-c,h=f.transcript||"";p(h);let i={method:"whisper",latencyMs:g,segments:f.segments||1,deviceType:/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop"};(0,l.useTrack)("voice_transcript_finalized",{segments:i.segments,latency_ms_avg:g},[g]),d?.(h,i),n("idle"),(0,m.logInfo)("Voice transcription completed",{finalTranscript:h,metadata:i})}catch(a){(0,m.logError)("Failed to process audio",a),n("error"),t(a.message||"Transcription failed"),e?.(a)}},A=()=>{!f&&("idle"===h?y():"recording"===h&&u.current&&"recording"===h&&(n("processing"),u.current.stop()))},B=(()=>{switch(h){case"requesting":return{icon:k,label:"Requesting microphone...",spinning:!0};case"recording":return{icon:j,label:"Stop recording",spinning:!1};case"processing":return{icon:k,label:"Processing...",spinning:!0};case"error":return{icon:i,label:"Start voice input (error occurred)",spinning:!1};default:return{icon:i,label:"Start voice input",spinning:!1}}})(),C=B.icon,D="recording"===h,E="requesting"===h||"processing"===h;return(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("button",{type:"button",onClick:A,onKeyDown:a=>{(" "===a.key||"Enter"===a.key)&&(a.preventDefault(),A())},disabled:f||E,"aria-label":B.label,"aria-pressed":D,className:`
          relative p-3 rounded-full transition-all duration-200
          ${D?"bg-red-500 hover:bg-red-600 text-white shadow-lg animate-pulse":"bg-blue-500 hover:bg-blue-600 text-white shadow-md hover:shadow-lg"}
          ${f||E?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
          ${g}
        `,children:(0,b.jsx)(C,{className:`w-5 h-5 ${B.spinning?"animate-spin":""}`,"aria-hidden":"true"})}),(0,b.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:["recording"===h&&"Recording started","processing"===h&&"Processing audio...",q&&`Partial: ${q}`,o&&`Final transcript inserted: ${o}`,s&&`Error: ${s}`]}),"error"===h&&s&&(0,b.jsx)("div",{className:"absolute top-full mt-2 left-0 right-0 bg-red-50 border border-red-200 rounded-md p-2 text-sm text-red-700",role:"alert",children:s})]})}function o({onTranscriptionComplete:a}){let[d,e]=(0,c.useState)(!1),[f,h]=(0,c.useState)(""),[i,j]=(0,c.useState)();return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(g.VoiceTranscriptLiveRegion,{isRecording:d,transcript:f}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Click the microphone button and speak your invoice details. Include client name, email, amount, and description."}),(0,b.jsx)(n,{onRecordingComplete:(b,c)=>{h(b),e(!1);let d={description:b};for(let a of b.toLowerCase().split("\n")){if(a.includes("client")||a.includes("customer")){let b=a.match(/(?:client|customer)[:\s]+(.+)/i);b&&(d.clientName=b[1].trim())}let b=a.match(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);b&&(d.clientEmail=b[1]);let c=a.match(/(?:Â£|\$|amount|total)[:\s]*(\d+(?:\.\d{2})?)/i);c&&(d.amount=parseFloat(c[1])),(a.includes("item")||a.includes("service")||a.includes("work"))&&(d.lineItems=[{description:a.trim(),quantity:1,unitPrice:d.amount||0}])}a(d)},onError:a=>{console.error("Voice recording error:",a)}})]})]})}var p=a.i(898003);function q(){let a=(0,d.useRouter)(),{user:h}=(0,p.useUser)(),[i,j]=(0,c.useState)(!1),[k,m]=(0,c.useState)(!1),[n,q]=(0,c.useState)({clientName:"",clientEmail:"",clientPhone:"",amount:0,description:"",invoiceDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+2592e6).toISOString().split("T")[0],lineItems:[{description:"",quantity:1,unitPrice:0}]});(0,c.useEffect)(()=>{(0,l.trackEvent)("invoice_created",{user_id:h?.id})},[h?.id]);let r=(a,b,c)=>{q(d=>({...d,lineItems:d.lineItems.map((d,e)=>e===a?{...d,[b]:c}:d)}))},s=()=>n.lineItems.reduce((a,b)=>a+b.quantity*b.unitPrice,0),t=async b=>{b.preventDefault(),j(!0);try{let b=s(),c=await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,amount:b,status:"draft"})});if(c.ok){let b=await c.json(),d=s(),e=!h?.publicMetadata?.activationEvents?.firstInvoiceAt;(0,l.trackEvent)(e?"first_invoice_created":"invoice_created",{user_id:h?.id,invoice_id:b.invoiceId,amount:d,line_items:n.lineItems.length,has_voice_meta:k,client_name:n.clientName,time_to_first_invoice_minutes:e?Math.floor((Date.now()-(h?.createdAt?.getTime()||Date.now()))/6e4):void 0}),a.push(`/dashboard/invoices/${b.invoiceId}`)}else{let a=await c.json();alert(a.error||"Failed to create invoice")}}catch(a){console.error("Error creating invoice:",a),alert("Failed to create invoice")}finally{j(!1)}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create Invoice"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Fill in the details or use voice input"})]}),(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>a.push("/dashboard/invoices"),children:"Cancel"})]})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,b.jsxs)(e.Card,{className:"p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Voice Input"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Create invoice by speaking"})]}),(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>m(!k),children:["ðŸŽ¤ ",k?"Hide":"Show"," Voice Recorder"]})]}),k&&(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(o,{onTranscriptionComplete:a=>{a.clientName&&q(b=>({...b,clientName:a.clientName})),a.clientEmail&&q(b=>({...b,clientEmail:a.clientEmail})),a.amount&&q(b=>({...b,amount:a.amount})),a.description&&q(b=>({...b,description:a.description})),a.lineItems&&q(b=>({...b,lineItems:a.lineItems})),(0,l.trackEvent)("voice_invoice_submitted",{user_id:h?.id,has_client_data:!!(a.clientName||a.clientEmail),has_amount:!!a.amount,has_line_items:!!a.lineItems}),m(!1)}})})]}),(0,b.jsx)(e.Card,{className:"p-6",children:(0,b.jsxs)("form",{onSubmit:t,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Client Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(g.AccessibleFormField,{id:"clientName",label:"Client Name",type:"text",required:!0,value:n.clientName,onChange:a=>q({...n,clientName:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,b.jsx)(g.AccessibleFormField,{id:"clientEmail",label:"Client Email",type:"email",required:!0,value:n.clientEmail,onChange:a=>q({...n,clientEmail:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,b.jsx)(g.AccessibleFormField,{id:"clientPhone",label:"Client Phone",type:"tel",helpText:"Optional",value:n.clientPhone||"",onChange:a=>q({...n,clientPhone:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Dates"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(g.AccessibleFormField,{id:"invoiceDate",label:"Invoice Date",type:"date",required:!0,value:n.invoiceDate,onChange:a=>q({...n,invoiceDate:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,b.jsx)(g.AccessibleFormField,{id:"dueDate",label:"Due Date",type:"date",required:!0,value:n.dueDate,onChange:a=>q({...n,dueDate:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Line Items"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{q(a=>({...a,lineItems:[...a.lineItems,{description:"",quantity:1,unitPrice:0}]}))},children:"+ Add Item"})]}),(0,b.jsx)("div",{className:"space-y-4",children:n.lineItems.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("input",{type:"text",placeholder:"Description",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:a.description,onChange:a=>r(c,"description",a.target.value),required:!0})}),(0,b.jsx)("div",{className:"w-24",children:(0,b.jsx)("input",{type:"number",placeholder:"Qty",min:"1",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:a.quantity,onChange:a=>r(c,"quantity",parseFloat(a.target.value)),required:!0})}),(0,b.jsx)("div",{className:"w-32",children:(0,b.jsx)("input",{type:"number",placeholder:"Price",min:"0",step:"0.01",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:a.unitPrice,onChange:a=>r(c,"unitPrice",parseFloat(a.target.value)),required:!0})}),(0,b.jsx)("div",{className:"w-32 text-right pt-2",children:(0,b.jsxs)("p",{className:"font-semibold",children:["Â£",(a.quantity*a.unitPrice).toFixed(2)]})}),n.lineItems.length>1&&(0,b.jsx)(f.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{q(a=>({...a,lineItems:a.lineItems.filter((a,b)=>b!==c)}))},children:"âœ•"})]},c))}),(0,b.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,b.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("span",{children:["Â£",s().toFixed(2)]})]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes (optional)"}),(0,b.jsx)("textarea",{rows:4,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:n.description,onChange:a=>q({...n,description:a.target.value}),placeholder:"Add any additional notes or payment terms..."})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(f.Button,{type:"submit",disabled:i,className:"flex-1",children:i?"Creating...":"Create Invoice"}),(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>a.push("/dashboard/invoices"),children:"Cancel"})]})]})})]})})]})}a.s(["default",()=>q],580173)}];

//# sourceMappingURL=app_dashboard_invoices_new_page_tsx_ce407fed._.js.map
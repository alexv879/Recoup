module.exports=[654098,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(720505),f=a.i(811462),g=a.i(170106);let h=(0,g.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);(0,g.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var i=a.i(633508);let j=({clients:a=[],onSelectClient:d,onAddNewClient:e,selectedClient:f=null,maxSuggestions:g=10})=>{let[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(-1),[r,s]=(0,c.useState)([]),t=(0,c.useRef)(null);(0,c.useEffect)(()=>{s(JSON.parse(localStorage.getItem("recentClients")||"[]"))},[]);let u=a=>{k(a.name),m(!1),d(a);let b=JSON.parse(localStorage.getItem("recentClients")||"[]"),c=[a.id,...b.filter(b=>b!==a.id)].slice(0,5);localStorage.setItem("recentClients",JSON.stringify(c))};return r.map(b=>a.find(a=>a.id===b)).filter(Boolean).slice(0,3),j.length>=2&&n.length,(0,b.jsxs)("div",{className:"relative w-full",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{ref:t,type:"text",placeholder:"Search or select client...",value:j,onChange:b=>(b=>{if(k(b),q(-1),b.trim().length<2){o([]),m(!1);return}let c=b.toLowerCase(),d=a.filter(a=>a.name.toLowerCase().includes(c)||a.email.toLowerCase().includes(c)||a.company&&a.company.toLowerCase().includes(c)).slice(0,g);o(d),m(d.length>0)})(b.target.value),onKeyDown:a=>{if(l||"ArrowDown"===a.key)switch(a.key){case"ArrowDown":a.preventDefault(),m(!0),q(a=>a<n.length-1?a+1:0);break;case"ArrowUp":a.preventDefault(),q(a=>a>0?a-1:n.length-1);break;case"Enter":a.preventDefault(),p>=0&&u(n[p]);break;case"Escape":a.preventDefault(),m(!1),k("")}},onFocus:()=>{j.length>=2&&m(!0)},"aria-label":"Select client","aria-autocomplete":"list","aria-expanded":l,"aria-controls":"client-dropdown",role:"combobox",className:"w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),j&&(0,b.jsx)("button",{onClick:()=>{k(""),o([]),m(!1),t.current?.focus()},className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:(0,b.jsx)(i.X,{className:"w-4 h-4"})})]}),!1]})},k=({clients:a,onSelect:d,onArchive:e,onUnarchive:f,selectedClientId:g})=>{let[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)({status:"",financial:"",activity:"",tags:[]}),[l,m]=(0,c.useState)(""),n=a.filter(a=>{let b=!0;if(j.status&&a.status!==j.status&&(b=!1),"overdue"===j.financial&&0>=(a.totalOwed||0)&&(b=!1),"high-value"===j.financial&&5e3>(a.totalOwed||0)&&(b=!1),"inactive"===j.activity&&(!a.lastInvoiceDate||new Date().getTime()-new Date(a.lastInvoiceDate).getTime()<2592e6)&&(b=!1),!(j.tags.length>0)||a.tags&&j.tags.every(b=>a.tags?.includes(b))||(b=!1),l&&l.length>=2){let c=l.toLowerCase();a.name?.toLowerCase().includes(c)||a.email?.toLowerCase().includes(c)||a.company?.toLowerCase().includes(c)||a.phone?.toLowerCase().includes(c)||a.poNumber?.toLowerCase().includes(c)||(b=!1)}return b}),[o,p]=(0,c.useState)("");return(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)("div",{className:"flex gap-4 mb-2 items-center",children:[(0,b.jsx)("input",{type:"text",value:l,onChange:a=>m(a.target.value),placeholder:"Search clients...",className:"px-3 py-2 border rounded-lg","aria-label":"Search clients"}),(0,b.jsxs)("select",{value:j.status,onChange:a=>k(b=>({...b,status:a.target.value})),className:"px-3 py-2 border rounded-lg","aria-label":"Filter by status",children:[(0,b.jsx)("option",{value:"",children:"All Statuses"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"archived",children:"Archived"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,b.jsxs)("select",{value:j.financial,onChange:a=>k(b=>({...b,financial:a.target.value})),className:"px-3 py-2 border rounded-lg","aria-label":"Filter by financial status",children:[(0,b.jsx)("option",{value:"",children:"All Financials"}),(0,b.jsx)("option",{value:"overdue",children:"Overdue"}),(0,b.jsx)("option",{value:"high-value",children:"High Value"})]})]}),(0,b.jsxs)("table",{role:"grid","aria-label":"Client list",className:"min-w-full bg-white border rounded-lg",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:(0,b.jsx)("input",{type:"checkbox",checked:h.length===n.length&&n.length>0,onChange:a=>i(a.target.checked?n.map(a=>a.id):[]),"aria-label":"Select all clients"})}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Name"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Email"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Company"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Total Owed"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Last Invoice"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:n.map(a=>(0,b.jsxs)("tr",{className:g===a.id?"bg-blue-50":"",tabIndex:0,"aria-selected":g===a.id,onClick:()=>d(a),onKeyDown:b=>{("Enter"===b.key||" "===b.key)&&d(a)},style:{outline:g===a.id?"2px solid #2563eb":"none"},children:[(0,b.jsx)("td",{className:"px-4 py-2",children:(0,b.jsx)("input",{type:"checkbox",checked:h.includes(a.id),onChange:b=>{var c;b.stopPropagation(),c=a.id,i(h.includes(c)?h.filter(a=>a!==c):[...h,c])},"aria-label":`Select client ${a.name}`})}),(0,b.jsx)("td",{className:"px-4 py-2 font-semibold text-gray-900",children:a.name}),(0,b.jsx)("td",{className:"px-4 py-2 text-gray-600",children:a.email}),(0,b.jsx)("td",{className:"px-4 py-2 text-gray-500",children:a.company||"-"}),(0,b.jsxs)("td",{className:"px-4 py-2 text-right text-gray-900",children:["\0a3",a.totalOwed?.toLocaleString()||"0"]}),(0,b.jsx)("td",{className:"px-4 py-2 text-gray-600",children:a.lastInvoiceDate?new Date(a.lastInvoiceDate).toLocaleDateString():"-"}),(0,b.jsx)("td",{className:"px-4 py-2",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-semibold ${"archived"===a.status?"bg-gray-200 text-gray-700":"active"===a.status?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:a.status||(a.archived?"archived":"active")})}),(0,b.jsx)("td",{className:"px-4 py-2 flex gap-2",children:a.archived?(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),f(a.id)},className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 focus:ring-2 focus:ring-green-500","aria-label":`Unarchive client ${a.name}`,children:"Unarchive"}):(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),e(a.id)},className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 focus:ring-2 focus:ring-red-500","aria-label":`Archive client ${a.name}`,children:"Archive"})})]},a.id))})]}),h.length>0&&(0,b.jsx)("div",{className:"mt-4 flex gap-2",children:(0,b.jsx)("button",{onClick:()=>{h.forEach(a=>e(a)),i([])},className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700","aria-label":"Archive selected clients",children:"Archive Selected"})}),o&&(0,b.jsx)("div",{role:"alert","aria-live":"assertive",className:"sr-only",children:o})]})},l=[{key:"contact",label:"Contact Info"},{key:"invoices",label:"Invoices"},{key:"payment",label:"Payment Info"},{key:"activity",label:"Activity/Notes"}],m=({client:a,onClose:d,onArchive:e,onUnarchive:g})=>{let[h,i]=(0,c.useState)("contact");return a?(0,b.jsx)(f.AccessibleDialog,{isOpen:!!a,onClose:d,title:a?.name||"Client details",description:a?.company||"",children:(0,b.jsxs)("div",{className:"p-6 relative",children:[(0,b.jsx)("button",{onClick:d,className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600","aria-label":"Close client details",children:"×"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("h2",{id:"client-modal-title",className:"text-2xl font-bold mb-1",children:a.name}),(0,b.jsxs)("div",{className:"flex gap-2 items-center mb-2",children:[a.company&&(0,b.jsx)("span",{className:"text-gray-700 font-semibold",children:a.company}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-semibold ${"archived"===a.status?"bg-gray-200 text-gray-700":"active"===a.status?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:a.status||(a.archived?"archived":"active")})]}),(0,b.jsxs)("div",{className:"text-lg font-bold text-blue-700",children:["£",a.totalOwed?.toLocaleString()||"0"]})]}),(0,b.jsx)("div",{className:"mb-4 border-b",children:(0,b.jsx)("nav",{className:"flex gap-4",children:l.map(a=>(0,b.jsx)("button",{onClick:()=>i(a.key),className:`pb-2 font-semibold text-sm border-b-2 ${h===a.key?"border-blue-600 text-blue-700":"border-transparent text-gray-500"}`,"aria-selected":h===a.key,"aria-controls":`tab-panel-${a.key}`,children:a.label},a.key))})}),(0,b.jsxs)("div",{id:`tab-panel-${h}`,role:"tabpanel",className:"min-h-[180px]",children:["contact"===h&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"mb-1 text-gray-700",children:["Email: ",(0,b.jsx)("span",{className:"font-mono",children:a.email})]}),a.phone&&(0,b.jsxs)("p",{className:"mb-1 text-gray-700",children:["Phone: ",(0,b.jsx)("span",{className:"font-mono",children:a.phone})]}),a.billingAddress&&(0,b.jsxs)("div",{className:"mb-1 text-gray-700",children:[(0,b.jsx)("div",{children:"Billing Address:"}),(0,b.jsxs)("div",{className:"font-mono text-sm",children:[a.billingAddress.street,(0,b.jsx)("br",{}),a.billingAddress.street2&&(0,b.jsxs)(b.Fragment,{children:[a.billingAddress.street2,(0,b.jsx)("br",{})]}),a.billingAddress.city,", ",a.billingAddress.state," ",a.billingAddress.postalCode,(0,b.jsx)("br",{}),a.billingAddress.country]})]}),a.tags&&a.tags.length>0&&(0,b.jsxs)("div",{className:"mb-1 text-gray-700",children:["Tags: ",(0,b.jsx)("span",{className:"font-mono",children:a.tags.join(", ")})]}),a.notes&&(0,b.jsxs)("div",{className:"mb-1 text-gray-700",children:["Notes: ",(0,b.jsx)("span",{className:"font-mono",children:a.notes})]})]}),"invoices"===h&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"mb-2 font-semibold",children:"Invoices"}),(0,b.jsxs)("div",{className:"mb-1",children:["Total invoices: ",a.invoiceCount||0]}),(0,b.jsxs)("div",{className:"mb-1",children:["Total paid: £",a.totalPaid?.toLocaleString()||"0"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Total owed: £",a.totalOwed?.toLocaleString()||"0"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Last invoice: ",a.lastInvoiceDate?new Date(a.lastInvoiceDate).toLocaleDateString():"-"]})]}),"payment"===h&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-1",children:["Payment Terms: ",a.paymentTerms?`Net ${a.paymentTerms}`:"-"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Preferred Payment Method: ",a.preferredPaymentMethod||"-"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Currency: ",a.currency||"-"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Tax ID: ",a.taxId||"-"]})]}),"activity"===h&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-1",children:["Created: ",a.createdAt?new Date(a.createdAt).toLocaleDateString():"-"]}),(0,b.jsxs)("div",{className:"mb-1",children:["Updated: ",a.updatedAt?new Date(a.updatedAt).toLocaleDateString():"-"]})]})]}),(0,b.jsx)("div",{className:"mt-6 flex gap-2",children:a.archived?(0,b.jsx)("button",{onClick:()=>g(a.id),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Unarchive"}):(0,b.jsx)("button",{onClick:()=>e(a.id),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Archive"})})]})}):null},n=({event:a,clientId:b,userId:d})=>((0,c.useEffect)(()=>{window?.relayAnalytics?.track?.("client_event",{event:a,clientId:b,userId:d,timestamp:Date.now()})},[a,b,d]),null);async function o(a,b){let c=await fetch("/api/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add",...b,userId:a})});if(!c.ok)throw Error((await c.json()).error||"Failed to add client");return(await c.json()).clientId}async function p(a,b){let c=await fetch(`/api/clients/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok)throw Error((await c.json()).error||"Failed to update client")}async function q(a){let b=await fetch("/api/clients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"archive",clientId:a})});if(!b.ok)throw Error((await b.json()).error||"Failed to archive client")}async function r(a,b="",c=1,d=20,e={}){let f=new URLSearchParams({search:b,page:c.toString(),pageSize:d.toString(),...e.status&&{status:e.status}}),g=await fetch(`/api/clients?${f}`);if(!g.ok)throw Error("Failed to fetch clients");return await g.json()}async function s(a){let b=await fetch(`/api/clients/${a}`);if(!b.ok){if(404===b.status)return null;throw Error("Failed to fetch client details")}return await b.json()}let t="currentUserId",u=()=>{let[a,d]=(0,c.useState)([]),[e,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(!1),[i,l]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)({});(0,c.useEffect)(()=>{l(!0),r(t,y,1,50,A).then(a=>{d(a),l(!1)}).catch(a=>{v("Failed to load clients"),l(!1)})},[y,A]);let C=async a=>{try{l(!0);let b=await s(a.id);f(b),h(!0),x({event:"select",clientId:a.id})}catch(a){v("Failed to load client details")}finally{l(!1)}},D=async b=>{try{l(!0);let c=await o(t,{name:b}),e=await s(c);d([e,...a]),f(e),h(!0),x({event:"add",clientId:c})}catch(a){v("Failed to add client")}finally{l(!1)}},E=async a=>{try{l(!0),await q(a),d(b=>b.map(b=>b.id===a?{...b,archived:!0}:b)),x({event:"archive",clientId:a})}catch(a){v("Failed to archive client")}finally{l(!1)}},F=async a=>{try{l(!0),await p(a,{archived:!1}),d(b=>b.map(b=>b.id===a?{...b,archived:!1}:b)),x({event:"unarchive",clientId:a})}catch(a){v("Failed to unarchive client")}finally{l(!1)}};return(0,b.jsxs)("div",{className:"max-w-2xl mx-auto p-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Client Management"}),i&&(0,b.jsx)("div",{className:"mb-4 text-blue-600",children:"Loading..."}),u&&(0,b.jsx)("div",{className:"mb-4 text-red-600",children:u}),(0,b.jsxs)("div",{className:"mb-4 flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,b.jsx)("input",{type:"text",placeholder:"Search by name, email, company, phone, invoice, tags...",className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-1/2",value:y,onChange:a=>z(a.target.value),"aria-label":"Search clients"}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsxs)("select",{value:A.status||"",onChange:a=>B(b=>({...b,status:a.target.value||void 0})),className:"px-3 py-2 border rounded-lg","aria-label":"Filter by status",children:[(0,b.jsx)("option",{value:"",children:"All Status"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"archived",children:"Archived"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,b.jsx)("input",{type:"text",placeholder:"Tags (comma separated)",className:"px-3 py-2 border rounded-lg",value:A.tags?A.tags.join(","):"",onChange:a=>B(b=>({...b,tags:a.target.value?a.target.value.split(",").map(a=>a.trim()):void 0})),"aria-label":"Filter by tags"}),(A.status||A.tags&&A.tags.length>0)&&(0,b.jsx)("button",{onClick:()=>B({}),className:"px-3 py-2 bg-gray-200 rounded-lg text-gray-700 font-semibold","aria-label":"Clear all filters",children:"Clear Filters"})]})]}),(0,b.jsxs)("div",{className:"mb-2 flex gap-2",children:[A.status&&(0,b.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold",children:["Status: ",A.status]}),A.tags&&A.tags.length>0&&(0,b.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-semibold",children:["Tags: ",A.tags.join(", ")]})]}),(0,b.jsx)(j,{clients:a,onSelectClient:C,onAddNewClient:D,selectedClient:e}),(0,b.jsx)("div",{className:"mt-8",children:(0,b.jsx)(k,{clients:a,onSelect:C,onArchive:E,onUnarchive:F,selectedClientId:e?.id})}),g&&(0,b.jsx)(m,{client:e,onClose:()=>h(!1),onArchive:E,onUnarchive:F}),w&&(0,b.jsx)(n,{event:w.event,clientId:w.clientId})]})},v=({onClick:a})=>(0,b.jsx)("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors","aria-label":"Open client management",children:"Manage Clients"});function w(){let[a,f]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b",children:(0,b.jsxs)("div",{className:"container mx-auto px-4 py-6 flex items-center justify-between",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Clients"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.default,{href:"/dashboard/clients/new",children:(0,b.jsx)(e.Button,{children:"+ Add Client"})}),(0,b.jsx)(v,{onClick:()=>f(!0)})]})]})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:a&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl p-6 relative",children:[(0,b.jsx)("button",{onClick:()=>f(!1),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600","aria-label":"Close client management",children:"×"}),(0,b.jsx)(u,{})]})})})]})}a.s(["default",()=>w],654098)}];

//# sourceMappingURL=app_dashboard_clients_page_tsx_be602588._.js.map
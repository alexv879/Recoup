{"version":3,"sources":["../../../../app/confirmation/%5Btoken%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { format } from 'date-fns';\nimport { AccessibleFormField } from '@/lib/accessibility';\n\ninterface PaymentConfirmation {\n  confirmationId: string;\n  expectedAmount: number;\n  status: string;\n  clientEmail: string;\n  invoiceId: string;\n  expiresAt: string;\n}\n\nexport default function ClientConfirmationPage() {\n  const params = useParams();\n  const router = useRouter();\n  const token = params.token as string;\n\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [confirmation, setConfirmation] = useState<PaymentConfirmation | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  // Form state\n  const [amount, setAmount] = useState('');\n  const [paymentMethod, setPaymentMethod] = useState<'bank_transfer' | 'card'>('bank_transfer');\n  const [datePaid, setDatePaid] = useState(format(new Date(), 'yyyy-MM-dd'));\n  const [clientNotes, setClientNotes] = useState('');\n\n  // Fetch confirmation details\n  useEffect(() => {\n    async function fetchConfirmation() {\n      try {\n        const res = await fetch(`/api/payment-confirmation?token=${token}`);\n        const data = await res.json();\n\n        if (!res.ok) {\n          throw new Error(data.message || 'Failed to load confirmation');\n        }\n\n        setConfirmation(data.confirmation);\n        setAmount(data.confirmation.expectedAmount.toString());\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to load confirmation');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    if (token) {\n      fetchConfirmation();\n    }\n  }, [token]);\n\n  // Handle form submission\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setSubmitting(true);\n    setError(null);\n\n    try {\n      const res = await fetch('/api/payment-confirmation', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          confirmationToken: token,\n          amount: parseFloat(amount),\n          paymentMethod,\n          datePaid,\n          clientNotes,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.message || 'Failed to confirm payment');\n      }\n\n      setSuccess(true);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to confirm payment');\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  // Loading state\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"h-12 w-12 animate-spin rounded-full border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading confirmation...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error && !confirmation) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n          <div className=\"text-center\">\n            <svg\n              className=\"mx-auto h-12 w-12 text-red-500\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <h2 className=\"mt-4 text-xl font-semibold text-gray-900\">Error</h2>\n            <p className=\"mt-2 text-gray-600\">{error}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Success state\n  if (success) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n          <div className=\"text-center\">\n            <svg\n              className=\"mx-auto h-12 w-12 text-green-500\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <h2 className=\"mt-4 text-xl font-semibold text-gray-900\">Payment Confirmed!</h2>\n            <p className=\"mt-2 text-gray-600\">\n              Thank you for confirming your payment. The freelancer has been notified and will\n              verify receipt.\n            </p>\n            <p className=\"mt-4 text-sm text-gray-500\">You may close this page.</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Already confirmed\n  if (confirmation?.status !== 'pending_client') {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n          <div className=\"text-center\">\n            <svg\n              className=\"mx-auto h-12 w-12 text-blue-500\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <h2 className=\"mt-4 text-xl font-semibold text-gray-900\">Already Confirmed</h2>\n            <p className=\"mt-2 text-gray-600\">\n              This payment has already been confirmed. No further action is needed.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Main form\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Confirm Payment</h1>\n          <p className=\"mt-2 text-sm text-gray-600\">\n            Please confirm that you have sent the payment for this invoice.\n          </p>\n        </div>\n\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded\">\n            {error}\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <AccessibleFormField\n            id=\"amount\"\n            label=\"Amount Paid (£)\"\n            type=\"number\"\n            step=\"0.01\"\n            min=\"0\"\n            required\n            value={amount}\n            onChange={(e) => setAmount(e.target.value)}\n            helpText={`Expected: £${confirmation?.expectedAmount.toFixed(2)}`}\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n\n          <AccessibleFormField\n            id=\"paymentMethod\"\n            label=\"Payment Method\"\n            type=\"select\"\n            required\n            value={paymentMethod}\n            onChange={(e) => setPaymentMethod(e.target.value as 'bank_transfer' | 'card')}\n            options={[\n              { value: 'bank_transfer', label: 'Bank Transfer' },\n              { value: 'card', label: 'Card Payment' }\n            ]}\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n\n          <AccessibleFormField\n            id=\"datePaid\"\n            label=\"Date Paid\"\n            type=\"date\"\n            required\n            value={datePaid}\n            onChange={(e) => setDatePaid(e.target.value)}\n            max={format(new Date(), 'yyyy-MM-dd')}\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n\n          <AccessibleFormField\n            id=\"clientNotes\"\n            label=\"Notes\"\n            type=\"textarea\"\n            rows={3}\n            value={clientNotes}\n            onChange={(e) => setClientNotes(e.target.value)}\n            placeholder=\"Any additional notes about the payment...\"\n            helpText=\"Optional\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n\n          <button\n            type=\"submit\"\n            disabled={submitting}\n            className=\"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed\"\n          >\n            {submitting ? 'Confirming...' : 'Confirm Payment'}\n          </button>\n        </form>\n\n        <p className=\"mt-6 text-xs text-center text-gray-500\">\n          This confirmation link expires on{' '}\n          {confirmation && format(new Date(confirmation.expiresAt), 'PPP')}\n        </p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}
module.exports=[874321,438220,609730,e=>{"use strict";let t=Symbol.for("constructDateFrom");function a(e,a){return"function"==typeof e?e(a):e&&"object"==typeof e&&t in e?e[t](a):e instanceof Date?new e.constructor(a):new Date(a)}function n(e,t){return a(t||e,e)}e.s(["constructFromSymbol",0,t,"millisecondsInDay",0,864e5],438220),e.s(["constructFrom",()=>a],874321),e.s(["toDate",()=>n],609730)},439251,e=>{"use strict";var t=e.i(874321);function a(e,...n){let i=t.constructFrom.bind(null,e||n.find(e=>"object"==typeof e));return n.map(i)}var n=e.i(609730);function i(e){let t=(0,n.toDate)(e),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return a.setUTCFullYear(t.getFullYear()),e-a}var r=e.i(438220);function o(e,t){let a=(0,n.toDate)(e,t?.in);return a.setHours(0,0,0,0),a}function s(e,t,n){let[s,c]=a(n?.in,e,t),d=l(s,c),u=Math.abs(function(e,t,n){let[s,l]=a(void 0,e,t),c=o(s),d=o(l);return Math.round((c-i(c)-(d-i(d)))/r.millisecondsInDay)}(s,c));s.setDate(s.getDate()-d*u);let p=Number(l(s,c)===-d),h=d*(u-p);return 0===h?0:h}function l(e,t){let a=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return a<0?-1:a>0?1:a}e.s(["differenceInDays",()=>s],439251)},384986,e=>{"use strict";var t=e.i(874321),a=e.i(609730);function n(e,n,i){return function(e,n,i){let r=(0,a.toDate)(e,i?.in);if(isNaN(n))return(0,t.constructFrom)(i?.in||e,NaN);if(!n)return r;let o=r.getDate(),s=(0,t.constructFrom)(i?.in||e,r.getTime());return(s.setMonth(r.getMonth()+n+1,0),o>=s.getDate())?s:(r.setFullYear(s.getFullYear(),s.getMonth(),o),r)}(e,-n,i)}e.s(["subMonths",()=>n],384986)},678043,e=>e.a(async(t,a)=>{try{var n=e.i(89171),i=e.i(707218),r=e.i(868253),o=e.i(15776),s=e.i(963),l=e.i(169907),c=e.i(439251),d=e.i(384986),u=t([r]);async function p(e){let t=Date.now();try{var a,u,p;let e,h,g,{userId:f}=await (0,i.auth)();if(!f)throw new o.UnauthorizedError;(0,l.logApiRequest)("GET","/api/dashboard/predictions",f);let{allowed:m,remaining:D}=(0,s.checkUserRateLimit)(f,{windowMs:6e4,maxRequests:10});if(!m)throw new o.RateLimitError;let y=(0,d.subMonths)(new Date,6),v=(await r.db.collection(r.COLLECTIONS.INVOICES).where("freelancerId","==",f).where("createdAt",">=",y).get()).docs.map(e=>e.data()),R=[],w=new Date,E=(a=v,e=new Map,a.filter(e=>"paid"===e.status&&e.paidAt).forEach(t=>{let a=t.paidAt instanceof Date?t.paidAt:t.paidAt.toDate(),n=`${a.getFullYear()}-${a.getMonth()+1}`;e.set(n,(e.get(n)||0)+t.amount)}),Array.from(e.values()));if(E.length>=3){let e=E.reduce((e,t)=>e+t,0)/E.length,t=function(e){if(e.length<2)return 0;let t=e.slice(-3),a=e.slice(0,-3);if(0===a.length)return 0;let n=t.reduce((e,t)=>e+t,0)/t.length,i=a.reduce((e,t)=>e+t,0)/a.length;return(n-i)/i}(E),a=e*(1+t);R.push({type:"revenue",title:"Next Month Revenue Forecast",prediction:`\xa3${a.toFixed(2)}`,description:`Based on ${E.length} months of data, predicting ${t>0?"growth":"decline"} of ${Math.abs(100*t).toFixed(1)}%.`,confidence:(u=E).length<3?.3:u.length<6?.6:u.length<12?.8:.9,metrics:{historical:e,predicted:a,trend:100*t}})}let x=v.filter(e=>"paid"===e.status&&e.paidAt&&e.invoiceDate);if(x.length>=5){let e=x.map(e=>{let t=e.paidAt instanceof Date?e.paidAt:e.paidAt.toDate(),a=e.invoiceDate instanceof Date?e.invoiceDate:e.invoiceDate.toDate();return(0,c.differenceInDays)(t,a)}),t=e.reduce((e,t)=>e+t,0)/e.length;R.push({type:"payment_timing",title:"Average Payment Time",prediction:`${Math.round(t)} days`,description:`Your clients typically pay within ${Math.round(t)} days of invoice being sent.`,confidence:Math.min(.9,x.length/20),metrics:{averageDays:Math.round(t),fastestPayment:Math.min(...e),slowestPayment:Math.max(...e)}})}let A=v.filter(e=>"paid"!==e.status&&"cancelled"!==e.status);if(A.length>0){let e=A.reduce((e,t)=>e+t.amount,0),t=A.filter(e=>e.dueDate&&(e.dueDate instanceof Date?e.dueDate:e.dueDate.toDate())<w).length,a=e*(x.length/Math.max(1,v.length));R.push({type:"recovery",title:"Expected Payment Recovery",prediction:`\xa3${a.toFixed(2)}`,description:`Of \xa3${e.toFixed(2)} outstanding, expecting to recover ${(a/e*100).toFixed(0)}% based on historical patterns.`,confidence:.7,metrics:{totalOutstanding:e,expectedRecovery:a,overdueCount:t,recoveryRate:x.length/Math.max(1,v.length)*100}})}let b=v.filter(e=>e.collectionsEnabled),M=b.filter(e=>"paid"===e.status);if(b.length>=3){let e=M.length/b.length*100,t=A.filter(e=>!e.collectionsEnabled&&e.dueDate&&(0,c.differenceInDays)(w,e.dueDate instanceof Date?e.dueDate:e.dueDate.toDate())>=7);if(t.length>0){let a=t.reduce((e,t)=>e+t.amount,0),n=e/100*a;R.push({type:"collections",title:"Collections Potential",prediction:`\xa3${n.toFixed(2)}`,description:`${t.length} invoice${t.length>1?"s":""} eligible for collections. Historical success rate: ${e.toFixed(0)}%.`,confidence:Math.min(.85,b.length/10),metrics:{eligibleCount:t.length,potentialAmount:a,predictedRecovery:n,successRate:e}})}}let C=(p=v,h=new Map,p.forEach(e=>{h.has(e.clientEmail)||h.set(e.clientEmail,{name:e.clientName,invoices:0,totalPaid:0,avgDays:0,paymentDays:[]});let t=h.get(e.clientEmail);if(t.invoices++,"paid"===e.status&&e.paidAt&&e.invoiceDate){t.totalPaid+=e.amount;let a=e.paidAt instanceof Date?e.paidAt:e.paidAt.toDate(),n=e.invoiceDate instanceof Date?e.invoiceDate:e.invoiceDate.toDate(),i=(0,c.differenceInDays)(a,n);t.paymentDays.push(i)}}),{bestClients:(g=Array.from(h.values()).map(e=>({...e,avgDays:e.paymentDays.length>0?Math.round(e.paymentDays.reduce((e,t)=>e+t,0)/e.paymentDays.length):0}))).filter(e=>e.totalPaid>0).sort((e,t)=>t.totalPaid-e.totalPaid).slice(0,5),slowestPayers:g.filter(e=>e.avgDays>0).sort((e,t)=>t.avgDays-e.avgDays).slice(0,5)});if(C.bestClients.length>0){let e=C.bestClients[0];R.push({type:"client_value",title:"Top Client Insight",prediction:`${e.name}`,description:`Your best client with ${e.invoices} invoices (\xa3${e.totalPaid.toFixed(2)} paid). Average payment: ${e.avgDays} days.`,confidence:.95,metrics:e})}let N=v.filter(e=>"sent"===e.status&&e.dueDate&&(e.dueDate instanceof Date?e.dueDate:e.dueDate.toDate())>w&&30>=(0,c.differenceInDays)(e.dueDate instanceof Date?e.dueDate:e.dueDate.toDate(),w));if(N.length>0){let e=N.reduce((e,t)=>e+t.amount,0);R.push({type:"cashflow",title:"Next 30 Days Cashflow",prediction:`\xa3${e.toFixed(2)}`,description:`${N.length} invoice${N.length>1?"s":""} expected within 30 days.`,confidence:.75,metrics:{count:N.length,totalAmount:e,averageAmount:e/N.length}})}let P=Date.now()-t;return(0,l.logApiResponse)("GET","/api/dashboard/predictions",200,{duration:P,userId:f}),n.NextResponse.json({predictions:R,total:R.length,generatedAt:w.toISOString(),remainingRequests:D})}catch(r){let e=Date.now()-t;(0,l.logApiResponse)("GET","/api/dashboard/predictions",500,{duration:e});let{status:a,body:i}=await (0,o.handleApiError)(r);return n.NextResponse.json(i,{status:a})}}[r]=u.then?(await u)():u,e.s(["GET",()=>p,"dynamic",0,"force-dynamic"]),a()}catch(e){a(e)}},!1),476582,e=>e.a(async(t,a)=>{try{var n=e.i(747909),i=e.i(174017),r=e.i(996250),o=e.i(759756),s=e.i(561916),l=e.i(114444),c=e.i(837092),d=e.i(869741),u=e.i(316795),p=e.i(487718),h=e.i(995169),g=e.i(47587),f=e.i(666012),m=e.i(570101),D=e.i(626937),y=e.i(10372),v=e.i(193695);e.i(52474);var R=e.i(600220),w=e.i(678043),E=t([w]);[w]=E.then?(await E)():E;let b=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/dashboard/predictions/route",pathname:"/api/dashboard/predictions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/dashboard/predictions/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:M,workUnitAsyncStorage:C,serverHooks:N}=b;function x(){return(0,r.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:C})}async function A(e,t,a){b.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/dashboard/predictions/route";n=n.replace(/\/index$/,"")||"/";let r=await b.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:x,parsedUrl:A,isDraftMode:M,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:F,clientReferenceManifest:$,serverActionsManifest:S}=r,I=(0,d.normalizeAppPath)(n),O=!!(C.dynamicRoutes[I]||C.routes[F]),H=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(O&&!M){let e=!!C.routes[F],t=C.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await H();throw new v.NoFallbackError}}let _=null;!O||b.isDev||M||(_=F,_="/index"===_?"/":_);let U=!0===b.isDev||!O,q=O&&!U;S&&$&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:$,serverActionsManifest:S,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:S})});let k=e.method||"GET",j=(0,s.getTracer)(),Y=j.getActiveScopeSpan(),L={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>b.onRequestError(e,t,n,N)},sharedContext:{buildId:w}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),B=p.NextRequestAdapter.fromNodeNextRequest(K,(0,p.signalFromNodeResponse)(t));try{let r=async e=>b.handle(B,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=j.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${k} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${n}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var s,c;let d=async({previousCacheEntry:i})=>{try{if(!l&&P&&T&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await r(o);e.fetchMetrics=L.renderOpts.fetchMetrics;let s=L.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let c=L.renderOpts.collectedTags;if(!O)return await (0,f.sendResponse)(K,G,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})},N),t}},u=await b.handleResponse({req:e,nextConfig:x,cacheKey:_,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!O)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),M&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&O||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,D.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(K,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};Y?await c(Y):await j.withPropagatedContext(e.headers,()=>j.trace(h.BaseServerSpan.handleRequest,{spanName:`${k} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},c))}catch(t){if(t instanceof v.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:P})}),O)throw t;return await (0,f.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>x,"routeModule",()=>b,"serverHooks",()=>N,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>C]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_cb0d6b61._.js.map
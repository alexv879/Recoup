module.exports=[456300,e=>e.a(async(r,t)=>{try{let r=await e.y("firebase-admin/app");e.n(r),t()}catch(e){t(e)}},!0),894222,e=>e.a(async(r,t)=>{try{let r=await e.y("firebase-admin/storage");e.n(r),t()}catch(e){t(e)}},!0),868253,e=>e.a(async(r,t)=>{try{var o=e.i(456300),s=e.i(155742),n=e.i(894222),i=r([o,s,n]);if([o,s,n]=i.then?(await i)():i,!(0,o.getApps)().length)try{let e=process.env.FIREBASE_PROJECT_ID,r=process.env.FIREBASE_CLIENT_EMAIL,t=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");e&&r&&t?((0,o.initializeApp)({credential:(0,o.cert)({projectId:e,clientEmail:r,privateKey:t})}),console.log("✅ Firebase Admin initialized successfully")):console.warn("⚠️  Firebase credentials not configured - app will not function at runtime")}catch(e){console.error("❌ Firebase Admin initialization error:",e)}let a=null,E=new Proxy({},{get:(e,r)=>(function(){if(!a){if(!(0,o.getApps)().length)throw Error("Firebase is not initialized. Make sure environment variables are configured.");a=(0,s.getFirestore)()}return a})()[r]}),c=(0,n.getStorage)();e.s(["COLLECTIONS",0,{USERS:"users",INVOICES:"invoices",PAYMENT_CONFIRMATIONS:"payment_confirmations",PAYMENT_CLAIMS:"payment_claims",COLLECTION_ATTEMPTS:"collection_attempts",CLIENTS:"clients",NOTIFICATIONS:"notifications",TRANSACTIONS:"transactions",REFERRALS:"referrals",REFERRAL_CREDITS:"referral_credits",REFERRAL_PAYOUTS:"referral_payouts",USER_BEHAVIOR_PROFILE:"user_behavior_profile",USER_STATS:"user_stats",USER_EVENTS:"user_events",DAILY_SUMMARIES:"daily_summaries",EMAILS_SENT:"emails_sent",ONBOARDING_PROGRESS:"onboarding_progress",AGENCY_HANDOFFS:"agency_handoffs"},"db",0,E,"firestore",0,E,"storage",0,c]),t()}catch(e){t(e)}},!1),169907,e=>{"use strict";let r={info:(e,r)=>{r?console.log(`[INFO] ${r}`,e):console.log("[INFO]",e)},error:(e,r)=>{r?console.error(`[ERROR] ${r}`,e):console.error("[ERROR]",e)},warn:(e,r)=>{r?console.warn(`[WARN] ${r}`,e):console.warn("[WARN]",e)}};e.s(["logApiRequest",0,(e,t,o)=>{r.info({method:e,url:t,...o},"API Request")},"logApiResponse",0,(e,t,o,s)=>{r.info({method:e,url:t,status:o,...s},"API Response")},"logDbOperation",0,(e,t,o)=>{r.info({operation:e,collection:t,...o},"Database Operation")},"logError",0,(e,t)=>{r.error(t,e)},"logInfo",0,(e,t)=>{r.info(t,e)},"logWarn",0,(e,t)=>{r.warn(t,e)},"logger",0,r])},15776,e=>{"use strict";var r=e.i(169907),t=e.i(915874);class o extends Error{code;statusCode;constructor(e,r,t=500){super(r),this.code=e,this.statusCode=t,this.name="CustomError"}}class s extends o{constructor(e){super("VALIDATION_ERROR",e,400)}}class n extends o{constructor(e="Unauthorized"){super("UNAUTHORIZED",e,401)}}class i extends o{constructor(e="Forbidden"){super("FORBIDDEN",e,403)}}class a extends o{constructor(e="Not found"){super("NOT_FOUND",e,404)}}class E extends o{constructor(e="Bad request"){super("BAD_REQUEST",e,400)}}class c extends o{constructor(e="Rate limit exceeded"){super("RATE_LIMIT",e,429)}}async function l(e){return e instanceof t.ZodError?{status:400,body:{error:"VALIDATION_ERROR",message:"The request body is invalid.",fields:e.errors.reduce((e,r)=>(e[r.path.join(".")]=r.message,e),{})}}:e instanceof o?{status:e.statusCode,body:{error:e.code,message:e.message}}:(r.logger.error({err:e},"An unknown error occurred in handleError"),{status:500,body:{error:"INTERNAL_ERROR",message:"An unexpected error occurred"}})}e.s(["BadRequestError",()=>E,"ForbiddenError",()=>i,"NotFoundError",()=>a,"RateLimitError",()=>c,"UnauthorizedError",()=>n,"ValidationError",()=>s,"errors",0,{VALIDATION_ERROR:"VALIDATION_ERROR",UNAUTHORIZED:"UNAUTHORIZED",FORBIDDEN:"FORBIDDEN",NOT_FOUND:"NOT_FOUND",INTERNAL_ERROR:"INTERNAL_ERROR"},"handleApiError",0,l,"handleError",()=>l])},725639,e=>{"use strict";function r(e){return"paid"===e?"pro":e}let t={free:1,starter:10,growth:25,pro:Number.MAX_SAFE_INTEGER,paid:25};e.s(["ACHIEVEMENTS",0,{FIRST_INVOICE:{id:"first_invoice",name:"First Invoice",description:"Created your first invoice",threshold:500},COLLECTOR_5K:{id:"collector_5k",name:"Collector 5K",description:"Collected £5,000",threshold:5e3},COLLECTOR_50K:{id:"collector_50k",name:"Collector 50K",description:"Collected £50,000",threshold:5e4},RELIABLE:{id:"reliable",name:"Reliable",description:"90% on-time payments",threshold:90},WEEK_STREAK:{id:"week_streak",name:"Week Streak",description:"7 days without overdue",threshold:7},MONTH_STREAK:{id:"month_streak",name:"Month Streak",description:"30 days without overdue",threshold:30},TOP_100:{id:"top_100",name:"Top 100",description:"Ranked in top 100 users",threshold:100}},"APP_DESCRIPTION",0,"Smart invoicing and payment tracking for freelancers","APP_NAME",0,"Recoup","BUSINESS_TYPES",0,{FREELANCER:"freelancer",AGENCY:"agency",CONSULTANT:"consultant"},"COLLECTIONS_DEMO_LIMIT_FREE",0,1,"COLLECTIONS_LIMITS",0,t,"COLLECTION_DAY_15_REMINDER",0,15,"COLLECTION_DAY_30_REMINDER",0,30,"COLLECTION_DAY_45_AGENCY_HANDOFF",0,45,"COLLECTION_DAY_5_REMINDER",0,5,"DEFAULT_CURRENCY",0,"GBP","DEFAULT_LANGUAGE",0,"en","DEFAULT_QUIET_HOURS",0,{start:"21:00",end:"08:00"},"DEFAULT_TIMEZONE",0,"Europe/London","EMAIL_TEMPLATES",0,{INVOICE:"invoice",REMINDER_DAY_7:"reminder_day_7",REMINDER_DAY_21:"reminder_day_21",PAYMENT_CONFIRMED:"payment_confirmed",NOTIFICATION:"notification"},"FOUNDING_MEMBER_LIMIT",0,50,"FOUNDING_MEMBER_PRICING",0,{starter:9.5,growth:19.5,pro:37.5},"INVOICE_STATUS",0,{DRAFT:"draft",SENT:"sent",PAID:"paid",OVERDUE:"overdue",IN_COLLECTIONS:"in_collections",DISPUTED:"disputed",CANCELLED:"cancelled"},"MAX_NOTIFICATIONS_PER_DAY",0,3,"NOTIFICATION_CONFIDENCE_THRESHOLD",0,.6,"NOTIFICATION_EXPIRY_DAYS",0,30,"NOTIFICATION_TYPES",0,{INVOICE_DROUGHT:"invoice_drought",PAYMENT_DELAY:"payment_delay",WIN:"win",PREDICTION:"prediction",OPPORTUNITY:"opportunity",DAILY_DIGEST:"daily_digest"},"PAYMENT_CONFIRMATION_STATUS",0,{PENDING_CLIENT:"pending_client",CLIENT_CONFIRMED:"client_confirmed",BOTH_CONFIRMED:"both_confirmed",EXPIRED:"expired",CANCELLED:"cancelled"},"PAYMENT_CONFIRMATION_TOKEN_EXPIRY_DAYS",0,30,"PAYMENT_METHODS",0,{BANK_TRANSFER:"bank_transfer",CARD:"card"},"POINTS_PER_1000_COLLECTED",0,1,"POINTS_PER_BADGE",0,10,"POINTS_PER_LEVEL",0,100,"POINTS_PER_STREAK_DAY",0,1,"RATE_LIMIT",0,{GENERAL:{requests:10,window:"10s"},AUTH:{requests:5,window:"60s"},AI:{requests:3,window:"60s"}},"RECOUP_COMMISSION_RATE",0,.03,"REFERRAL_CREDIT_REFERRED",0,5,"REFERRAL_CREDIT_REFERRER",0,5,"STANDARD_PRICING",0,{starter:19,growth:39,pro:75},"SUBSCRIPTION_TIERS",0,{FREE:"free",PAID:"paid",STARTER:"starter",GROWTH:"growth",PRO:"pro"},"SUPPORTED_CURRENCIES",0,["GBP","USD","EUR"],"SUPPORTED_LANGUAGES",0,["en","es","fr"],"TIER_LEVELS",0,{free:0,starter:1,growth:2,pro:3,paid:2},"USER_STATUS",0,{ACTIVE:"active",SUSPENDED:"suspended",DELETED:"deleted"},"VALIDATION",0,{MAX_INVOICE_DESCRIPTION_LENGTH:500,MAX_CLIENT_NAME_LENGTH:100,MAX_BUSINESS_NAME_LENGTH:100,MAX_NOTE_LENGTH:1e3,MIN_INVOICE_AMOUNT:.01,MAX_INVOICE_AMOUNT:1e6,UK_ACCOUNT_NUMBER_LENGTH:8,UK_SORT_CODE_LENGTH:6},"normalizeTier",()=>r])},520143,e=>e.a(async(r,t)=>{try{var o=e.i(707218),s=e.i(868253),n=e.i(155742),i=e.i(15776),a=e.i(725639),E=e.i(169907),c=r([s,n]);async function l(e,r){try{var t,n;let{has:c}=await (0,o.auth)();if(!c)throw(0,E.logWarn)("Clerk auth not available in checkClerkFeatureAccess",{userId:e}),i.errors.unauthorized("User not authenticated");let l=c({feature:r}),_=await s.db.collection("users").doc(e).get();if(!_.exists)return{hasAccess:!1,reason:"User not found"};let d=_.data(),I=(0,a.normalizeTier)(d.subscriptionTier);if(r.startsWith("collections_limit_")){let e=a.COLLECTIONS_LIMITS[I],r=d.collectionsUsedThisMonth||0,o=e===1/0?1/0:Math.max(0,e-r);if(e!==1/0&&r>=e){let o,s;return{hasAccess:!1,reason:`Monthly quota exceeded (${r}/${e} collections used this month)`,upgradeRequired:!0,suggestedTier:(t=I,s=(o=["free","starter","growth","pro"]).indexOf(t),-1===s||s>=o.length-1?"business":o[s+1]),quotaInfo:{used:r,limit:e,remaining:0}}}return{hasAccess:!0,quotaInfo:{used:r,limit:e===1/0?999999:e,remaining:e===1/0?999999:o}}}if(!l){return{hasAccess:!1,reason:`Feature '${r}' not available on your ${I} plan`,upgradeRequired:!0,suggestedTier:(n=r,"physical_letters_15_per_month"===n||"ai_voice_calls_20_per_month"===n||"collections_unlimited"===n||"dedicated_account_manager"===n?"business":"sms_reminders"===n||"ai_voice_calls_5_per_month"===n||"collections_limit_25"===n||"advanced_analytics"===n?"pro":"collections_limit_10"===n?"starter":"pro")}}return{hasAccess:!0}}catch(t){return(0,E.logError)("Error checking Clerk feature access",t,{userId:e,feature:r}),{hasAccess:!1,reason:"Error checking subscription status"}}}async function _(e,r){let{hasAccess:t,reason:o,suggestedTier:s,quotaInfo:n}=await l(e,r);if(!t)throw i.errors.paymentRequired(o||"Upgrade required to access this feature",{feature:r,suggestedTier:s,quotaInfo:n});(0,E.logInfo)("Premium feature access granted",{userId:e,feature:r,quotaInfo:n})}async function d(e,r){try{let t=s.db.collection("users").doc(e);await t.update({collectionsUsedThisMonth:n.FieldValue.increment(1),updatedAt:n.FieldValue.serverTimestamp()}),(0,E.logInfo)("Usage counter incremented",{userId:e,usageType:r})}catch(t){(0,E.logError)("Error incrementing usage counter",t,{userId:e,usageType:r})}}async function I(e){try{if(e)await s.db.collection("users").doc(e).update({collectionsUsedThisMonth:0,monthlyUsageResetDate:n.FieldValue.serverTimestamp(),updatedAt:n.FieldValue.serverTimestamp()}),(0,E.logInfo)("Monthly usage reset for user",{userId:e});else{let e=await s.db.collection("users").get(),r=s.db.batch();e.docs.forEach(e=>{r.update(e.ref,{collectionsUsedThisMonth:0,monthlyUsageResetDate:n.FieldValue.serverTimestamp(),updatedAt:n.FieldValue.serverTimestamp()})}),await r.commit(),(0,E.logInfo)("Monthly usage reset for all users",{totalUsers:e.size})}}catch(r){throw(0,E.logError)("Error resetting monthly usage",r,{userId:e}),r}}async function R(e){let r=await s.db.collection("users").doc(e).get();if(!r.exists)throw i.errors.notFound("User not found");let t=r.data(),o=(0,a.normalizeTier)(t.subscriptionTier),n=a.COLLECTIONS_LIMITS[o],E=t.collectionsUsedThisMonth||0,c=n===1/0?1/0:Math.max(0,n-E),l=n===1/0?0:E/n*100;return{tier:o,used:E,limit:n===1/0?999999:n,remaining:n===1/0?999999:c,percentageUsed:l,isNearLimit:l>=80}}[s,n]=c.then?(await c)():c,e.s(["getUserQuotaInfo",()=>R,"incrementUsageCounter",()=>d,"requireClerkFeature",()=>_,"resetMonthlyUsage",()=>I]),t()}catch(e){t(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__7ef8faa4._.js.map
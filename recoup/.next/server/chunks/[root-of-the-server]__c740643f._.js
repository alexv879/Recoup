module.exports=[145706,(e,t,n)=>{t.exports=e.x("querystring",()=>require("querystring"))},500874,(e,t,n)=>{t.exports=e.x("buffer",()=>require("buffer"))},166395,(e,t,n)=>{"use strict";var r=e.e&&e.e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e.e&&e.e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.req=n.json=n.toBuffer=void 0;let s=o(e.r(921517)),a=o(e.r(524836));async function l(e){let t=0,n=[];for await(let r of e)t+=r.length,n.push(r);return Buffer.concat(n,t)}n.toBuffer=l,n.json=async function(e){let t=(await l(e)).toString("utf8");try{return JSON.parse(t)}catch(e){throw e.message+=` (input: ${t})`,e}},n.req=function(e,t={}){let n=(("string"==typeof e?e:e.href).startsWith("https:")?a:s).request(e,t),r=new Promise((e,t)=>{n.once("response",e).once("error",t).end()});return n.then=r.then.bind(r),n}},760992,(e,t,n)=>{"use strict";var r=e.e&&e.e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e.e&&e.e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=e.e&&e.e.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.Agent=void 0;let a=o(e.r(504446)),l=o(e.r(921517)),c=e.r(524836);s(e.r(166395),n);let u=Symbol("AgentBaseInternalState");class p extends l.Agent{constructor(e){super(e),this[u]={}}isSecureEndpoint(e){if(e){if("boolean"==typeof e.secureEndpoint)return e.secureEndpoint;if("string"==typeof e.protocol)return"https:"===e.protocol}let{stack:t}=Error();return"string"==typeof t&&t.split("\n").some(e=>-1!==e.indexOf("(https.js:")||-1!==e.indexOf("node:https:"))}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new a.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||null===t)return;let n=this.sockets[e],r=n.indexOf(t);-1!==r&&(n.splice(r,1),this.totalSocketCount--,0===n.length&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?c.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let r={...t,secureEndpoint:this.isSecureEndpoint(t)},i=this.getName(r),o=this.incrementSockets(i);Promise.resolve().then(()=>this.connect(e,r)).then(s=>{if(this.decrementSockets(i,o),s instanceof l.Agent)try{return s.addRequest(e,r)}catch(e){return n(e)}this[u].currentSocket=s,super.createSocket(e,t,n)},e=>{this.decrementSockets(i,o),n(e)})}createConnection(){let e=this[u].currentSocket;if(this[u].currentSocket=void 0,!e)throw Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[u].defaultPort??("https:"===this.protocol?443:80)}set defaultPort(e){this[u]&&(this[u].defaultPort=e)}get protocol(){return this[u].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[u]&&(this[u].protocol=e)}}n.Agent=p},613752,(e,t,n)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.parseProxyResponse=void 0;let i=(0,r(e.r(817293)).default)("https-proxy-agent:parse-proxy-response");n.parseProxyResponse=function(e){return new Promise((t,n)=>{let r=0,o=[];function s(){let l=e.read();l?function(l){o.push(l),r+=l.length;let c=Buffer.concat(o,r),u=c.indexOf("\r\n\r\n");if(-1===u){i("have not received end of HTTP headers yet..."),s();return}let p=c.slice(0,u).toString("ascii").split("\r\n"),g=p.shift();if(!g)return e.destroy(),n(Error("No header received from proxy CONNECT response"));let f=g.split(" "),d=+f[1],h=f.slice(2).join(" "),_={};for(let t of p){if(!t)continue;let r=t.indexOf(":");if(-1===r)return e.destroy(),n(Error(`Invalid header from proxy CONNECT response: "${t}"`));let i=t.slice(0,r).toLowerCase(),o=t.slice(r+1).trimStart(),s=_[i];"string"==typeof s?_[i]=[s,o]:Array.isArray(s)?s.push(o):_[i]=o}i("got proxy server response: %o %o",g,_),a(),t({connect:{statusCode:d,statusText:h,headers:_},buffered:c})}(l):e.once("readable",s)}function a(){e.removeListener("end",l),e.removeListener("error",c),e.removeListener("readable",s)}function l(){a(),i("onend"),n(Error("Proxy connection ended before receiving CONNECT response"))}function c(e){a(),i("onerror %o",e),n(e)}e.on("error",c),e.on("end",l),s()})}},869179,(e,t,n)=>{"use strict";var r=e.e&&e.e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e.e&&e.e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},s=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.HttpsProxyAgent=void 0;let a=o(e.r(504446)),l=o(e.r(755004)),c=s(e.r(449719)),u=s(e.r(817293)),p=e.r(760992),g=e.r(792509),f=e.r(613752),d=(0,u.default)("https-proxy-agent"),h=e=>void 0===e.servername&&e.host&&!a.isIP(e.host)?{...e,servername:e.host}:e;class _ extends p.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy="string"==typeof e?new g.URL(e):e,this.proxyHeaders=t?.headers??{},d("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),r=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?v(t,"headers"):null,host:n,port:r}}async connect(e,t){let n,{proxy:r}=this;if(!t.host)throw TypeError('No "host" provided');"https:"===r.protocol?(d("Creating `tls.Socket`: %o",this.connectOpts),n=l.connect(h(this.connectOpts))):(d("Creating `net.Socket`: %o",this.connectOpts),n=a.connect(this.connectOpts));let i="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},o=a.isIPv6(t.host)?`[${t.host}]`:t.host,s=`CONNECT ${o}:${t.port} HTTP/1.1\r
`;if(r.username||r.password){let e=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}for(let e of(i.Host=`${o}:${t.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close"),Object.keys(i)))s+=`${e}: ${i[e]}\r
`;let u=(0,f.parseProxyResponse)(n);n.write(`${s}\r
`);let{connect:p,buffered:g}=await u;if(e.emit("proxyConnect",p),this.emit("proxyConnect",p,e),200===p.statusCode)return(e.once("socket",m),t.secureEndpoint)?(d("Upgrading socket connection to TLS"),l.connect({...v(h(t),"host","path","port"),socket:n})):n;n.destroy();let _=new a.Socket({writable:!1});return _.readable=!0,e.once("socket",e=>{d("Replaying proxy buffer for failed request"),(0,c.default)(e.listenerCount("data")>0),e.push(g),e.push(null)}),_}}function m(e){e.resume()}function v(e,...t){let n,r={};for(n in e)t.includes(n)||(r[n]=e[n]);return r}_.protocols=["http","https"],n.HttpsProxyAgent=_},707669,e=>{e.v({name:"mixpanel",description:"A simple server-side API for mixpanel",keywords:["mixpanel","analytics","api","stats"],version:"0.19.1",homepage:"https://github.com/mixpanel/mixpanel-node",author:"Carl Sverre",license:"MIT",main:"lib/mixpanel-node",directories:{lib:"lib"},repository:{type:"git",url:"git+ssh://git@github.com/mixpanel/mixpanel-node.git"},engines:{node:">=10.0"},scripts:{test:"vitest"},types:"./lib/mixpanel-node.d.ts",devDependencies:{"@types/node":"^24.10.1","@vitest/coverage-v8":"^4.0.8",nock:"^14.0.10",proxyquire:"^2.1.3",typescript:"^5.9.3",vitest:"^4.0.8"},dependencies:{"https-proxy-agent":"7.0.6"}})},972199,(e,t,n)=>{n.async_all=function(e,t,n){var r=e.length,i=null,o=[],s=function(e,t){e&&(i=i||[]).push(e),o.push(t),0==--r&&n(i,o)};if(0===r)n(i,o);else for(var a=0,l=e.length;a<l;a++)t(e[a],s)},n.ensure_timestamp=function(e){if(!(e instanceof Date||"number"==typeof e))throw Error("`time` property must be a Date or Unix timestamp and is only required for `import` endpoint");return e instanceof Date?e.getTime():e},n.assert_logger=function(e){if("object"!=typeof e)throw TypeError('"logger" must be a valid Logger object');["trace","debug","info","warn","error"].forEach(t=>{if("function"!=typeof e[t])throw TypeError(`Logger object missing "${t}" method`)})}},585310,(e,t,n)=>{let{ensure_timestamp:r}=e.r(972199);function i(e,t){return t&&(t.$ignore_alias&&(e.$ignore_alias=t.$ignore_alias),t.$ignore_time&&(e.$ignore_time=t.$ignore_time),t.hasOwnProperty("$ip")&&(e.$ip=t.$ip),t.hasOwnProperty("$time")&&(e.$time=r(t.$time)),t.hasOwnProperty("$latitude")&&t.hasOwnProperty("$longitude")&&(e.$latitude=t.$latitude,e.$longitude=t.$longitude)),e}n.merge_modifiers=i,n.ProfileHelpers=(e=Object)=>class extends e{get token(){return this.mixpanel.token}get config(){return this.mixpanel.config}_set(e,t,n,r,{identifiers:o,set_once:s=!1}){let a={};"object"==typeof e?("object"==typeof t?(r=n,n=t):r=t,a=e):(a[e]=t,"function"!=typeof n&&n||(r=n));let l={$token:this.token,...o};l[s?"$set_once":"$set"]=a,"ip"in a&&(l.$ip=a.ip,delete a.ip),a.$ignore_time&&(l.$ignore_time=a.$ignore_time,delete a.$ignore_time),l=i(l,n),this.config.debug&&this.mixpanel.config.logger.debug(`Sending the following data to Mixpanel (${this.endpoint})`,{data:l}),this.mixpanel.send_request({method:"GET",endpoint:this.endpoint,data:l},r)}_delete_profile({identifiers:e,modifiers:t,callback:n}){let r={$delete:"",$token:this.token,...e};"function"==typeof t&&(n=t),r=i(r,t),this.config.debug&&this.mixpanel.config.logger.debug("Deleting profile",{identifiers:e}),this.mixpanel.send_request({method:"GET",endpoint:this.endpoint,data:r},n)}_remove({identifiers:e,data:t,modifiers:n,callback:r}){let o={};if("object"!=typeof t||Array.isArray(t)){this.config.debug&&this.mixpanel.config.logger.error("Invalid value passed to #remove - data must be an object with scalar values");return}for(let[e,n]of Object.entries(t))if("string"==typeof n||"number"==typeof n)o[e]=n;else{this.config.debug&&this.mixpanel.config.logger.error("Invalid argument passed to #remove - values must be scalar",{key:e,value:n});return}0!==Object.keys(o).length&&(t={$remove:o,$token:this.token,...e},"function"==typeof n&&(r=n),t=i(t,n),this.config.debug&&this.mixpanel.config.logger.debug(`Sending the following data to Mixpanel (${this.endpoint})`,{data:t}),this.mixpanel.send_request({method:"GET",endpoint:this.endpoint,data:t},r))}_union({identifiers:e,data:t,modifiers:n,callback:r}){let o={};if("object"!=typeof t||Array.isArray(t)){this.config.debug&&this.mixpanel.config.logger.error("Invalid value passed to #union - data must be an object with scalar or array values");return}for(let[e,n]of Object.entries(t))if(Array.isArray(n)){var s=n.filter(function(e){return"string"==typeof e||"number"==typeof e});s.length>0&&(o[e]=s)}else"string"==typeof n||"number"==typeof n?o[e]=[n]:this.config.debug&&this.mixpanel.config.logger.error("Invalid argument passed to #union - values must be a scalar value or array",{key:e,value:n});0!==Object.keys(o).length&&(t={$union:o,$token:this.token,...e},"function"==typeof n&&(r=n),t=i(t,n),this.config.debug&&this.mixpanel.config.logger.debug(`Sending the following data to Mixpanel (${this.endpoint})`,{data:t}),this.mixpanel.send_request({method:"GET",endpoint:this.endpoint,data:t},r))}_unset({identifiers:e,prop:t,modifiers:n,callback:r}){let o=[];if(Array.isArray(t))o=t;else if("string"==typeof t)o=[t];else{this.config.debug&&this.mixpanel.config.logger.error("Invalid argument passed to #unset - must be a string or array",{prop:t});return}let s={$unset:o,$token:this.token,...e};"function"==typeof n&&(r=n),s=i(s,n),this.config.debug&&this.mixpanel.config.logger.debug(`Sending the following data to Mixpanel (${this.endpoint})`,{data:s}),this.mixpanel.send_request({method:"GET",endpoint:this.endpoint,data:s},r)}}},398854,(e,t,n)=>{let{ProfileHelpers:r}=e.r(585310);class i extends r(){constructor(e){super(),this.mixpanel=e,this.endpoint="/groups"}set_once(e,t,n,r,i,o){this._set(n,r,i,o,{identifiers:{$group_key:e,$group_id:t},set_once:!0})}set(e,t,n,r,i,o){this._set(n,r,i,o,{identifiers:{$group_key:e,$group_id:t}})}delete_group(e,t,n,r){this._delete_profile({identifiers:{$group_key:e,$group_id:t},modifiers:n,callback:r})}remove(e,t,n,r,i){this._remove({identifiers:{$group_key:e,$group_id:t},data:n,modifiers:r,callback:i})}union(e,t,n,r,i){this._union({identifiers:{$group_key:e,$group_id:t},data:n,modifiers:r,callback:i})}unset(e,t,n,r,i){this._unset({identifiers:{$group_key:e,$group_id:t},prop:n,modifiers:r,callback:i})}}n.MixpanelGroups=i},813914,(e,t,n)=>{let{merge_modifiers:r,ProfileHelpers:i}=e.r(585310);class o extends i(){constructor(e){super(),this.mixpanel=e,this.endpoint="/engage"}set_once(e,t,n,r,i){this._set(t,n,r,i,{identifiers:{$distinct_id:e},set_once:!0})}set(e,t,n,r,i){this._set(t,n,r,i,{identifiers:{$distinct_id:e}})}increment(e,t,n,i,o){var s={};if("object"==typeof t)for(let[e,r]of("object"==typeof n?(o=i,i=n):o=n,Object.entries(t)))isNaN(parseFloat(r))?this.mixpanel.config.debug&&this.mixpanel.config.logger.error("Invalid increment value passed to mixpanel.people.increment - must be a number",{key:e,value:r}):s[e]=r;else"number"!=typeof n&&n?("function"==typeof n?o=n:(o=i,i="object"==typeof n?n:{}),s[t]=1):(n=n||1,s[t]=n,"function"==typeof i&&(o=i));var a={$add:s,$token:this.mixpanel.token,$distinct_id:e};a=r(a,i),this.mixpanel.config.debug&&this.mixpanel.config.logger.debug("Sending the following data to Mixpanel (Engage)",{data:a}),this.mixpanel.send_request({method:"GET",endpoint:"/engage",data:a},o)}append(e,t,n,i,o){var s={};"object"==typeof t?("object"==typeof n?(o=i,i=n):o=n,Object.keys(t).forEach(function(e){s[e]=t[e]})):(s[t]=n,"function"==typeof i&&(o=i));var a={$append:s,$token:this.mixpanel.token,$distinct_id:e};a=r(a,i),this.mixpanel.config.debug&&this.mixpanel.config.logger.debug("Sending the following data to Mixpanel (Engage)",{data:a}),this.mixpanel.send_request({method:"GET",endpoint:"/engage",data:a},o)}track_charge(e,t,n,i,o){if("function"!=typeof n&&n?("function"==typeof i||!i)&&(o=i||void 0,(n.$ignore_time||n.hasOwnProperty("$ip"))&&(i={},Object.keys(n).forEach(function(e){i[e]=n[e],delete n[e]}))):(o=n||void 0,n={}),"number"!=typeof t&&isNaN(t=parseFloat(t)))return void this.mixpanel.config.logger.error("Invalid value passed to mixpanel.people.track_charge - must be a number");if(n.$amount=t,n.hasOwnProperty("$time")){var s=n.$time;"[object Date]"===Object.prototype.toString.call(s)&&(n.$time=s.toISOString())}var a={$append:{$transactions:n},$token:this.mixpanel.token,$distinct_id:e};a=r(a,i),this.mixpanel.config.debug&&this.mixpanel.config.logger.debug("Sending the following data to Mixpanel (Engage)",{data:a}),this.mixpanel.send_request({method:"GET",endpoint:"/engage",data:a},o)}clear_charges(e,t,n){var i={$set:{$transactions:[]},$token:this.mixpanel.token,$distinct_id:e};"function"==typeof t&&(n=t),i=r(i,t),this.mixpanel.config.debug&&this.mixpanel.config.logger.debug("Clearing this user's charges",{$distinct_id:e}),this.mixpanel.send_request({method:"GET",endpoint:"/engage",data:i},n)}delete_user(e,t,n){this._delete_profile({identifiers:{$distinct_id:e},modifiers:t,callback:n})}remove(e,t,n,r){this._remove({identifiers:{$distinct_id:e},data:t,modifiers:n,callback:r})}union(e,t,n,r){this._union({identifiers:{$distinct_id:e},data:t,modifiers:n,callback:r})}unset(e,t,n,r){this._unset({identifiers:{$distinct_id:e},prop:t,modifiers:n,callback:r})}}n.MixpanelPeople=o},723697,(e,t,n)=>{let r=e.r(254799);t.exports={EXPOSURE_EVENT:"$experiment_started",REQUEST_HEADERS:{"Content-Type":"application/json"},normalizedHash:function(e,t){return Number(function(e){let t=BigInt("0x100000001B3"),n=BigInt("0xCBF29CE484222325");for(let r=0;r<e.length;r++)n^=BigInt(e[r]),n*=t,n&=BigInt("0xFFFFFFFFFFFFFFFF");return n}(Buffer.from(e+t,"utf-8"))%BigInt(100))/100},prepareCommonQueryParams:function(e,t){return{mp_lib:"node",$lib_version:t,token:e}},generateTraceparent:function(){let e=r.randomBytes(16).toString("hex"),t=r.randomBytes(8).toString("hex");return`00-${e}-${t}-01`}}},310332,(e,t,n)=>{let r=e.r(524836),i=e.r(707669),{prepareCommonQueryParams:o,generateTraceparent:s,EXPOSURE_EVENT:a,REQUEST_HEADERS:l}=e.r(723697);t.exports=class{constructor(e,t,n,r,i){this.providerConfig=e,this.endpoint=t,this.tracker=n,this.evaluationMode=r,this.logger=i}async callFlagsEndpoint(e=null){return new Promise((t,n)=>{let a=new URLSearchParams(o(this.providerConfig.token,i.version));if(e)for(let[t,n]of Object.entries(e))a.append(t,n);let c=`${this.endpoint}?${a.toString()}`,u={host:this.providerConfig.api_host,port:443,path:c,method:"GET",headers:{...l,Authorization:"Basic "+Buffer.from(this.providerConfig.token+":").toString("base64"),traceparent:s()},timeout:1e3*this.providerConfig.request_timeout_in_seconds},p=r.request(u,e=>{let r="";e.on("data",e=>{r+=e}),e.on("end",()=>{if(200!==e.statusCode)return this.logger?.error(`HTTP ${e.statusCode} error calling flags endpoint: ${r}`),n(Error(`HTTP ${e.statusCode}: ${r}`));try{let e=JSON.parse(r);t(e)}catch(e){this.logger?.error(`Failed to parse JSON response: ${e.message}`),n(e)}})});p.on("error",e=>{this.logger?.error(`Network error calling flags endpoint: ${e.message}`),n(e)}),p.on("timeout",()=>{this.logger?.error("Request timeout calling flags endpoint"),p.destroy(),n(Error("Request timeout"))}),p.end()})}trackExposureEvent(e,t,n,r=null){if(!n.distinct_id)return void this.logger?.error("Cannot track exposure event without a distinct_id in the context");let i={distinct_id:n.distinct_id,"Experiment name":e,"Variant name":t.variant_key,$experiment_type:"feature_flag","Flag evaluation mode":this.evaluationMode};null!=r&&(i["Variant fetch latency (ms)"]=r),void 0!==t.experiment_id&&(i.$experiment_id=t.experiment_id),void 0!==t.is_experiment_active&&(i.$is_experiment_active=t.is_experiment_active),void 0!==t.is_qa_tester&&(i.$is_qa_tester=t.is_qa_tester),this.tracker(a,i,t=>{t&&this.logger?.error(`[flags]Failed to track exposure event for flag '${e}': ${t.message}`)})}}},407227,(e,t,n)=>{let r=e.r(310332),{normalizedHash:i}=e.r(723697);t.exports=class extends r{constructor(e,t,n,r){const i={api_host:"api.mixpanel.com",request_timeout_in_seconds:10,enable_polling:!0,polling_interval_in_seconds:60,...t};super({token:e,api_host:i.api_host,request_timeout_in_seconds:i.request_timeout_in_seconds},"/flags/definitions",n,"local",r),this.config=i,this.flagDefinitions=new Map,this.pollingInterval=null}async startPollingForDefinitions(){try{await this._fetchFlagDefinitions(),this.config.enable_polling&&!this.pollingInterval&&(this.pollingInterval=setInterval(async()=>{try{await this._fetchFlagDefinitions()}catch(e){this.logger?.error(`Error polling for flag definition: ${e.message}`)}},1e3*this.config.polling_interval_in_seconds))}catch(e){this.logger?.error(`Initial flag definitions fetch failed: ${e.message}`)}}stopPollingForDefinitions(){this.pollingInterval?(clearInterval(this.pollingInterval),this.pollingInterval=null):this.logger?.warn("stopPollingForDefinitions called but polling was not active")}isEnabled(e,t){return!0===this.getVariantValue(e,!1,t)}getVariantValue(e,t,n,r=!0){return this.getVariant(e,{variant_value:t},n,r).variant_value}getVariant(e,t,n,r=!0){let i=this.flagDefinitions.get(e);if(!i)return this.logger?.warn(`Cannot find flag definition for key: '${e}`),t;if(!Object.hasOwn(n,i.context))return this.logger?.warn(`The variant assignment key, '${i.context}' for flag, '${e}' is not present in the supplied user context dictionary`),t;let o=n[i.context],s=null,a=this._getVariantOverrideForTestUser(i,n);if(a)s=a;else{let t=this._getAssignedRollout(i,o,n);t&&(s=this._getAssignedVariant(i,o,e,t))}return s?(r&&this.trackExposureEvent(e,s,n),s):t}getAllVariants(e){let t={};for(let n of this.flagDefinitions.keys()){let r=this.getVariant(n,null,e,!1);null!==r&&(t[n]=r)}return t}async _fetchFlagDefinitions(){let e=await this.callFlagsEndpoint(),t=new Map;return e.flags.forEach(e=>{t.set(e.key,e)}),this.flagDefinitions=t,e}_getMatchingVariant(e,t){for(let n of t.ruleset.variants)if(e.toLowerCase()===n.key.toLowerCase())return{variant_key:n.key,variant_value:n.value,experiment_id:t.experiment_id,is_experiment_active:t.is_experiment_active};return null}_getVariantOverrideForTestUser(e,t){if(!e.ruleset.test?.users)return null;let n=t.distinct_id;if(!n)return null;let r=e.ruleset.test.users[n];if(!r)return null;let i=this._getMatchingVariant(r,e);return i&&(i.is_qa_tester=!0),i}_getAssignedRollout(e,t,n){for(let r=0;r<e.ruleset.rollout.length;r++){let o,s=e.ruleset.rollout[r];if(o=null!==e.hash_salt&&void 0!==e.hash_salt?e.key+e.hash_salt+r.toString():e.key+"rollout",i(String(t),o)<s.rollout_percentage&&this._isRuntimeEvaluationSatisfied(s,n))return s}return null}_getAssignedVariant(e,t,n,r){if(r.variant_override){let t=this._getMatchingVariant(r.variant_override.key,e);if(t)return{...t,is_qa_tester:!1}}let o=null!==e.hash_salt&&void 0!==e.hash_salt?e.hash_salt:"",s=i(String(t),n+o+"variant"),a=e.ruleset.variants.map(e=>({...e}));if(r.variant_splits)for(let e of a)e.key in r.variant_splits&&(e.split=r.variant_splits[e.key]);let l=a[0],c=0;for(let e of a)if(l=e,s<(c+=e.split||0))break;return{variant_key:l.key,variant_value:l.value,experiment_id:e.experiment_id,is_experiment_active:e.is_experiment_active,is_qa_tester:!1}}_isRuntimeEvaluationSatisfied(e,t){if(!e.runtime_evaluation_definition)return!0;let n=t.custom_properties;if(!n||"object"!=typeof n)return!1;for(let[t,r]of Object.entries(e.runtime_evaluation_definition))if(!(t in n)||String(n[t]).toLowerCase()!==String(r).toLowerCase())return!1;return!0}}},115581,(e,t,n)=>{let r=e.r(310332);t.exports=class extends r{constructor(e,t,n,r){const i={api_host:"api.mixpanel.com",request_timeout_in_seconds:10,...t};super({token:e,api_host:i.api_host,request_timeout_in_seconds:i.request_timeout_in_seconds},"/flags",n,"remote",r)}async getVariantValue(e,t,n,r=!0){try{return(await this.getVariant(e,{variant_value:t},n,r)).variant_value}catch(n){return this.logger?.error(`Failed to get variant value for flag '${e}': ${n.message}`),t}}async getVariant(e,t,n,r=!0){try{let i=Date.now(),o=await this._fetchFlags(n,e),s=Date.now()-i,a=(o.flags||{})[e];if(!a)return t;return r&&this.trackExposureEvent(e,a,n,s),a}catch(n){return this.logger?.error(`Failed to get variant for flag '${e}': ${n.message}`),t}}async isEnabled(e,t){try{let n=await this.getVariantValue(e,!1,t);return!0===n}catch(t){return this.logger?.error(`Failed to check if flag '${e}' is enabled: ${t.message}`),!1}}async getAllVariants(e){try{return(await this._fetchFlags(e)).flags||{}}catch(e){return this.logger?.error(`Failed to get all remote variants: ${e.message}`),null}}_fetchFlags(e,t=null){let n={context:JSON.stringify(e)};return null!==t&&(n.flag_key=t),this.callFlagsEndpoint(n)}}},942779,(e,t,n)=>{t.exports={LocalFeatureFlagsProvider:e.r(407227),RemoteFeatureFlagsProvider:e.r(115581)}},424109,(e,t,n)=>{let r=e.r(145706),i=e.r(500874).Buffer,o=e.r(921517),s=e.r(524836),a=e.r(869179),l=e.r(792509),c=e.r(707669),{async_all:u,ensure_timestamp:p,assert_logger:g}=e.r(972199),{MixpanelGroups:f}=e.r(398854),{MixpanelPeople:d}=e.r(813914),{LocalFeatureFlagsProvider:h,RemoteFeatureFlagsProvider:_}=e.r(942779),m={test:!1,debug:!1,verbose:!1,host:"api.mixpanel.com",protocol:"https",path:"",keepAlive:!0,geolocate:!1,logger:console};t.exports={init:function(e,t){if(!e)throw Error("The Mixpanel Client needs a Mixpanel token: `init(token)`");let n={token:e,config:{...m}},{keepAlive:v}=n.config,y={http:o,https:s},x={http:new o.Agent({keepAlive:v}),https:new s.Agent({keepAlive:v})},b=process.env.HTTPS_PROXY||process.env.HTTP_PROXY,$=b?new a(Object.assign(l.parse(b),{keepAlive:v})):null;n.send_request=function(e,t){let o;t=t||function(){};let a=i.from(JSON.stringify(e.data)).toString("base64"),l=e.endpoint,c=(e.method||"GET").toUpperCase(),u={ip:+!!n.config.geolocate,verbose:+!!n.config.verbose},p=n.config.key,g=n.config.secret,f=y[n.config.protocol],d={host:n.config.host,port:n.config.port,headers:{},method:c};if(!f)throw Error("Mixpanel Initialization Error: Unsupported protocol "+n.config.protocol+". Supported protocols are: "+Object.keys(y));if("POST"===c?(a="data="+a,d.headers["Content-Type"]="application/x-www-form-urlencoded",d.headers["Content-Length"]=i.byteLength(a)):"GET"===c&&(u.data=a),g){if(f!==s)throw Error("Must use HTTPS if authenticating with API Secret");let e=i.from(g+":").toString("base64");d.headers.Authorization="Basic "+e}else if(p)u.api_key=p;else if("/import"===l)throw Error("The Mixpanel Client needs a Mixpanel API Secret when importing old events: `init(token, { secret: ... })`");d.agent=$||x[n.config.protocol],n.config.test&&(u.test=1),d.path=n.config.path+l+"?"+r.stringify(u),(o=f.request(d,function(e){var r="";e.on("data",function(e){r+=e}),e.on("end",function(){var e;if(n.config.verbose)try{var i=JSON.parse(r);1!=i.status&&(e=Error("Mixpanel Server Error: "+i.error))}catch(t){e=Error("Could not parse response from Mixpanel")}else e="1"!==r?Error("Mixpanel Server Error: "+r):void 0;t(e)})})).on("error",function(e){n.config.debug&&n.config.logger.error("Got Error: "+e.message),t(e)}),"POST"===c&&o.write(a),o.end()},n.send_event_request=function(e,t,r,i){r.token=n.token,r.mp_lib="node",r.$lib_version=c.version;var o={event:t,properties:r};n.config.debug&&n.config.logger.debug("Sending the following event to Mixpanel",{data:o}),n.send_request({method:"GET",endpoint:e,data:o},i)};var k=function(e,t){for(var n=[],r=0,i=e.length;r<i;)n.push(e.slice(r,r+=t));return n},w=function(e,t){var r=e.event_list,i=e.endpoint,o=e.max_batch_size?Math.min(50,e.max_batch_size):50,s=e.max_concurrent_requests||e.max_batch_size>50&&Math.ceil(e.max_batch_size/50),a=k(r,o),l=s?k(a,s):[a],c=a.length,g=l.length;function f(e,t){e.length>0&&(e=e.map(function(e){return e.properties,("/import"===i||e.properties.time)&&(e.properties.time=p(e.properties.time)),e.properties.token=e.properties.token||n.token,e}),n.send_request({method:"POST",endpoint:i,data:e},t))}!function e(n){u(l[n],f,function(r,i){(n+=1)===g?t&&t(r,i):e(n)})}(0),n.config.debug&&n.config.logger.debug("Sending "+r.length+" events to Mixpanel in "+c+" batches of events and "+g+" batches of requests")};return n.track=function(e,t,r){t&&"function"!=typeof t||(r=t,t={}),t.time&&(t.time=p(t.time)),n.send_event_request("/track",e,t,r)},n.track_batch=function(e,t,n){"function"==typeof(t=t||{})&&(n=t,t={}),w({event_list:e,endpoint:"/track",max_concurrent_requests:t.max_concurrent_requests,max_batch_size:t.max_batch_size},n)},n.import=function(e,t,r,i){r&&"function"!=typeof r||(i=r,r={}),r.time=p(t),n.send_event_request("/import",e,r,i)},n.import_batch=function(e,t,n){"function"!=typeof t&&t||(n=t,t={}),w({event_list:e,endpoint:"/import",max_concurrent_requests:t.max_concurrent_requests,max_batch_size:t.max_batch_size},n)},n.alias=function(e,t,r){n.track("$create_alias",{distinct_id:e,alias:t},r)},n.groups=new f(n),n.people=new d(n),n.set_config=function(e){if(e&&void 0!==e.logger&&g(e.logger),Object.assign(n.config,e),e.host){let[t,r]=e.host.split(":");n.config.host=t,r&&(n.config.port=Number(r))}},t&&n.set_config(t),t&&t.local_flags_config&&(n.local_flags=new h(e,t.local_flags_config,n.track.bind(n),t.logger)),t&&t.remote_flags_config&&(n.remote_flags=new _(e,t.remote_flags_config,n.track.bind(n),t.logger)),n}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c740643f._.js.map
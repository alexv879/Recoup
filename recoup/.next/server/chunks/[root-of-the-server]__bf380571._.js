module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},155742,e=>e.a(async(t,r)=>{try{let t=await e.y("firebase-admin/firestore");e.n(t),r()}catch(e){r(e)}},!0),456300,e=>e.a(async(t,r)=>{try{let t=await e.y("firebase-admin/app");e.n(t),r()}catch(e){r(e)}},!0),894222,e=>e.a(async(t,r)=>{try{let t=await e.y("firebase-admin/storage");e.n(t),r()}catch(e){r(e)}},!0),868253,e=>e.a(async(t,r)=>{try{var n=e.i(456300),a=e.i(155742),i=e.i(894222),o=t([n,a,i]);if([n,a,i]=o.then?(await o)():o,!(0,n.getApps)().length)try{let e=process.env.FIREBASE_PROJECT_ID,t=process.env.FIREBASE_CLIENT_EMAIL,r=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");e&&t&&r?((0,n.initializeApp)({credential:(0,n.cert)({projectId:e,clientEmail:t,privateKey:r})}),console.log("✅ Firebase Admin initialized successfully")):console.warn("⚠️  Firebase credentials not configured - app will not function at runtime")}catch(e){console.error("❌ Firebase Admin initialization error:",e)}let s=null,l=new Proxy({},{get:(e,t)=>(function(){if(!s){if(!(0,n.getApps)().length)throw Error("Firebase is not initialized. Make sure environment variables are configured.");s=(0,a.getFirestore)()}return s})()[t]}),d=(0,i.getStorage)();e.s(["COLLECTIONS",0,{USERS:"users",INVOICES:"invoices",PAYMENT_CONFIRMATIONS:"payment_confirmations",PAYMENT_CLAIMS:"payment_claims",COLLECTION_ATTEMPTS:"collection_attempts",CLIENTS:"clients",NOTIFICATIONS:"notifications",TRANSACTIONS:"transactions",REFERRALS:"referrals",REFERRAL_CREDITS:"referral_credits",REFERRAL_PAYOUTS:"referral_payouts",USER_BEHAVIOR_PROFILE:"user_behavior_profile",USER_STATS:"user_stats",USER_EVENTS:"user_events",DAILY_SUMMARIES:"daily_summaries",EMAILS_SENT:"emails_sent",ONBOARDING_PROGRESS:"onboarding_progress",AGENCY_HANDOFFS:"agency_handoffs"},"db",0,l,"firestore",0,l,"storage",0,d]),r()}catch(e){r(e)}},!1),169907,e=>{"use strict";let t={info:(e,t)=>{t?console.log(`[INFO] ${t}`,e):console.log("[INFO]",e)},error:(e,t)=>{t?console.error(`[ERROR] ${t}`,e):console.error("[ERROR]",e)},warn:(e,t)=>{t?console.warn(`[WARN] ${t}`,e):console.warn("[WARN]",e)}};e.s(["logApiRequest",0,(e,r,n)=>{t.info({method:e,url:r,...n},"API Request")},"logApiResponse",0,(e,r,n,a)=>{t.info({method:e,url:r,status:n,...a},"API Response")},"logDbOperation",0,(e,r,n)=>{t.info({operation:e,collection:r,...n},"Database Operation")},"logError",0,(e,r)=>{t.error(r,e)},"logInfo",0,(e,r)=>{t.info(r,e)},"logWarn",0,(e,r)=>{t.warn(r,e)},"logger",0,t])},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},382667,e=>{"use strict";var t=e.i(169907);let r=process.env.MIXPANEL_TOKEN||process.env.NEXT_PUBLIC_MIXPANEL_TOKEN;async function n(r,n,a){try{let{db:i}=await e.A(180785),o={event:r,user_id:n,properties:a,timestamp:Date.now(),created_at:new Date};await i.collection("analytics_events").add(o),(0,t.logInfo)("Event saved to Firestore",{event:r,userId:n})}catch(e){(0,t.logError)("Failed to save event to Firestore",e)}}let a=null;async function i(){if(a)return a;if(!r)return(0,t.logError)("MIXPANEL_TOKEN not configured",Error("Missing env var")),null;try{return a=(await e.A(957948)).init(r,{protocol:"https"}),(0,t.logInfo)("Mixpanel server-side initialized"),a}catch(e){return(0,t.logError)("Failed to initialize Mixpanel server-side",e),null}}async function o(e,r,a){try{let o={...r,timestamp:Date.now(),server_side:!0};await n(e,a,o);let s=await i();s&&a&&s.track(e,{distinct_id:a,...o}),(0,t.logInfo)("Server event tracked",{event:e,userId:a,properties:o})}catch(e){(0,t.logError)("Failed to track server event",e)}}e.s(["trackServerEvent",()=>o])},573577,e=>e.a(async(t,r)=>{try{var n=e.i(89171),a=e.i(868253),i=e.i(382667),o=e.i(169907),s=e.i(254799),l=t([a]);async function d(e,t,r){let n=a.firestore.collection("emailEvents").where("sendgridMessageId","==",e).limit(1),i=await n.get();if(i.empty)return void(0,o.logWarn)("Email event not found for message ID",{messageId:e});let s=i.docs[0],l={deliveryStatus:t,updatedAt:new Date};r?.reason&&(l.error=r.reason),r?.response&&(l.deliveryResponse=r.response),r?.timestamp&&(l.deliveredAt=new Date(1e3*r.timestamp)),await s.ref.update(l)}async function c(e){try{let t=e.headers.get("x-twilio-email-event-webhook-signature"),r=e.headers.get("x-twilio-email-event-webhook-timestamp"),a=await e.text(),l=JSON.parse(a);if(t&&r&&!function(e,t,r){let n=process.env.SENDGRID_WEBHOOK_PUBLIC_KEY;if(!n)return(0,o.logWarn)("SENDGRID_WEBHOOK_PUBLIC_KEY not configured, skipping signature verification"),!0;try{let a=s.default.createVerify("RSA-SHA256");return a.update(r+e),a.verify(n,t,"base64")}catch(e){return(0,o.logError)("Signature verification failed",e),!1}}(a,t,r))return(0,o.logError)("Invalid SendGrid webhook signature"),n.NextResponse.json({error:"Invalid signature"},{status:401});for(let e of((0,o.logInfo)(`Processing ${l.length} SendGrid webhook events`),l)){let t=e.sg_message_id;if(!t){(0,o.logWarn)("Event missing sg_message_id",{event:e.event});continue}let r=function(e){switch(e){case"delivered":return"delivered";case"bounce":case"dropped":case"spamreport":return"bounced";default:return"sent"}}(e.event);await d(t,r,{reason:e.reason,response:e.response,timestamp:e.timestamp}),"delivered"===e.event?await (0,i.trackServerEvent)("email_delivered",{invoice_id:e.invoiceId,reminder_level:e.reminderLevel,sendgrid_message_id:t}):("bounce"===e.event||"dropped"===e.event)&&await (0,i.trackServerEvent)("email_failed",{invoice_id:e.invoiceId,reminder_level:e.reminderLevel,sendgrid_message_id:t,error_message:e.reason||e.response||"Email bounced or dropped"}),(0,o.logInfo)("Processed SendGrid event",{event:e.event,messageId:t,email:e.email,invoiceId:e.invoiceId})}return n.NextResponse.json({success:!0,processed:l.length})}catch(e){return(0,o.logError)("SendGrid webhook processing failed",e),n.NextResponse.json({error:"Internal error",logged:!0},{status:200})}}[a]=l.then?(await l)():l,e.s(["POST",()=>c]),r()}catch(e){r(e)}},!1),147643,e=>e.a(async(t,r)=>{try{var n=e.i(747909),a=e.i(174017),i=e.i(996250),o=e.i(759756),s=e.i(561916),l=e.i(114444),d=e.i(837092),c=e.i(869741),u=e.i(316795),p=e.i(487718),v=e.i(995169),g=e.i(47587),f=e.i(666012),E=e.i(570101),h=e.i(626937),R=e.i(10372),m=e.i(193695);e.i(52474);var _=e.i(600220),w=e.i(573577),A=t([w]);[w]=A.then?(await A)():A;let I=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/webhook/sendgrid/route",pathname:"/api/webhook/sendgrid",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/webhook/sendgrid/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:b}=I;function y(){return(0,i.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function x(e,t,r){I.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/webhook/sendgrid/route";n=n.replace(/\/index$/,"")||"/";let i=await I.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:A,nextConfig:y,parsedUrl:x,isDraftMode:S,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:O,revalidateOnlyGenerated:C,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:k}=i,M=(0,c.normalizeAppPath)(n),F=!!(N.dynamicRoutes[M]||N.routes[T]),D=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,x,!1):t.end("This page could not be found"),null);if(F&&!S){let e=!!N.routes[T],t=N.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await D();throw new m.NoFallbackError}}let L=null;!F||I.isDev||S||(L=T,L="/index"===L?"/":L);let U=!0===I.isDev||!F,j=F&&!U;k&&P&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:P,serverActionsManifest:k,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:k})});let q=e.method||"GET",H=(0,s.getTracer)(),K=H.getActiveScopeSpan(),B={params:A,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>I.onRequestError(e,t,n,b)},sharedContext:{buildId:w}},$=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),W=p.NextRequestAdapter.fromNodeNextRequest($,(0,p.signalFromNodeResponse)(t));try{let i=async e=>I.handle(W,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==v.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${n}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var s,d;let c=async({previousCacheEntry:a})=>{try{if(!l&&O&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(o);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=B.renderOpts.collectedTags;if(!F)return await (0,f.sendResponse)($,G,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:O})},b),t}},u=await I.handleResponse({req:e,nextConfig:y,cacheKey:L,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:C,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!F)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",O?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,E.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&F||p.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)($,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};K?await d(K):await H.withPropagatedContext(e.headers,()=>H.trace(v.BaseServerSpan.handleRequest,{spanName:`${q} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},d))}catch(t){if(t instanceof m.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:O})}),F)throw t;return await (0,f.sendResponse)($,G,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>y,"routeModule",()=>I,"serverHooks",()=>b,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N]),r()}catch(e){r(e)}},!1),180785,e=>{e.v(t=>Promise.all(["server/chunks/lib_firebaseAdmin_ts_6f154e3c._.js"].map(t=>e.l(t))).then(()=>t(157491)))},957948,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__53de8f4f._.js","server/chunks/[root-of-the-server]__c740643f._.js"].map(t=>e.l(t))).then(()=>t(424109)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__bf380571._.js.map
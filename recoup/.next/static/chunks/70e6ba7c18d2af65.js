(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,207670,e=>{"use strict";function t(){for(var e,t,i=0,n="",r=arguments.length;i<r;i++)(e=arguments[i])&&(t=function e(t){var i,n,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(i=0;i<s;i++)t[i]&&(n=e(t[i]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}(e))&&(n&&(n+=" "),n+=t);return n}e.s(["clsx",()=>t])},718677,e=>{"use strict";var t=e.i(843476),i=e.i(647163);function n({className:e,variant:n="default",size:r="default",asChild:s=!1,...a}){return(0,t.jsx)("button",{className:(0,i.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary"}[n],{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}[r],e),...a})}e.s(["Button",()=>n])},56522,e=>{"use strict";var t=e.i(843476),i=e.i(647163);function n({className:e,children:n,...r}){return(0,t.jsx)("div",{className:(0,i.cn)("rounded-lg border bg-white shadow-sm",e),...r,children:n})}e.s(["Card",()=>n])},364379,e=>{"use strict";var t=e.i(843476),i=e.i(271645),n=e.i(618566),r=e.i(56522),s=e.i(718677),a=e.i(65168),o=e.i(475254);let l=(0,o.default)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),c=(0,o.default)("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]),d=(0,o.default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var u=e.i(558249),m=e.i(415197);function p({onTranscriptUpdate:e,onRecordingComplete:n,onError:r,disabled:s=!1,className:a=""}){let[o,p]=(0,i.useState)("idle"),[g,h]=(0,i.useState)(""),[v,f]=(0,i.useState)(""),[x,b]=(0,i.useState)(""),y=(0,i.useRef)(null),j=(0,i.useRef)([]),N=(0,i.useRef)(0),w=(0,i.useRef)(0);(0,u.useTrack)("voice_recording_started",void 0,[]);let k=async()=>{try{p("requesting"),b(""),h(""),f("");let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}),t=new MediaRecorder(e,{mimeType:"audio/webm"});j.current=[],w.current=0,N.current=Date.now(),t.ondataavailable=e=>{e.data.size>0&&j.current.push(e.data)},t.onstop=async()=>{let t=new Blob(j.current,{type:"audio/webm"});await C(t),e.getTracks().forEach(e=>e.stop())},t.start(1e3),y.current=t,p("recording");let i=/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop",n=navigator.connection?.effectiveType||"unknown";(0,u.useTrack)("voice_recording_started",{device_type:i,network_type:n},[i]),(0,m.logInfo)("Voice recording started",{deviceType:i,networkType:n})}catch(e){(0,m.logError)("Failed to start recording",e),p("error"),b(e.message||"Failed to access microphone"),r?.(e)}},C=async e=>{try{p("processing");let t=new FormData;t.append("audio",e,"recording.webm");let i=Date.now(),r=await fetch("/api/voice/batch",{method:"POST",body:t});if(!r.ok)throw Error(`Transcription failed: ${r.statusText}`);let s=await r.json(),a=Date.now()-i,o=s.transcript||"";h(o);let l={method:"whisper",latencyMs:a,segments:s.segments||1,deviceType:/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop"};(0,u.useTrack)("voice_transcript_finalized",{segments:l.segments,latency_ms_avg:a},[a]),n?.(o,l),p("idle"),(0,m.logInfo)("Voice transcription completed",{finalTranscript:o,metadata:l})}catch(e){(0,m.logError)("Failed to process audio",e),p("error"),b(e.message||"Transcription failed"),r?.(e)}},_=()=>{!s&&("idle"===o?k():"recording"===o&&y.current&&"recording"===o&&(p("processing"),y.current.stop()))},I=(()=>{switch(o){case"requesting":return{icon:d,label:"Requesting microphone...",spinning:!0};case"recording":return{icon:c,label:"Stop recording",spinning:!1};case"processing":return{icon:d,label:"Processing...",spinning:!0};case"error":return{icon:l,label:"Start voice input (error occurred)",spinning:!1};default:return{icon:l,label:"Start voice input",spinning:!1}}})(),D=I.icon,S="recording"===o,T="requesting"===o||"processing"===o;return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{type:"button",onClick:_,onKeyDown:e=>{(" "===e.key||"Enter"===e.key)&&(e.preventDefault(),_())},disabled:s||T,"aria-label":I.label,"aria-pressed":S,className:`
          relative p-3 rounded-full transition-all duration-200
          ${S?"bg-red-500 hover:bg-red-600 text-white shadow-lg animate-pulse":"bg-blue-500 hover:bg-blue-600 text-white shadow-md hover:shadow-lg"}
          ${s||T?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
          ${a}
        `,children:(0,t.jsx)(D,{className:`w-5 h-5 ${I.spinning?"animate-spin":""}`,"aria-hidden":"true"})}),(0,t.jsxs)("div",{role:"status","aria-live":"polite",className:"sr-only",children:["recording"===o&&"Recording started","processing"===o&&"Processing audio...",v&&`Partial: ${v}`,g&&`Final transcript inserted: ${g}`,x&&`Error: ${x}`]}),"error"===o&&x&&(0,t.jsx)("div",{className:"absolute top-full mt-2 left-0 right-0 bg-red-50 border border-red-200 rounded-md p-2 text-sm text-red-700",role:"alert",children:x})]})}function g({onTranscriptionComplete:e}){let[n,r]=(0,i.useState)(!1),[s,o]=(0,i.useState)(""),[l,c]=(0,i.useState)();return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(a.VoiceTranscriptLiveRegion,{isRecording:n,transcript:s}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Click the microphone button and speak your invoice details. Include client name, email, amount, and description."}),(0,t.jsx)(p,{onRecordingComplete:(t,i)=>{o(t),r(!1);let n={description:t};for(let e of t.toLowerCase().split("\n")){if(e.includes("client")||e.includes("customer")){let t=e.match(/(?:client|customer)[:\s]+(.+)/i);t&&(n.clientName=t[1].trim())}let t=e.match(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);t&&(n.clientEmail=t[1]);let i=e.match(/(?:Â£|\$|amount|total)[:\s]*(\d+(?:\.\d{2})?)/i);i&&(n.amount=parseFloat(i[1])),(e.includes("item")||e.includes("service")||e.includes("work"))&&(n.lineItems=[{description:e.trim(),quantity:1,unitPrice:n.amount||0}])}e(n)},onError:e=>{console.error("Voice recording error:",e)}})]})]})}var h=e.i(827085);function v(){let e=(0,n.useRouter)(),{user:o}=(0,h.useUser)(),[l,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[p,v]=(0,i.useState)({clientName:"",clientEmail:"",clientPhone:"",amount:0,description:"",invoiceDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+2592e6).toISOString().split("T")[0],lineItems:[{description:"",quantity:1,unitPrice:0}]});(0,i.useEffect)(()=>{(0,u.trackEvent)("invoice_created",{user_id:o?.id})},[o?.id]);let f=(e,t,i)=>{v(n=>({...n,lineItems:n.lineItems.map((n,r)=>r===e?{...n,[t]:i}:n)}))},x=()=>p.lineItems.reduce((e,t)=>e+t.quantity*t.unitPrice,0),b=async t=>{t.preventDefault(),c(!0);try{let t=x(),i=await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...p,amount:t,status:"draft"})});if(i.ok){let t=await i.json(),n=x(),r=!o?.publicMetadata?.activationEvents?.firstInvoiceAt;(0,u.trackEvent)(r?"first_invoice_created":"invoice_created",{user_id:o?.id,invoice_id:t.invoiceId,amount:n,line_items:p.lineItems.length,has_voice_meta:d,client_name:p.clientName,time_to_first_invoice_minutes:r?Math.floor((Date.now()-(o?.createdAt?.getTime()||Date.now()))/6e4):void 0}),e.push(`/dashboard/invoices/${t.invoiceId}`)}else{let e=await i.json();alert(e.error||"Failed to create invoice")}}catch(e){console.error("Error creating invoice:",e),alert("Failed to create invoice")}finally{c(!1)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white border-b",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create Invoice"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Fill in the details or use voice input"})]}),(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>e.push("/dashboard/invoices"),children:"Cancel"})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,t.jsxs)(r.Card,{className:"p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Voice Input"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Create invoice by speaking"})]}),(0,t.jsxs)(s.Button,{variant:"outline",onClick:()=>m(!d),children:["ðŸŽ¤ ",d?"Hide":"Show"," Voice Recorder"]})]}),d&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(g,{onTranscriptionComplete:e=>{e.clientName&&v(t=>({...t,clientName:e.clientName})),e.clientEmail&&v(t=>({...t,clientEmail:e.clientEmail})),e.amount&&v(t=>({...t,amount:e.amount})),e.description&&v(t=>({...t,description:e.description})),e.lineItems&&v(t=>({...t,lineItems:e.lineItems})),(0,u.trackEvent)("voice_invoice_submitted",{user_id:o?.id,has_client_data:!!(e.clientName||e.clientEmail),has_amount:!!e.amount,has_line_items:!!e.lineItems}),m(!1)}})})]}),(0,t.jsx)(r.Card,{className:"p-6",children:(0,t.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Client Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(a.AccessibleFormField,{id:"clientName",label:"Client Name",type:"text",required:!0,value:p.clientName,onChange:e=>v({...p,clientName:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,t.jsx)(a.AccessibleFormField,{id:"clientEmail",label:"Client Email",type:"email",required:!0,value:p.clientEmail,onChange:e=>v({...p,clientEmail:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,t.jsx)(a.AccessibleFormField,{id:"clientPhone",label:"Client Phone",type:"tel",helpText:"Optional",value:p.clientPhone||"",onChange:e=>v({...p,clientPhone:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Dates"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(a.AccessibleFormField,{id:"invoiceDate",label:"Invoice Date",type:"date",required:!0,value:p.invoiceDate,onChange:e=>v({...p,invoiceDate:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,t.jsx)(a.AccessibleFormField,{id:"dueDate",label:"Due Date",type:"date",required:!0,value:p.dueDate,onChange:e=>v({...p,dueDate:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Line Items"}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{v(e=>({...e,lineItems:[...e.lineItems,{description:"",quantity:1,unitPrice:0}]}))},children:"+ Add Item"})]}),(0,t.jsx)("div",{className:"space-y-4",children:p.lineItems.map((e,i)=>(0,t.jsxs)("div",{className:"flex gap-4 items-start",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("input",{type:"text",placeholder:"Description",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.description,onChange:e=>f(i,"description",e.target.value),required:!0})}),(0,t.jsx)("div",{className:"w-24",children:(0,t.jsx)("input",{type:"number",placeholder:"Qty",min:"1",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.quantity,onChange:e=>f(i,"quantity",parseFloat(e.target.value)),required:!0})}),(0,t.jsx)("div",{className:"w-32",children:(0,t.jsx)("input",{type:"number",placeholder:"Price",min:"0",step:"0.01",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:e.unitPrice,onChange:e=>f(i,"unitPrice",parseFloat(e.target.value)),required:!0})}),(0,t.jsx)("div",{className:"w-32 text-right pt-2",children:(0,t.jsxs)("p",{className:"font-semibold",children:["Â£",(e.quantity*e.unitPrice).toFixed(2)]})}),p.lineItems.length>1&&(0,t.jsx)(s.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{v(e=>({...e,lineItems:e.lineItems.filter((e,t)=>t!==i)}))},children:"âœ•"})]},i))}),(0,t.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,t.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsxs)("span",{children:["Â£",x().toFixed(2)]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes (optional)"}),(0,t.jsx)("textarea",{rows:4,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:p.description,onChange:e=>v({...p,description:e.target.value}),placeholder:"Add any additional notes or payment terms..."})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(s.Button,{type:"submit",disabled:l,className:"flex-1",children:l?"Creating...":"Create Invoice"}),(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>e.push("/dashboard/invoices"),children:"Cancel"})]})]})})]})})]})}e.s(["default",()=>v],364379)}]);

//# sourceMappingURL=08aba979256105e2.js.map
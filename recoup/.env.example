# ============================================================================
# RECOUP SAAS - ENVIRONMENT VARIABLES
# ============================================================================
# Copy this file to .env.local for local development
# Set these values in Vercel dashboard for production deployment
#
# Security Note: NEVER commit .env.local or .env files to version control
# All secrets should be managed securely through Vercel/hosting platform
# ============================================================================

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
# The public URL of your application (used in emails, webhooks, redirects)
NEXT_PUBLIC_APP_URL=http://localhost:3000
# NEXT_PUBLIC_APP_URL=https://your-domain.vercel.app  # Production

# Application version (used in Sentry releases)
NEXT_PUBLIC_APP_VERSION=1.0.0
APP_VERSION=1.0.0

# Node environment (development | production | test)
NODE_ENV=development


# ============================================================================
# AUTHENTICATION - CLERK
# ============================================================================
# Get from: https://dashboard.clerk.com
# Navigate to: Your App → API Keys

# Publishable key (safe to expose in client-side code)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_XXXXXXXXXXXXXXXXXXXX

# Secret key (server-side only, NEVER expose to client)
CLERK_SECRET_KEY=sk_test_XXXXXXXXXXXXXXXXXXXX

# Webhook secret for verifying webhook signatures
# Get from: Clerk Dashboard → Webhooks → Add Endpoint → Copy Signing Secret
CLERK_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# DATABASE - FIREBASE FIRESTORE
# ============================================================================
# Get from: Firebase Console → Project Settings → Service Accounts
# Click "Generate New Private Key" to download JSON file
# Extract these 3 values from the downloaded JSON

# Your Firebase project ID (e.g., recoup-prod-12345)
# This is exposed to the client (safe to be public)
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PROJECT_ID=your-project-id  # Server-side alias

# Service account email address
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com

# Private key (keep the quotes and \n escape sequences)
# Example: "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBg...\n-----END PRIVATE KEY-----\n"
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"


# ============================================================================
# PAYMENTS - STRIPE
# ============================================================================
# Get from: https://dashboard.stripe.com/apikeys
# Use test keys for development, live keys for production

# Publishable key (client-side, starts with pk_)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_XXXXXXXXXXXXXXXXXXXX

# Secret key (server-side only, starts with sk_)
STRIPE_SECRET_KEY=sk_test_XXXXXXXXXXXXXXXXXXXX

# Webhook signing secret (for verifying webhook events)
# Get from: Stripe Dashboard → Developers → Webhooks → Add Endpoint
STRIPE_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX

# Stripe Price IDs for subscription tiers (4-tier pricing model + HMRC add-on)
# Get from: Stripe Dashboard → Products → Your Product → Pricing
# Core Tiers: FREE (no price ID needed), Starter, Growth, Pro
STRIPE_PRICE_STARTER_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_STARTER_ANNUAL=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_GROWTH_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_GROWTH_ANNUAL=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_PRO_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_PRO_ANNUAL=price_XXXXXXXXXXXXXXXXXXXX

# HMRC Making Tax Digital Add-on (optional, can be added to any tier)
# Price: £20/month or £200/year (17% annual discount)
STRIPE_PRICE_HMRC_ADDON_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX
STRIPE_PRICE_HMRC_ADDON_ANNUAL=price_XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# EMAIL - SENDGRID
# ============================================================================
# Get from: https://app.sendgrid.com/settings/api_keys
# Click "Create API Key" with Full Access permissions

# SendGrid API key (starts with SG.)
SENDGRID_API_KEY=SG.XXXXXXXXXXXXXXXXXXXX

# From email address (must be verified in SendGrid)
SENDGRID_FROM_EMAIL=noreply@yourdomain.com

# From name displayed in emails
SENDGRID_FROM_NAME=Recoup Invoice Collection

# SendGrid Dynamic Template IDs (create these in SendGrid dashboard)
# Templates → Dynamic Templates → Create Template
SENDGRID_INVOICE_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_REMINDER_DAY7_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_REMINDER_DAY21_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_PAYMENT_CONFIRMED_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_PAYMENT_VERIFICATION_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_PAYMENT_VERIFIED_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_PAYMENT_REJECTED_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_NOTIFICATION_TEMPLATE_ID=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_TEMPLATE_PAYMENT_CLAIM_NOTIFICATION=d-XXXXXXXXXXXXXXXXXXXX
SENDGRID_TEMPLATE_PAYMENT_CLAIM_CONFIRMATION=d-XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# SMS & VOICE - TWILIO
# ============================================================================
# Get from: https://console.twilio.com
# Account → Dashboard → Account Info

# Twilio Account SID (starts with AC)
TWILIO_ACCOUNT_SID=ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Twilio Auth Token
TWILIO_AUTH_TOKEN=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Your Twilio phone number (E.164 format, e.g., +447700900000)
TWILIO_PHONE_NUMBER=+447700900000

# WebSocket URL for AI voice calls (Render deployment URL)
TWILIO_WEBSOCKET_URL=wss://your-voice-server.onrender.com


# ============================================================================
# PHYSICAL LETTERS - LOB.COM
# ============================================================================
# Get from: https://dashboard.lob.com/#/settings/keys
# Use test keys for development (test_), live keys for production (live_)

# Lob API key
LOB_API_KEY=test_XXXXXXXXXXXXXXXXXXXX

# Lob webhook secret (for event notifications)
LOB_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# AI SERVICES - OPENAI
# ============================================================================
# Get from: https://platform.openai.com/api-keys
# Required for: voice transcription, AI insights, invoice parsing

# OpenAI API key (starts with sk-)
OPENAI_API_KEY=sk-XXXXXXXXXXXXXXXXXXXX

# Optional: Deepgram for voice transcription (alternative to Whisper)
# Get from: https://console.deepgram.com
NEXT_PUBLIC_DEEPGRAM_API_KEY=XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# HMRC MAKING TAX DIGITAL (MTD) - VAT API
# ============================================================================
# Get from: https://developer.service.hmrc.gov.uk/developer/applications
# Required for: Submitting VAT returns directly to HMRC
#
# Setup Instructions:
# 1. Create HMRC Developer Account: https://developer.service.hmrc.gov.uk
# 2. Create Application → Add "Read VAT" and "Write VAT" scopes
# 3. Add OAuth 2.0 redirect URI: {NEXT_PUBLIC_APP_URL}/api/hmrc/auth/callback
# 4. Copy Client ID and Client Secret from application credentials
# 5. Use 'test' environment for sandbox, 'production' for live submissions

# HMRC environment (test | production)
# IMPORTANT: Use 'test' for development/testing, 'production' for live VAT submissions
HMRC_ENV=test

# HMRC application credentials
HMRC_CLIENT_ID=your-hmrc-client-id
HMRC_CLIENT_SECRET=your-hmrc-client-secret

# OAuth redirect URI (must match exactly what you configured in HMRC dashboard)
HMRC_REDIRECT_URI=http://localhost:3000/api/hmrc/auth/callback
# HMRC_REDIRECT_URI=https://your-domain.vercel.app/api/hmrc/auth/callback  # Production


# ============================================================================
# SECURITY & ENCRYPTION
# ============================================================================
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# IMPORTANT: Use unique values for each environment (dev, staging, prod)

# Master encryption key for AES-256-GCM encryption of sensitive PII, payment data, and API keys
# REQUIRED FOR PRODUCTION - Used to derive per-user encryption keys for multi-tenancy
# Must be exactly 64 hex characters (32 bytes)
# See: ENCRYPTION.md for full documentation
# CRITICAL: Never commit this to version control
ENCRYPTION_MASTER_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# Legacy encryption key (deprecated - use ENCRYPTION_MASTER_KEY instead)
ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# Secret for authenticating cron job requests
# Prevents unauthorized external access to scheduled tasks
CRON_SECRET=your-32-character-cron-secret-here

# Secret for voice server webhooks
# Must match the value in Render voice server deployment
VOICE_SERVER_WEBHOOK_SECRET=your-32-character-webhook-secret-here


# ============================================================================
# RATE LIMITING - UPSTASH REDIS
# ============================================================================
# Get from: https://console.upstash.com
# Create a Redis database → REST API → Copy credentials

# Upstash Redis REST URL
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io

# Upstash Redis REST Token
UPSTASH_REDIS_REST_TOKEN=XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# MONITORING - SENTRY (ERROR TRACKING)
# ============================================================================
# Get from: https://sentry.io
# Settings → Projects → Your Project → Client Keys (DSN)

# Sentry DSN for error tracking (client-side)
NEXT_PUBLIC_SENTRY_DSN=https://XXXXXXXXXXXXXXXXXXXX@oXXXXX.ingest.sentry.io/XXXXXX

# Sentry DSN for server-side errors
SENTRY_DSN=https://XXXXXXXXXXXXXXXXXXXX@oXXXXX.ingest.sentry.io/XXXXXX

# Your Sentry organization slug
SENTRY_ORG=your-org-name

# Your Sentry project slug
SENTRY_PROJECT=recoup-saas

# Sentry authentication token (for source maps upload)
SENTRY_AUTH_TOKEN=sntrys_XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# ANALYTICS (OPTIONAL)
# ============================================================================

# Enable analytics in production
NEXT_PUBLIC_ENABLE_ANALYTICS=true

# Mixpanel (product analytics)
# Get from: https://mixpanel.com/project/XXXXXX/settings/project
NEXT_PUBLIC_MIXPANEL_TOKEN=XXXXXXXXXXXXXXXXXXXX

# PostHog (product analytics alternative)
# Get from: https://app.posthog.com/project/settings
NEXT_PUBLIC_POSTHOG_KEY=phc_XXXXXXXXXXXXXXXXXXXX
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# LogRocket (session replay)
# Get from: https://app.logrocket.com/settings/setup
NEXT_PUBLIC_LOGROCKET_APP_ID=your-org/recoup


# ============================================================================
# PYTHON BACKEND - FASTAPI MICROSERVICES
# ============================================================================
# URL of Python FastAPI backend (AI collections, voice calls, payment predictions)
# Deployed separately to Render.com

# Python backend URL (proxied via /api/python/* in Next.js)
# Local development: http://localhost:8000
# Production: https://recoup-python-backend.onrender.com
PYTHON_BACKEND_URL=http://localhost:8000
# PYTHON_BACKEND_URL=https://recoup-python-backend.onrender.com  # Production

# Redis URL for Python backend (rate limiting, idempotency)
# Get from: https://console.upstash.com → Create Redis → Copy connection URL
REDIS_URL=redis://default:XXXX@upstash-redis-eu.upstash.io:6379
# REDIS_URL=redis://localhost:6379  # Local development

# PDF service URL (legacy - may be deprecated)
PY_PDF_SERVICE_URL=http://127.0.0.1:8000/generate/test-pdf
# PY_PDF_SERVICE_URL=https://your-python-service.onrender.com/generate/test-pdf  # Production

# Shared secret for authenticating Python service requests
PY_PDF_SERVICE_SECRET=your-python-service-secret
PY_SERVICE_SECRET=your-python-service-secret  # Legacy alias


# ============================================================================
# AGENCY INTEGRATIONS - UK DEBT COLLECTION (PREMIUM TIER)
# ============================================================================
# These are optional and only needed for Business tier features
# Configure when ready to integrate with UK collection agencies

# Lowell Financial (https://www.lowellfinancial.co.uk)
AGENCY_LOWELL_API_KEY=XXXXXXXXXXXXXXXXXXXX
AGENCY_LOWELL_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX

# Cabot Credit Management (https://www.cabotcm.co.uk)
AGENCY_CABOT_API_KEY=XXXXXXXXXXXXXXXXXXXX
AGENCY_CABOT_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX

# Intrum (https://www.intrum.co.uk)
AGENCY_INTRUM_API_KEY=XXXXXXXXXXXXXXXXXXXX
AGENCY_INTRUM_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXX


# ============================================================================
# FEATURE FLAGS & AUTOMATION (OPTIONAL)
# ============================================================================

# Enable/disable escalation automation
ESCALATION_AUTOMATION_ENABLED=false

# Enable debug logging for escalations
ESCALATION_DEBUG=false

# Enable payment verification cron jobs
VERIFICATION_CRON_ENABLED=true

# Enable debug logging for verification system
VERIFICATION_DEBUG=false

# Trigger pricing migration (one-time use)
RUN_PRICING_MIGRATION=false


# ============================================================================
# FCA COMPLIANCE - UK REGULATIONS (FOR VOICE SERVER)
# ============================================================================
# Required for UK debt collection compliance (FCA CONC 7.3)
# These are passed to the Render voice server

# Your company's FCA firm reference number
FCA_FIRM_REFERENCE=123456

# Legal company name
COMPANY_NAME=Recoup Financial Services Ltd

# Registered company address
COMPANY_ADDRESS=123 Example Street, London, EC1A 1BB, UK

# Customer service phone number
CUSTOMER_SERVICE_PHONE=+442071234567

# Complaints email address
COMPLAINTS_EMAIL=complaints@yourdomain.com


# ============================================================================
# WEBHOOK ENDPOINTS (FOR EXTERNAL SERVICES)
# ============================================================================
# These are the URLs external services will call
# Configure these in the respective service dashboards

# Main app webhook base URL
# NEXT_PUBLIC_APP_URL + /api/webhooks/*
#
# Stripe: {NEXT_PUBLIC_APP_URL}/api/webhooks/stripe
# Clerk: {NEXT_PUBLIC_APP_URL}/api/webhooks/clerk
# SendGrid: {NEXT_PUBLIC_APP_URL}/api/webhooks/sendgrid
# Twilio: {NEXT_PUBLIC_APP_URL}/api/webhooks/twilio/voice-ai
# Lob: {NEXT_PUBLIC_APP_URL}/api/webhooks/lob/events

# Voice server webhook URL (where voice call results are sent)
RECOUP_WEBHOOK_URL=https://your-domain.vercel.app/api/webhooks/voice-call
RECOUP_API_URL=https://your-domain.vercel.app  # Alternative format


# ============================================================================
# TESTING & DEVELOPMENT
# ============================================================================
# Variables used in test environment (automatically set by Jest)

# TEST_MODE=true  # Automatically set by Jest
# ENCRYPTION_KEY=0123456789abcdef...  # Set in jest.setup.ts
# STRIPE_SECRET_KEY=sk_test_mock...  # Set in jest.setup.ts


# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# LOCAL DEVELOPMENT:
# 1. Copy this file to .env.local
# 2. Fill in all required values
# 3. Run: npm run dev
#
# VERCEL DEPLOYMENT:
# 1. Go to: Vercel Dashboard → Your Project → Settings → Environment Variables
# 2. Add each variable individually (or use Vercel CLI: vercel env add)
# 3. Select environments: Production, Preview, Development
# 4. Deploy: vercel --prod
#
# RENDER VOICE SERVER:
# See: render-server/.env.example for voice server specific variables
#
# REQUIRED MINIMUM VARIABLES (to run the app):
# - NEXT_PUBLIC_APP_URL
# - CLERK keys (3)
# - FIREBASE keys (3)
# - STRIPE keys (3)
# - SENDGRID keys (3)
# - ENCRYPTION_KEY
# - CRON_SECRET
#
# OPTIONAL (but recommended for full functionality):
# - TWILIO (for SMS/voice features)
# - LOB (for physical letters)
# - OPENAI (for AI features)
# - SENTRY (for error monitoring)
# - UPSTASH_REDIS (for rate limiting)
#
# ============================================================================
